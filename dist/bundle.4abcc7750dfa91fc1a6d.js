"use strict";(self.webpackChunkbreak_the_blocks_game=self.webpackChunkbreak_the_blocks_game||[]).push([[578],{545:(e,t,i)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}function r(e,t){return r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=u(e);if(t){var o=u(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return s(this,i)}}function s(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,i){return t&&c(e.prototype,t),i&&c(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}i.d(t,{AO:()=>y,F5:()=>vt,aL:()=>dt,kp:()=>ct,q3:()=>Vi,uT:()=>D,xu:()=>T});var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0,0,0,0,0,0];h(this,e),this.elements=void 0,this.elements=t}return v(e,[{key:"identity",value:function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}},{key:"setZero",value:function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}},{key:"setTrace",value:function(e){var t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}},{key:"getTrace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new y,t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}},{key:"vmult",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y,i=this.elements,n=e.x,o=e.y,r=e.z;return t.x=i[0]*n+i[1]*o+i[2]*r,t.y=i[3]*n+i[4]*o+i[5]*r,t.z=i[6]*n+i[7]*o+i[8]*r,t}},{key:"smult",value:function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]*=e}},{key:"mmult",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=this.elements,o=t.elements,r=i.elements,a=n[0],s=n[1],l=n[2],u=n[3],h=n[4],c=n[5],v=n[6],d=n[7],p=n[8],y=o[0],f=o[1],m=o[2],w=o[3],g=o[4],b=o[5],x=o[6],k=o[7],E=o[8];return r[0]=a*y+s*w+l*x,r[1]=a*f+s*g+l*k,r[2]=a*m+s*b+l*E,r[3]=u*y+h*w+c*x,r[4]=u*f+h*g+c*k,r[5]=u*m+h*b+c*E,r[6]=v*y+d*w+p*x,r[7]=v*f+d*g+p*k,r[8]=v*m+d*b+p*E,i}},{key:"scale",value:function(t){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=this.elements,o=i.elements,r=0;3!==r;r++)o[3*r+0]=t.x*n[3*r+0],o[3*r+1]=t.y*n[3*r+1],o[3*r+2]=t.z*n[3*r+2];return i}},{key:"solve",value:function(e){var t,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y,o=3,r=4,a=[];for(t=0;t<o*r;t++)a.push(0);for(t=0;t<3;t++)for(i=0;i<3;i++)a[t+r*i]=this.elements[t+3*i];a[3]=e.x,a[7]=e.y,a[11]=e.z;var s,l,u=3,h=u,c=4;do{if(0===a[(t=h-u)+r*t])for(i=t+1;i<h;i++)if(0!==a[t+r*i]){s=c;do{a[(l=c-s)+r*t]+=a[l+r*i]}while(--s);break}if(0!==a[t+r*t])for(i=t+1;i<h;i++){var v=a[t+r*i]/a[t+r*t];s=c;do{a[(l=c-s)+r*i]=l<=t?0:a[l+r*i]-a[l+r*t]*v}while(--s)}}while(--u);if(n.z=a[2*r+3]/a[2*r+2],n.y=(a[1*r+3]-a[1*r+2]*n.z)/a[1*r+1],n.x=(a[0*r+3]-a[0*r+2]*n.z-a[0*r+1]*n.y)/a[0*r+0],isNaN(n.x)||isNaN(n.y)||isNaN(n.z)||n.x===1/0||n.y===1/0||n.z===1/0)throw"Could not solve equation! Got x=["+n.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return n}},{key:"e",value:function(e,t,i){if(void 0===i)return this.elements[t+3*e];this.elements[t+3*e]=i}},{key:"copy",value:function(e){for(var t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}},{key:"toString",value:function(){for(var e="",t=0;t<9;t++)e+=this.elements[t]+",";return e}},{key:"reverse",value:function(){var t,i,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,o=3,r=6,a=p;for(t=0;t<3;t++)for(i=0;i<3;i++)a[t+r*i]=this.elements[t+3*i];a[3]=1,a[9]=0,a[15]=0,a[4]=0,a[10]=1,a[16]=0,a[5]=0,a[11]=0,a[17]=1;var s,l,u=3,h=u,c=r;do{if(0===a[(t=h-u)+r*t])for(i=t+1;i<h;i++)if(0!==a[t+r*i]){s=c;do{a[(l=c-s)+r*t]+=a[l+r*i]}while(--s);break}if(0!==a[t+r*t])for(i=t+1;i<h;i++){var v=a[t+r*i]/a[t+r*t];s=c;do{a[(l=c-s)+r*i]=l<=t?0:a[l+r*i]-a[l+r*t]*v}while(--s)}}while(--u);t=2;do{i=t-1;do{var d=a[t+r*i]/a[t+r*t];s=r;do{a[(l=r-s)+r*i]=a[l+r*i]-a[l+r*t]*d}while(--s)}while(i--)}while(--t);t=2;do{var y=1/a[t+r*t];s=r;do{a[(l=r-s)+r*t]=a[l+r*t]*y}while(--s)}while(t--);t=2;do{i=2;do{if(l=a[o+i+r*t],isNaN(l)||l===1/0)throw"Could not reverse! A=["+this.toString()+"]";n.e(t,i,l)}while(i--)}while(t--);return n}},{key:"setRotationFromQuaternion",value:function(e){var t=e.x,i=e.y,n=e.z,o=e.w,r=t+t,a=i+i,s=n+n,l=t*r,u=t*a,h=t*s,c=i*a,v=i*s,d=n*s,p=o*r,y=o*a,f=o*s,m=this.elements;return m[0]=1-(c+d),m[1]=u-f,m[2]=h+y,m[3]=u+f,m[4]=1-(l+d),m[5]=v-p,m[6]=h-y,m[7]=v+p,m[8]=1-(l+c),this}},{key:"transpose",value:function(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,n=this.elements,o=i.elements;return o[0]=n[0],o[4]=n[4],o[8]=n[8],t=n[1],o[1]=n[3],o[3]=t,t=n[2],o[2]=n[6],o[6]=t,t=n[5],o[5]=n[7],o[7]=t,i}}]),e}(),p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;h(this,e),this.x=void 0,this.y=void 0,this.z=void 0,this.x=t,this.y=i,this.z=n}return v(e,[{key:"cross",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=t.x,o=t.y,r=t.z,a=this.x,s=this.y,l=this.z;return i.x=s*r-l*o,i.y=l*n-a*r,i.z=a*o-s*n,i}},{key:"set",value:function(e,t,i){return this.x=e,this.y=t,this.z=i,this}},{key:"setZero",value:function(){this.x=this.y=this.z=0}},{key:"vadd",value:function(t,i){if(!i)return new e(this.x+t.x,this.y+t.y,this.z+t.z);i.x=t.x+this.x,i.y=t.y+this.y,i.z=t.z+this.z}},{key:"vsub",value:function(t,i){if(!i)return new e(this.x-t.x,this.y-t.y,this.z-t.z);i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z}},{key:"crossmat",value:function(){return new d([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}},{key:"normalize",value:function(){var e=this.x,t=this.y,i=this.z,n=Math.sqrt(e*e+t*t+i*i);if(n>0){var o=1/n;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return n}},{key:"unit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,i=this.x,n=this.y,o=this.z,r=Math.sqrt(i*i+n*n+o*o);return r>0?(r=1/r,t.x=i*r,t.y=n*r,t.z=o*r):(t.x=1,t.y=0,t.z=0),t}},{key:"length",value:function(){var e=this.x,t=this.y,i=this.z;return Math.sqrt(e*e+t*t+i*i)}},{key:"lengthSquared",value:function(){return this.dot(this)}},{key:"distanceTo",value:function(e){var t=this.x,i=this.y,n=this.z,o=e.x,r=e.y,a=e.z;return Math.sqrt((o-t)*(o-t)+(r-i)*(r-i)+(a-n)*(a-n))}},{key:"distanceSquared",value:function(e){var t=this.x,i=this.y,n=this.z,o=e.x,r=e.y,a=e.z;return(o-t)*(o-t)+(r-i)*(r-i)+(a-n)*(a-n)}},{key:"scale",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=this.x,o=this.y,r=this.z;return i.x=t*n,i.y=t*o,i.z=t*r,i}},{key:"vmul",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;return i.x=t.x*this.x,i.y=t.y*this.y,i.z=t.z*this.z,i}},{key:"addScaledVector",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e;return n.x=this.x+t*i.x,n.y=this.y+t*i.y,n.z=this.z+t*i.z,n}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"isZero",value:function(){return 0===this.x&&0===this.y&&0===this.z}},{key:"negate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e;return t.x=-this.x,t.y=-this.y,t.z=-this.z,t}},{key:"tangents",value:function(e,t){var i=this.length();if(i>0){var n=f,o=1/i;n.set(this.x*o,this.y*o,this.z*o);var r=m;Math.abs(n.x)<.9?(r.set(1,0,0),n.cross(r,e)):(r.set(0,1,0),n.cross(r,e)),n.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}},{key:"toString",value:function(){return this.x+","+this.y+","+this.z}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"lerp",value:function(e,t,i){var n=this.x,o=this.y,r=this.z;i.x=n+(e.x-n)*t,i.y=o+(e.y-o)*t,i.z=r+(e.z-r)*t}},{key:"almostEquals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-6;return!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}},{key:"almostZero",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e-6;return!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}},{key:"isAntiparallelTo",value:function(e,t){return this.negate(w),w.almostEquals(e,t)}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();y.ZERO=void 0,y.UNIT_X=void 0,y.UNIT_Y=void 0,y.UNIT_Z=void 0,y.ZERO=new y(0,0,0),y.UNIT_X=new y(1,0,0),y.UNIT_Y=new y(0,1,0),y.UNIT_Z=new y(0,0,1);var f=new y,m=new y,w=new y,g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,e),this.lowerBound=void 0,this.upperBound=void 0,this.lowerBound=new y,this.upperBound=new y,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}return v(e,[{key:"setFromPoints",value:function(e,t,i,n){var o=this.lowerBound,r=this.upperBound,a=i;o.copy(e[0]),a&&a.vmult(o,o),r.copy(o);for(var s=1;s<e.length;s++){var l=e[s];a&&(a.vmult(l,b),l=b),l.x>r.x&&(r.x=l.x),l.x<o.x&&(o.x=l.x),l.y>r.y&&(r.y=l.y),l.y<o.y&&(o.y=l.y),l.z>r.z&&(r.z=l.z),l.z<o.z&&(o.z=l.z)}return t&&(t.vadd(o,o),t.vadd(r,r)),n&&(o.x-=n,o.y-=n,o.z-=n,r.x+=n,r.y+=n,r.z+=n),this}},{key:"copy",value:function(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"extend",value:function(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}},{key:"overlaps",value:function(e){var t=this.lowerBound,i=this.upperBound,n=e.lowerBound,o=e.upperBound,r=n.x<=i.x&&i.x<=o.x||t.x<=o.x&&o.x<=i.x,a=n.y<=i.y&&i.y<=o.y||t.y<=o.y&&o.y<=i.y,s=n.z<=i.z&&i.z<=o.z||t.z<=o.z&&o.z<=i.z;return r&&a&&s}},{key:"volume",value:function(){var e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}},{key:"contains",value:function(e){var t=this.lowerBound,i=this.upperBound,n=e.lowerBound,o=e.upperBound;return t.x<=n.x&&i.x>=o.x&&t.y<=n.y&&i.y>=o.y&&t.z<=n.z&&i.z>=o.z}},{key:"getCorners",value:function(e,t,i,n,o,r,a,s){var l=this.lowerBound,u=this.upperBound;e.copy(l),t.set(u.x,l.y,l.z),i.set(u.x,u.y,l.z),n.set(l.x,u.y,u.z),o.set(u.x,l.y,u.z),r.set(l.x,u.y,l.z),a.set(l.x,l.y,u.z),s.copy(u)}},{key:"toLocalFrame",value:function(e,t){var i=x,n=i[0],o=i[1],r=i[2],a=i[3],s=i[4],l=i[5],u=i[6],h=i[7];this.getCorners(n,o,r,a,s,l,u,h);for(var c=0;8!==c;c++){var v=i[c];e.pointToLocal(v,v)}return t.setFromPoints(i)}},{key:"toWorldFrame",value:function(e,t){var i=x,n=i[0],o=i[1],r=i[2],a=i[3],s=i[4],l=i[5],u=i[6],h=i[7];this.getCorners(n,o,r,a,s,l,u,h);for(var c=0;8!==c;c++){var v=i[c];e.pointToWorld(v,v)}return t.setFromPoints(i)}},{key:"overlapsRay",value:function(e){var t=e.direction,i=e.from,n=1/t.x,o=1/t.y,r=1/t.z,a=(this.lowerBound.x-i.x)*n,s=(this.upperBound.x-i.x)*n,l=(this.lowerBound.y-i.y)*o,u=(this.upperBound.y-i.y)*o,h=(this.lowerBound.z-i.z)*r,c=(this.upperBound.z-i.z)*r,v=Math.max(Math.max(Math.min(a,s),Math.min(l,u)),Math.min(h,c)),d=Math.min(Math.min(Math.max(a,s),Math.max(l,u)),Math.max(h,c));return!(d<0)&&!(v>d)}}]),e}(),b=new y,x=[new y,new y,new y,new y,new y,new y,new y,new y],k=function(){function e(){h(this,e),this.matrix=void 0,this.matrix=[]}return v(e,[{key:"get",value:function(e,t){var i=e.index,n=t.index;if(n>i){var o=n;n=i,i=o}return this.matrix[(i*(i+1)>>1)+n-1]}},{key:"set",value:function(e,t,i){var n=e.index,o=t.index;if(o>n){var r=o;o=n,n=r}this.matrix[(n*(n+1)>>1)+o-1]=i?1:0}},{key:"reset",value:function(){for(var e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}},{key:"setNumObjects",value:function(e){this.matrix.length=e*(e-1)>>1}}]),e}(),E=function(){function e(){h(this,e),this._listeners=void 0}return v(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;return void 0===i[e]&&(i[e]=[]),i[e].includes(t)||i[e].push(t),this}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return!(void 0===i[e]||!i[e].includes(t))}},{key:"hasAnyEventListener",value:function(e){return void 0!==this._listeners&&void 0!==this._listeners[e]}},{key:"removeEventListener",value:function(e,t){if(void 0===this._listeners)return this;var i=this._listeners;if(void 0===i[e])return this;var n=i[e].indexOf(t);return-1!==n&&i[e].splice(n,1),this}},{key:"dispatchEvent",value:function(e){if(void 0===this._listeners)return this;var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=0,n=t.length;i<n;i++)t[i].call(this,e)}return this}}]),e}(),S=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;h(this,e),this.x=void 0,this.y=void 0,this.z=void 0,this.w=void 0,this.x=t,this.y=i,this.z=n,this.w=o}return v(e,[{key:"set",value:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}},{key:"toString",value:function(){return this.x+","+this.y+","+this.z+","+this.w}},{key:"toArray",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"setFromAxisAngle",value:function(e,t){var i=Math.sin(.5*t);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(.5*t),this}},{key:"toAxisAngle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new y;this.normalize();var t=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,t]}},{key:"setFromVectors",value:function(e,t){if(e.isAntiparallelTo(t)){var i=z,n=C;e.tangents(i,n),this.setFromAxisAngle(i,Math.PI)}else{var o=e.cross(t);this.x=o.x,this.y=o.y,this.z=o.z,this.w=Math.sqrt(Math.pow(e.length(),2)*Math.pow(t.length(),2))+e.dot(t),this.normalize()}return this}},{key:"mult",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=this.x,o=this.y,r=this.z,a=this.w,s=t.x,l=t.y,u=t.z,h=t.w;return i.x=n*h+a*s+o*u-r*l,i.y=o*h+a*l+r*s-n*u,i.z=r*h+a*u+n*l-o*s,i.w=a*h-n*s-o*l-r*u,i}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,i=this.x,n=this.y,o=this.z,r=this.w;this.conjugate(t);var a=1/(i*i+n*n+o*o+r*r);return t.x*=a,t.y*=a,t.z*=a,t.w*=a,t}},{key:"conjugate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e;return t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}},{key:"normalize",value:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"normalizeFast",value:function(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"vmult",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y,i=e.x,n=e.y,o=e.z,r=this.x,a=this.y,s=this.z,l=this.w,u=l*i+a*o-s*n,h=l*n+s*i-r*o,c=l*o+r*n-a*i,v=-r*i-a*n-s*o;return t.x=u*l+v*-r+h*-s-c*-a,t.y=h*l+v*-a+c*-r-u*-s,t.z=c*l+v*-s+u*-a-h*-r,t}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"toEuler",value:function(e){var t,i,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YZX",r=this.x,a=this.y,s=this.z,l=this.w;if("YZX"!==o)throw new Error("Euler order "+o+" not supported yet.");var u=r*a+s*l;if(u>.499&&(t=2*Math.atan2(r,l),i=Math.PI/2,n=0),u<-.499&&(t=-2*Math.atan2(r,l),i=-Math.PI/2,n=0),void 0===t){var h=r*r,c=a*a,v=s*s;t=Math.atan2(2*a*l-2*r*s,1-2*c-2*v),i=Math.asin(2*u),n=Math.atan2(2*r*l-2*a*s,1-2*h-2*v)}e.y=t,e.z=i,e.x=n}},{key:"setFromEuler",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"XYZ",o=Math.cos(e/2),r=Math.cos(t/2),a=Math.cos(i/2),s=Math.sin(e/2),l=Math.sin(t/2),u=Math.sin(i/2);return"XYZ"===n?(this.x=s*r*a+o*l*u,this.y=o*l*a-s*r*u,this.z=o*r*u+s*l*a,this.w=o*r*a-s*l*u):"YXZ"===n?(this.x=s*r*a+o*l*u,this.y=o*l*a-s*r*u,this.z=o*r*u-s*l*a,this.w=o*r*a+s*l*u):"ZXY"===n?(this.x=s*r*a-o*l*u,this.y=o*l*a+s*r*u,this.z=o*r*u+s*l*a,this.w=o*r*a-s*l*u):"ZYX"===n?(this.x=s*r*a-o*l*u,this.y=o*l*a+s*r*u,this.z=o*r*u-s*l*a,this.w=o*r*a+s*l*u):"YZX"===n?(this.x=s*r*a+o*l*u,this.y=o*l*a+s*r*u,this.z=o*r*u-s*l*a,this.w=o*r*a-s*l*u):"XZY"===n&&(this.x=s*r*a-o*l*u,this.y=o*l*a-s*r*u,this.z=o*r*u+s*l*a,this.w=o*r*a+s*l*u),this}},{key:"clone",value:function(){return new e(this.x,this.y,this.z,this.w)}},{key:"slerp",value:function(t,i){var n,o,r,a,s,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e,u=this.x,h=this.y,c=this.z,v=this.w,d=t.x,p=t.y,y=t.z,f=t.w;return(o=u*d+h*p+c*y+v*f)<0&&(o=-o,d=-d,p=-p,y=-y,f=-f),1-o>1e-6?(n=Math.acos(o),r=Math.sin(n),a=Math.sin((1-i)*n)/r,s=Math.sin(i*n)/r):(a=1-i,s=i),l.x=a*u+s*d,l.y=a*h+s*p,l.z=a*c+s*y,l.w=a*v+s*f,l}},{key:"integrate",value:function(t,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e,r=t.x*n.x,a=t.y*n.y,s=t.z*n.z,l=this.x,u=this.y,h=this.z,c=this.w,v=.5*i;return o.x+=v*(r*c+a*h-s*u),o.y+=v*(a*c+s*l-r*h),o.z+=v*(s*c+r*u-a*l),o.w+=v*(-r*l-a*u-s*h),o}}]),e}(),z=new y,C=new y,B=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,e),this.id=void 0,this.type=void 0,this.boundingSphereRadius=void 0,this.collisionResponse=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.material=void 0,this.body=void 0,this.id=e.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=!t.collisionResponse||t.collisionResponse,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}return v(e,[{key:"updateBoundingSphereRadius",value:function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}},{key:"volume",value:function(){throw"volume() not implemented for shape type "+this.type}},{key:"calculateLocalInertia",value:function(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type}},{key:"calculateWorldAABB",value:function(e,t,i,n){throw"calculateWorldAABB() not implemented for shape type "+this.type}}]),e}();B.idCounter=0,B.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};var A=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,e),this.position=void 0,this.quaternion=void 0,this.position=new y,this.quaternion=new S,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}return v(e,[{key:"pointToLocal",value:function(t,i){return e.pointToLocalFrame(this.position,this.quaternion,t,i)}},{key:"pointToWorld",value:function(t,i){return e.pointToWorldFrame(this.position,this.quaternion,t,i)}},{key:"vectorToWorldFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y;return this.quaternion.vmult(e,t),t}}],[{key:"pointToLocalFrame",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y;return i.vsub(e,n),t.conjugate(M),M.vmult(n,n),n}},{key:"pointToWorldFrame",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y;return t.vmult(i,n),n.vadd(e,n),n}},{key:"vectorToWorldFrame",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new y;return e.vmult(t,i),i}},{key:"vectorToLocalFrame",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y;return t.w*=-1,t.vmult(i,n),t.w*=-1,n}}]),e}(),M=new S,F=function(e){o(i,e);var t=a(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,i);var o=n.vertices,r=void 0===o?[]:o,a=n.faces,s=void 0===a?[]:a,l=n.normals,u=void 0===l?[]:l,c=n.axes,v=n.boundingSphereRadius;return(e=t.call(this,{type:B.types.CONVEXPOLYHEDRON})).vertices=void 0,e.faces=void 0,e.faceNormals=void 0,e.worldVertices=void 0,e.worldVerticesNeedsUpdate=void 0,e.worldFaceNormals=void 0,e.worldFaceNormalsNeedsUpdate=void 0,e.uniqueAxes=void 0,e.uniqueEdges=void 0,e.vertices=r,e.faces=s,e.faceNormals=u,0===e.faceNormals.length&&e.computeNormals(),v?e.boundingSphereRadius=v:e.updateBoundingSphereRadius(),e.worldVertices=[],e.worldVerticesNeedsUpdate=!0,e.worldFaceNormals=[],e.worldFaceNormalsNeedsUpdate=!0,e.uniqueAxes=c?c.slice():null,e.uniqueEdges=[],e.computeEdges(),e}return v(i,[{key:"computeEdges",value:function(){var e=this.faces,t=this.vertices,i=this.uniqueEdges;i.length=0;for(var n=new y,o=0;o!==e.length;o++)for(var r=e[o],a=r.length,s=0;s!==a;s++){var l=(s+1)%a;t[r[s]].vsub(t[r[l]],n),n.normalize();for(var u=!1,h=0;h!==i.length;h++)if(i[h].almostEquals(n)||i[h].almostEquals(n)){u=!0;break}u||i.push(n.clone())}}},{key:"computeNormals",value:function(){this.faceNormals.length=this.faces.length;for(var e=0;e<this.faces.length;e++){for(var t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw new Error("Vertex "+this.faces[e][t]+" not found!");var i=this.faceNormals[e]||new y;this.getFaceNormal(e,i),i.negate(i),this.faceNormals[e]=i;var n=this.vertices[this.faces[e][0]];if(i.dot(n)<0){console.error(".faceNormals["+e+"] = Vec3("+i.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var o=0;o<this.faces[e].length;o++)console.warn(".vertices["+this.faces[e][o]+"] = Vec3("+this.vertices[this.faces[e][o]].toString()+")")}}}},{key:"getFaceNormal",value:function(e,t){var n=this.faces[e],o=this.vertices[n[0]],r=this.vertices[n[1]],a=this.vertices[n[2]];i.computeNormal(o,r,a,t)}},{key:"clipAgainstHull",value:function(e,t,i,n,o,r,a,s,l){for(var u=new y,h=-1,c=-Number.MAX_VALUE,v=0;v<i.faces.length;v++){u.copy(i.faceNormals[v]),o.vmult(u,u);var d=u.dot(r);d>c&&(c=d,h=v)}for(var p=[],f=0;f<i.faces[h].length;f++){var m=i.vertices[i.faces[h][f]],w=new y;w.copy(m),o.vmult(w,w),n.vadd(w,w),p.push(w)}h>=0&&this.clipFaceAgainstHull(r,e,t,p,a,s,l)}},{key:"findSeparatingAxis",value:function(e,t,i,n,o,r,a,s){var l=new y,u=new y,h=new y,c=new y,v=new y,d=new y,p=Number.MAX_VALUE,f=this;if(f.uniqueAxes)for(var m=0;m!==f.uniqueAxes.length;m++){i.vmult(f.uniqueAxes[m],l);var w=f.testSepAxis(l,e,t,i,n,o);if(!1===w)return!1;w<p&&(p=w,r.copy(l))}else for(var g=a?a.length:f.faces.length,b=0;b<g;b++){var x=a?a[b]:b;l.copy(f.faceNormals[x]),i.vmult(l,l);var k=f.testSepAxis(l,e,t,i,n,o);if(!1===k)return!1;k<p&&(p=k,r.copy(l))}if(e.uniqueAxes)for(var E=0;E!==e.uniqueAxes.length;E++){o.vmult(e.uniqueAxes[E],u);var S=f.testSepAxis(u,e,t,i,n,o);if(!1===S)return!1;S<p&&(p=S,r.copy(u))}else for(var z=s?s.length:e.faces.length,C=0;C<z;C++){var B=s?s[C]:C;u.copy(e.faceNormals[B]),o.vmult(u,u);var A=f.testSepAxis(u,e,t,i,n,o);if(!1===A)return!1;A<p&&(p=A,r.copy(u))}for(var M=0;M!==f.uniqueEdges.length;M++){i.vmult(f.uniqueEdges[M],c);for(var F=0;F!==e.uniqueEdges.length;F++)if(o.vmult(e.uniqueEdges[F],v),c.cross(v,d),!d.almostZero()){d.normalize();var P=f.testSepAxis(d,e,t,i,n,o);if(!1===P)return!1;P<p&&(p=P,r.copy(d))}}return n.vsub(t,h),h.dot(r)>0&&r.negate(r),!0}},{key:"testSepAxis",value:function(e,t,n,o,r,a){i.project(this,e,n,o,P),i.project(t,e,r,a,R);var s=P[0],l=P[1],u=R[0],h=R[1];if(s<h||u<l)return!1;var c=s-h,v=u-l;return c<v?c:v}},{key:"calculateLocalInertia",value:function(e,t){var i=new y,n=new y;this.computeLocalAABB(n,i);var o=i.x-n.x,r=i.y-n.y,a=i.z-n.z;t.x=1/12*e*(2*r*2*r+2*a*2*a),t.y=1/12*e*(2*o*2*o+2*a*2*a),t.z=1/12*e*(2*r*2*r+2*o*2*o)}},{key:"getPlaneConstantOfFace",value:function(e){var t=this.faces[e],i=this.faceNormals[e],n=this.vertices[t[0]];return-i.dot(n)}},{key:"clipFaceAgainstHull",value:function(e,t,i,n,o,r,a){for(var s=new y,l=new y,u=new y,h=new y,c=new y,v=new y,d=new y,p=new y,f=this,m=n,w=[],g=-1,b=Number.MAX_VALUE,x=0;x<f.faces.length;x++){s.copy(f.faceNormals[x]),i.vmult(s,s);var k=s.dot(e);k<b&&(b=k,g=x)}if(!(g<0)){var E=f.faces[g];E.connectedFaces=[];for(var S=0;S<f.faces.length;S++)for(var z=0;z<f.faces[S].length;z++)-1!==E.indexOf(f.faces[S][z])&&S!==g&&-1===E.connectedFaces.indexOf(S)&&E.connectedFaces.push(S);for(var C=E.length,B=0;B<C;B++){var A=f.vertices[E[B]],M=f.vertices[E[(B+1)%C]];A.vsub(M,l),u.copy(l),i.vmult(u,u),t.vadd(u,u),h.copy(this.faceNormals[g]),i.vmult(h,h),t.vadd(h,h),u.cross(h,c),c.negate(c),v.copy(A),i.vmult(v,v),t.vadd(v,v);var F=E.connectedFaces[B];d.copy(this.faceNormals[F]);var P=this.getPlaneConstantOfFace(F);p.copy(d),i.vmult(p,p);var R=P-p.dot(t);for(this.clipFaceAgainstPlane(m,w,p,R);m.length;)m.shift();for(;w.length;)m.push(w.shift())}d.copy(this.faceNormals[g]);var q=this.getPlaneConstantOfFace(g);p.copy(d),i.vmult(p,p);for(var j=q-p.dot(t),T=0;T<m.length;T++){var N=p.dot(m[T])+j;if(N<=o&&(console.log("clamped: depth="+N+" to minDist="+o),N=o),N<=r){var I=m[T];if(N<=1e-6){var L={point:I,normal:p,depth:N};a.push(L)}}}}}},{key:"clipFaceAgainstPlane",value:function(e,t,i,n){var o,r,a=e.length;if(a<2)return t;var s=e[e.length-1],l=e[0];o=i.dot(s)+n;for(var u=0;u<a;u++){if(l=e[u],r=i.dot(l)+n,o<0)if(r<0){var h=new y;h.copy(l),t.push(h)}else{var c=new y;s.lerp(l,o/(o-r),c),t.push(c)}else if(r<0){var v=new y;s.lerp(l,o/(o-r),v),t.push(v),t.push(l)}s=l,o=r}return t}},{key:"computeWorldVertices",value:function(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new y);for(var i=this.vertices,n=this.worldVertices,o=0;o!==this.vertices.length;o++)t.vmult(i[o],n[o]),e.vadd(n[o],n[o]);this.worldVerticesNeedsUpdate=!1}},{key:"computeLocalAABB",value:function(e,t){var i=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var n=0;n<this.vertices.length;n++){var o=i[n];o.x<e.x?e.x=o.x:o.x>t.x&&(t.x=o.x),o.y<e.y?e.y=o.y:o.y>t.y&&(t.y=o.y),o.z<e.z?e.z=o.z:o.z>t.z&&(t.z=o.z)}}},{key:"computeWorldFaceNormals",value:function(e){for(var t=this.faceNormals.length;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new y);for(var i=this.faceNormals,n=this.worldFaceNormals,o=0;o!==t;o++)e.vmult(i[o],n[o]);this.worldFaceNormalsNeedsUpdate=!1}},{key:"updateBoundingSphereRadius",value:function(){for(var e=0,t=this.vertices,i=0;i!==t.length;i++){var n=t[i].lengthSquared();n>e&&(e=n)}this.boundingSphereRadius=Math.sqrt(e)}},{key:"calculateWorldAABB",value:function(e,t,i,n){for(var o,r,a,s,l,u,h=this.vertices,c=new y,v=0;v<h.length;v++){c.copy(h[v]),t.vmult(c,c),e.vadd(c,c);var d=c;(void 0===o||d.x<o)&&(o=d.x),(void 0===s||d.x>s)&&(s=d.x),(void 0===r||d.y<r)&&(r=d.y),(void 0===l||d.y>l)&&(l=d.y),(void 0===a||d.z<a)&&(a=d.z),(void 0===u||d.z>u)&&(u=d.z)}i.set(o,r,a),n.set(s,l,u)}},{key:"volume",value:function(){return 4*Math.PI*this.boundingSphereRadius/3}},{key:"getAveragePointLocal",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new y,t=this.vertices,i=0;i<t.length;i++)e.vadd(t[i],e);return e.scale(1/t.length,e),e}},{key:"transformAllPoints",value:function(e,t){var i=this.vertices.length,n=this.vertices;if(t){for(var o=0;o<i;o++){var r=n[o];t.vmult(r,r)}for(var a=0;a<this.faceNormals.length;a++){var s=this.faceNormals[a];t.vmult(s,s)}}if(e)for(var l=0;l<i;l++){var u=n[l];u.vadd(e,u)}}},{key:"pointIsInside",value:function(e){var t=this.vertices,i=this.faces,n=this.faceNormals,o=new y;this.getAveragePointLocal(o);for(var r=0;r<this.faces.length;r++){var a=n[r],s=t[i[r][0]],l=new y;e.vsub(s,l);var u=a.dot(l),h=new y;o.vsub(s,h);var c=a.dot(h);if(u<0&&c>0||u>0&&c<0)return!1}return-1}}],[{key:"computeNormal",value:function(e,t,i,n){var o=new y,r=new y;t.vsub(e,r),i.vsub(t,o),o.cross(r,n),n.isZero()||n.normalize()}},{key:"project",value:function(e,t,i,n,o){var r=e.vertices.length,a=q,s=0,l=0,u=j,h=e.vertices;u.setZero(),A.vectorToLocalFrame(i,n,t,a),A.pointToLocalFrame(i,n,u,u);var c=u.dot(a);l=s=h[0].dot(a);for(var v=1;v<r;v++){var d=h[v].dot(a);d>s&&(s=d),d<l&&(l=d)}if((l-=c)>(s-=c)){var p=l;l=s,s=p}o[0]=s,o[1]=l}}]),i}(B),P=[],R=[],q=new y,j=new y,T=function(e){o(i,e);var t=a(i);function i(e){var n;return h(this,i),(n=t.call(this,{type:B.types.BOX})).halfExtents=void 0,n.convexPolyhedronRepresentation=void 0,n.halfExtents=e,n.convexPolyhedronRepresentation=null,n.updateConvexPolyhedronRepresentation(),n.updateBoundingSphereRadius(),n}return v(i,[{key:"updateConvexPolyhedronRepresentation",value:function(){var e=this.halfExtents.x,t=this.halfExtents.y,i=this.halfExtents.z,n=y,o=[new n(-e,-t,-i),new n(e,-t,-i),new n(e,t,-i),new n(-e,t,-i),new n(-e,-t,i),new n(e,-t,i),new n(e,t,i),new n(-e,t,i)],r=[new n(0,0,1),new n(0,1,0),new n(1,0,0)],a=new F({vertices:o,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:r});this.convexPolyhedronRepresentation=a,a.material=this.material}},{key:"calculateLocalInertia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y;return i.calculateInertia(this.halfExtents,e,t),t}},{key:"getSideNormals",value:function(e,t){var i=e,n=this.halfExtents;if(i[0].set(n.x,0,0),i[1].set(0,n.y,0),i[2].set(0,0,n.z),i[3].set(-n.x,0,0),i[4].set(0,-n.y,0),i[5].set(0,0,-n.z),void 0!==t)for(var o=0;o!==i.length;o++)t.vmult(i[o],i[o]);return i}},{key:"volume",value:function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}},{key:"updateBoundingSphereRadius",value:function(){this.boundingSphereRadius=this.halfExtents.length()}},{key:"forEachWorldCorner",value:function(e,t,i){for(var n=this.halfExtents,o=[[n.x,n.y,n.z],[-n.x,n.y,n.z],[-n.x,-n.y,n.z],[-n.x,-n.y,-n.z],[n.x,-n.y,-n.z],[n.x,n.y,-n.z],[-n.x,n.y,-n.z],[n.x,-n.y,n.z]],r=0;r<o.length;r++)N.set(o[r][0],o[r][1],o[r][2]),t.vmult(N,N),e.vadd(N,N),i(N.x,N.y,N.z)}},{key:"calculateWorldAABB",value:function(e,t,i,n){var o=this.halfExtents;I[0].set(o.x,o.y,o.z),I[1].set(-o.x,o.y,o.z),I[2].set(-o.x,-o.y,o.z),I[3].set(-o.x,-o.y,-o.z),I[4].set(o.x,-o.y,-o.z),I[5].set(o.x,o.y,-o.z),I[6].set(-o.x,o.y,-o.z),I[7].set(o.x,-o.y,o.z);var r=I[0];t.vmult(r,r),e.vadd(r,r),n.copy(r),i.copy(r);for(var a=1;a<8;a++){var s=I[a];t.vmult(s,s),e.vadd(s,s);var l=s.x,u=s.y,h=s.z;l>n.x&&(n.x=l),u>n.y&&(n.y=u),h>n.z&&(n.z=h),l<i.x&&(i.x=l),u<i.y&&(i.y=u),h<i.z&&(i.z=h)}}}],[{key:"calculateInertia",value:function(e,t,i){var n=e;i.x=1/12*t*(2*n.y*2*n.y+2*n.z*2*n.z),i.y=1/12*t*(2*n.x*2*n.x+2*n.z*2*n.z),i.z=1/12*t*(2*n.y*2*n.y+2*n.x*2*n.x)}}]),i}(B),N=new y,I=[new y,new y,new y,new y,new y,new y,new y,new y],L=1,O=2,W=4,V=0,_=1,H=2,D=function(e){o(i,e);var t=a(i);function i(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,i),(e=t.call(this)).id=void 0,e.index=void 0,e.world=void 0,e.preStep=void 0,e.postStep=void 0,e.vlambda=void 0,e.collisionFilterGroup=void 0,e.collisionFilterMask=void 0,e.collisionResponse=void 0,e.position=void 0,e.previousPosition=void 0,e.interpolatedPosition=void 0,e.initPosition=void 0,e.velocity=void 0,e.initVelocity=void 0,e.force=void 0,e.mass=void 0,e.invMass=void 0,e.material=void 0,e.linearDamping=void 0,e.type=void 0,e.allowSleep=void 0,e.sleepState=void 0,e.sleepSpeedLimit=void 0,e.sleepTimeLimit=void 0,e.timeLastSleepy=void 0,e.wakeUpAfterNarrowphase=void 0,e.torque=void 0,e.quaternion=void 0,e.initQuaternion=void 0,e.previousQuaternion=void 0,e.interpolatedQuaternion=void 0,e.angularVelocity=void 0,e.initAngularVelocity=void 0,e.shapes=void 0,e.shapeOffsets=void 0,e.shapeOrientations=void 0,e.inertia=void 0,e.invInertia=void 0,e.invInertiaWorld=void 0,e.invMassSolve=void 0,e.invInertiaSolve=void 0,e.invInertiaWorldSolve=void 0,e.fixedRotation=void 0,e.angularDamping=void 0,e.linearFactor=void 0,e.angularFactor=void 0,e.aabb=void 0,e.aabbNeedsUpdate=void 0,e.boundingRadius=void 0,e.wlambda=void 0,e.isTrigger=void 0,e.id=i.idCounter++,e.index=-1,e.world=null,e.preStep=null,e.postStep=null,e.vlambda=new y,e.collisionFilterGroup="number"==typeof o.collisionFilterGroup?o.collisionFilterGroup:1,e.collisionFilterMask="number"==typeof o.collisionFilterMask?o.collisionFilterMask:-1,e.collisionResponse="boolean"!=typeof o.collisionResponse||o.collisionResponse,e.position=new y,e.previousPosition=new y,e.interpolatedPosition=new y,e.initPosition=new y,o.position&&(e.position.copy(o.position),e.previousPosition.copy(o.position),e.interpolatedPosition.copy(o.position),e.initPosition.copy(o.position)),e.velocity=new y,o.velocity&&e.velocity.copy(o.velocity),e.initVelocity=new y,e.force=new y;var r="number"==typeof o.mass?o.mass:0;return e.mass=r,e.invMass=r>0?1/r:0,e.material=o.material||null,e.linearDamping="number"==typeof o.linearDamping?o.linearDamping:.01,e.type=r<=0?i.STATIC:i.DYNAMIC,n(o.type)===n(i.STATIC)&&(e.type=o.type),e.allowSleep=void 0===o.allowSleep||o.allowSleep,e.sleepState=i.AWAKE,e.sleepSpeedLimit=void 0!==o.sleepSpeedLimit?o.sleepSpeedLimit:.1,e.sleepTimeLimit=void 0!==o.sleepTimeLimit?o.sleepTimeLimit:1,e.timeLastSleepy=0,e.wakeUpAfterNarrowphase=!1,e.torque=new y,e.quaternion=new S,e.initQuaternion=new S,e.previousQuaternion=new S,e.interpolatedQuaternion=new S,o.quaternion&&(e.quaternion.copy(o.quaternion),e.initQuaternion.copy(o.quaternion),e.previousQuaternion.copy(o.quaternion),e.interpolatedQuaternion.copy(o.quaternion)),e.angularVelocity=new y,o.angularVelocity&&e.angularVelocity.copy(o.angularVelocity),e.initAngularVelocity=new y,e.shapes=[],e.shapeOffsets=[],e.shapeOrientations=[],e.inertia=new y,e.invInertia=new y,e.invInertiaWorld=new d,e.invMassSolve=0,e.invInertiaSolve=new y,e.invInertiaWorldSolve=new d,e.fixedRotation=void 0!==o.fixedRotation&&o.fixedRotation,e.angularDamping=void 0!==o.angularDamping?o.angularDamping:.01,e.linearFactor=new y(1,1,1),o.linearFactor&&e.linearFactor.copy(o.linearFactor),e.angularFactor=new y(1,1,1),o.angularFactor&&e.angularFactor.copy(o.angularFactor),e.aabb=new g,e.aabbNeedsUpdate=!0,e.boundingRadius=0,e.wlambda=new y,e.isTrigger=Boolean(o.isTrigger),o.shape&&e.addShape(o.shape),e.updateMassProperties(),e}return v(i,[{key:"wakeUp",value:function(){var e=this.sleepState;this.sleepState=i.AWAKE,this.wakeUpAfterNarrowphase=!1,e===i.SLEEPING&&this.dispatchEvent(i.wakeupEvent)}},{key:"sleep",value:function(){this.sleepState=i.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}},{key:"sleepTick",value:function(e){if(this.allowSleep){var t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),o=Math.pow(this.sleepSpeedLimit,2);t===i.AWAKE&&n<o?(this.sleepState=i.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(i.sleepyEvent)):t===i.SLEEPY&&n>o?this.wakeUp():t===i.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(i.sleepEvent))}}},{key:"updateSolveMassProperties",value:function(){this.sleepState===i.SLEEPING||this.type===i.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}},{key:"pointToLocalFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y;return e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}},{key:"vectorToLocalFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y;return this.quaternion.conjugate().vmult(e,t),t}},{key:"pointToWorldFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y;return this.quaternion.vmult(e,t),t.vadd(this.position,t),t}},{key:"vectorToWorldFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y;return this.quaternion.vmult(e,t),t}},{key:"addShape",value:function(e,t,i){var n=new y,o=new S;return t&&n.copy(t),i&&o.copy(i),this.shapes.push(e),this.shapeOffsets.push(n),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}},{key:"removeShape",value:function(e){var t=this.shapes.indexOf(e);return-1===t?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}},{key:"updateBoundingRadius",value:function(){for(var e=this.shapes,t=this.shapeOffsets,i=e.length,n=0,o=0;o!==i;o++){var r=e[o];r.updateBoundingSphereRadius();var a=t[o].length(),s=r.boundingSphereRadius;a+s>n&&(n=a+s)}this.boundingRadius=n}},{key:"updateAABB",value:function(){for(var e=this.shapes,t=this.shapeOffsets,i=this.shapeOrientations,n=e.length,o=U,r=G,a=this.quaternion,s=this.aabb,l=Y,u=0;u!==n;u++){var h=e[u];a.vmult(t[u],o),o.vadd(this.position,o),a.mult(i[u],r),h.calculateWorldAABB(o,r,l.lowerBound,l.upperBound),0===u?s.copy(l):s.extend(l)}this.aabbNeedsUpdate=!1}},{key:"updateInertiaWorld",value:function(e){var t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){var i=X,n=K;i.setRotationFromQuaternion(this.quaternion),i.transpose(n),i.scale(t,i),i.mmult(n,this.invInertiaWorld)}else;}},{key:"applyForce",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y;if(this.type===i.DYNAMIC){this.sleepState===i.SLEEPING&&this.wakeUp();var n=Z;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}}},{key:"applyLocalForce",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y;if(this.type===i.DYNAMIC){var n=Q,o=J;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,o),this.applyForce(n,o)}}},{key:"applyTorque",value:function(e){this.type===i.DYNAMIC&&(this.sleepState===i.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}},{key:"applyImpulse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y;if(this.type===i.DYNAMIC){this.sleepState===i.SLEEPING&&this.wakeUp();var n=t,o=$;o.copy(e),o.scale(this.invMass,o),this.velocity.vadd(o,this.velocity);var r=ee;n.cross(e,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}}},{key:"applyLocalImpulse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y;if(this.type===i.DYNAMIC){var n=te,o=ie;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,o),this.applyImpulse(n,o)}}},{key:"updateMassProperties",value:function(){var e=ne;this.invMass=this.mass>0?1/this.mass:0;var t=this.inertia,i=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),T.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!i?1/t.x:0,t.y>0&&!i?1/t.y:0,t.z>0&&!i?1/t.z:0),this.updateInertiaWorld(!0)}},{key:"getVelocityAtWorldPoint",value:function(e,t){var i=new y;return e.vsub(this.position,i),this.angularVelocity.cross(i,t),this.velocity.vadd(t,t),t}},{key:"integrate",value:function(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),(this.type===i.DYNAMIC||this.type===i.KINEMATIC)&&this.sleepState!==i.SLEEPING){var o=this.velocity,r=this.angularVelocity,a=this.position,s=this.force,l=this.torque,u=this.quaternion,h=this.invMass,c=this.invInertiaWorld,v=this.linearFactor,d=h*e;o.x+=s.x*d*v.x,o.y+=s.y*d*v.y,o.z+=s.z*d*v.z;var p=c.elements,y=this.angularFactor,f=l.x*y.x,m=l.y*y.y,w=l.z*y.z;r.x+=e*(p[0]*f+p[1]*m+p[2]*w),r.y+=e*(p[3]*f+p[4]*m+p[5]*w),r.z+=e*(p[6]*f+p[7]*m+p[8]*w),a.x+=o.x*e,a.y+=o.y*e,a.z+=o.z*e,u.integrate(this.angularVelocity,e,this.angularFactor,u),t&&(n?u.normalizeFast():u.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}}]),i}(E);D.idCounter=0,D.COLLIDE_EVENT_NAME="collide",D.DYNAMIC=L,D.STATIC=O,D.KINEMATIC=W,D.AWAKE=V,D.SLEEPY=_,D.SLEEPING=H,D.wakeupEvent={type:"wakeup"},D.sleepyEvent={type:"sleepy"},D.sleepEvent={type:"sleep"};var U=new y,G=new S,Y=new g,X=new d,K=new d,Z=new y,Q=new y,J=new y,$=new y,ee=new y,te=new y,ie=new y,ne=new y,oe=function(){function e(){h(this,e),this.world=void 0,this.useBoundingBoxes=void 0,this.dirty=void 0,this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}return v(e,[{key:"collisionPairs",value:function(e,t,i){throw new Error("collisionPairs not implemented for this BroadPhase class!")}},{key:"needBroadphaseCollision",value:function(e,t){return 0!=(e.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&e.collisionFilterMask)&&(0==(e.type&D.STATIC)&&e.sleepState!==D.SLEEPING||0==(t.type&D.STATIC)&&t.sleepState!==D.SLEEPING)}},{key:"intersectionTest",value:function(e,t,i,n){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,i,n):this.doBoundingSphereBroadphase(e,t,i,n)}},{key:"doBoundingSphereBroadphase",value:function(e,t,i,n){var o=re;t.position.vsub(e.position,o);var r=Math.pow(e.boundingRadius+t.boundingRadius,2);o.lengthSquared()<r&&(i.push(e),n.push(t))}},{key:"doBoundingBoxBroadphase",value:function(e,t,i,n){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(i.push(e),n.push(t))}},{key:"makePairsUnique",value:function(e,t){for(var i=ae,n=se,o=le,r=e.length,a=0;a!==r;a++)n[a]=e[a],o[a]=t[a];e.length=0,t.length=0;for(var s=0;s!==r;s++){var l=n[s].id,u=o[s].id,h=l<u?l+","+u:u+","+l;i[h]=s,i.keys.push(h)}for(var c=0;c!==i.keys.length;c++){var v=i.keys.pop(),d=i[v];e.push(n[d]),t.push(o[d]),delete i[v]}}},{key:"setWorld",value:function(e){}},{key:"aabbQuery",value:function(e,t,i){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}],[{key:"boundingSphereCheck",value:function(e,t){var i=new y;e.position.vsub(t.position,i);var n=e.shapes[0],o=t.shapes[0];return Math.pow(n.boundingSphereRadius+o.boundingSphereRadius,2)>i.lengthSquared()}}]),e}(),re=new y,ae={keys:[]},se=[],le=[],ue=(new y,function(e){o(i,e);var t=a(i);function i(){return h(this,i),t.call(this)}return v(i,[{key:"collisionPairs",value:function(e,t,i){for(var n,o,r=e.bodies,a=r.length,s=0;s!==a;s++)for(var l=0;l!==s;l++)n=r[s],o=r[l],this.needBroadphaseCollision(n,o)&&this.intersectionTest(n,o,t,i)}},{key:"aabbQuery",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=0;n<e.bodies.length;n++){var o=e.bodies[n];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(t)&&i.push(o)}return i}}]),i}(oe)),he=function(){function e(){h(this,e),this.rayFromWorld=void 0,this.rayToWorld=void 0,this.hitNormalWorld=void 0,this.hitPointWorld=void 0,this.hasHit=void 0,this.shape=void 0,this.body=void 0,this.hitFaceIndex=void 0,this.distance=void 0,this.shouldStop=void 0,this.rayFromWorld=new y,this.rayToWorld=new y,this.hitNormalWorld=new y,this.hitPointWorld=new y,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}return v(e,[{key:"reset",value:function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}},{key:"abort",value:function(){this.shouldStop=!0}},{key:"set",value:function(e,t,i,n,o,r,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(n),this.shape=o,this.body=r,this.distance=a}}]),e}(),ce=1,ve=2,de=4,pe=function(e,t,i,n,o,r,a){function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new y,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y;h(this,s),this.from=void 0,this.to=void 0,this.direction=void 0,this.precision=void 0,this.checkCollisionResponse=void 0,this.skipBackfaces=void 0,this.collisionFilterMask=void 0,this.collisionFilterGroup=void 0,this.mode=void 0,this.result=void 0,this.hasHit=void 0,this.callback=void 0,this.from=e.clone(),this.to=t.clone(),this.direction=new y,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=s.ANY,this.result=new he,this.hasHit=!1,this.callback=function(e){}}return v(s,[{key:e,get:function(){return this._intersectSphere}},{key:t,get:function(){return this._intersectPlane}},{key:i,get:function(){return this._intersectBox}},{key:n,get:function(){return this._intersectConvex}},{key:o,get:function(){return this._intersectConvex}},{key:r,get:function(){return this._intersectHeightfield}},{key:a,get:function(){return this._intersectTrimesh}},{key:"intersectWorld",value:function(e,t){return this.mode=t.mode||s.ANY,this.result=t.result||new he,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||function(){},this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(ye),fe.length=0,e.broadphase.aabbQuery(e,ye,fe),this.intersectBodies(fe),this.hasHit}},{key:"intersectBody",value:function(e,t){t&&(this.result=t,this.updateDirection());var i=this.checkCollisionResponse;if((!i||e.collisionResponse)&&0!=(this.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&this.collisionFilterMask))for(var n=ge,o=be,r=0,a=e.shapes.length;r<a;r++){var s=e.shapes[r];if((!i||s.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[r],o),e.quaternion.vmult(e.shapeOffsets[r],n),n.vadd(e.position,n),this.intersectShape(s,o,n,e),this.result.shouldStop))break}}},{key:"intersectBodies",value:function(e,t){t&&(this.result=t,this.updateDirection());for(var i=0,n=e.length;!this.result.shouldStop&&i<n;i++)this.intersectBody(e[i])}},{key:"updateDirection",value:function(){this.to.vsub(this.from,this.direction),this.direction.normalize()}},{key:"intersectShape",value:function(e,t,i,n){var o=function(e,t,i){i.vsub(e,Ve);var n=Ve.dot(t);return t.scale(n,_e),_e.vadd(e,_e),i.distanceTo(_e)}(this.from,this.direction,i);if(!(o>e.boundingSphereRadius)){var r=this[e.type];r&&r.call(this,e,t,i,n,e)}}},{key:"_intersectBox",value:function(e,t,i,n,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,i,n,o)}},{key:"_intersectPlane",value:function(e,t,i,n,o){var r=this.from,a=this.to,s=this.direction,l=new y(0,0,1);t.vmult(l,l);var u=new y;r.vsub(i,u);var h=u.dot(l);if(a.vsub(i,u),!(h*u.dot(l)>0||r.distanceTo(a)<h)){var c=l.dot(s);if(!(Math.abs(c)<this.precision)){var v=new y,d=new y,p=new y;r.vsub(i,v);var f=-l.dot(v)/c;s.scale(f,d),r.vadd(d,p),this.reportIntersection(l,p,o,n,-1)}}}},{key:"getAABB",value:function(e){var t=e.lowerBound,i=e.upperBound,n=this.to,o=this.from;t.x=Math.min(n.x,o.x),t.y=Math.min(n.y,o.y),t.z=Math.min(n.z,o.z),i.x=Math.max(n.x,o.x),i.y=Math.max(n.y,o.y),i.z=Math.max(n.z,o.z)}},{key:"_intersectHeightfield",value:function(e,t,i,n,o){e.data,e.elementSize;var r=Be;r.from.copy(this.from),r.to.copy(this.to),A.pointToLocalFrame(i,t,r.from,r.from),A.pointToLocalFrame(i,t,r.to,r.to),r.updateDirection();var a,s,l,u,h=Ae;a=s=0,l=u=e.data.length-1;var c=new g;r.getAABB(c),e.getIndexOfPosition(c.lowerBound.x,c.lowerBound.y,h,!0),a=Math.max(a,h[0]),s=Math.max(s,h[1]),e.getIndexOfPosition(c.upperBound.x,c.upperBound.y,h,!0),l=Math.min(l,h[0]+1),u=Math.min(u,h[1]+1);for(var v=a;v<l;v++)for(var d=s;d<u;d++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(v,d,c),c.overlapsRay(r)){if(e.getConvexTrianglePillar(v,d,!1),A.pointToWorldFrame(i,t,e.pillarOffset,Ce),this._intersectConvex(e.pillarConvex,t,Ce,n,o,ze),this.result.shouldStop)return;e.getConvexTrianglePillar(v,d,!0),A.pointToWorldFrame(i,t,e.pillarOffset,Ce),this._intersectConvex(e.pillarConvex,t,Ce,n,o,ze)}}}},{key:"_intersectSphere",value:function(e,t,i,n,o){var r=this.from,a=this.to,s=e.radius,l=Math.pow(a.x-r.x,2)+Math.pow(a.y-r.y,2)+Math.pow(a.z-r.z,2),u=2*((a.x-r.x)*(r.x-i.x)+(a.y-r.y)*(r.y-i.y)+(a.z-r.z)*(r.z-i.z)),h=Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2)+Math.pow(r.z-i.z,2)-Math.pow(s,2),c=Math.pow(u,2)-4*l*h,v=Me,d=Fe;if(!(c<0))if(0===c)r.lerp(a,c,v),v.vsub(i,d),d.normalize(),this.reportIntersection(d,v,o,n,-1);else{var p=(-u-Math.sqrt(c))/(2*l),y=(-u+Math.sqrt(c))/(2*l);if(p>=0&&p<=1&&(r.lerp(a,p,v),v.vsub(i,d),d.normalize(),this.reportIntersection(d,v,o,n,-1)),this.result.shouldStop)return;y>=0&&y<=1&&(r.lerp(a,y,v),v.vsub(i,d),d.normalize(),this.reportIntersection(d,v,o,n,-1))}}},{key:"_intersectConvex",value:function(e,t,i,n,o,r){for(var a=Pe,l=Re,u=r&&r.faceList||null,h=e.faces,c=e.vertices,v=e.faceNormals,d=this.direction,p=this.from,y=this.to,f=p.distanceTo(y),m=u?u.length:h.length,w=this.result,g=0;!w.shouldStop&&g<m;g++){var b=u?u[g]:g,x=h[b],k=v[b],E=t,S=i;l.copy(c[x[0]]),E.vmult(l,l),l.vadd(S,l),l.vsub(p,l),E.vmult(k,a);var z=d.dot(a);if(!(Math.abs(z)<this.precision)){var C=a.dot(l)/z;if(!(C<0)){d.scale(C,xe),xe.vadd(p,xe),ke.copy(c[x[0]]),E.vmult(ke,ke),S.vadd(ke,ke);for(var B=1;!w.shouldStop&&B<x.length-1;B++){Ee.copy(c[x[B]]),Se.copy(c[x[B+1]]),E.vmult(Ee,Ee),E.vmult(Se,Se),S.vadd(Ee,Ee),S.vadd(Se,Se);var A=xe.distanceTo(p);!s.pointInTriangle(xe,ke,Ee,Se)&&!s.pointInTriangle(xe,Ee,ke,Se)||A>f||this.reportIntersection(a,xe,o,n,b)}}}}}},{key:"_intersectTrimesh",value:function(e,t,i,n,o,r){var a=qe,l=Oe,u=We,h=Re,c=je,v=Te,d=Ne,p=Le,y=Ie,f=e.indices;e.vertices;var m=this.from,w=this.to,g=this.direction;u.position.copy(i),u.quaternion.copy(t),A.vectorToLocalFrame(i,t,g,c),A.pointToLocalFrame(i,t,m,v),A.pointToLocalFrame(i,t,w,d),d.x*=e.scale.x,d.y*=e.scale.y,d.z*=e.scale.z,v.x*=e.scale.x,v.y*=e.scale.y,v.z*=e.scale.z,d.vsub(v,c),c.normalize();var b=v.distanceSquared(d);e.tree.rayQuery(this,u,l);for(var x=0,k=l.length;!this.result.shouldStop&&x!==k;x++){var E=l[x];e.getNormal(E,a),e.getVertex(f[3*E],ke),ke.vsub(v,h);var S=c.dot(a),z=a.dot(h)/S;if(!(z<0)){c.scale(z,xe),xe.vadd(v,xe),e.getVertex(f[3*E+1],Ee),e.getVertex(f[3*E+2],Se);var C=xe.distanceSquared(v);!s.pointInTriangle(xe,Ee,ke,Se)&&!s.pointInTriangle(xe,ke,Ee,Se)||C>b||(A.vectorToWorldFrame(t,a,y),A.pointToWorldFrame(i,t,xe,p),this.reportIntersection(y,p,o,n,E))}}l.length=0}},{key:"reportIntersection",value:function(e,t,i,n,o){var r=this.from,a=this.to,l=r.distanceTo(t),u=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(u.hitFaceIndex=void 0!==o?o:-1,this.mode){case s.ALL:this.hasHit=!0,u.set(r,a,e,t,i,n,l),u.hasHit=!0,this.callback(u);break;case s.CLOSEST:(l<u.distance||!u.hasHit)&&(this.hasHit=!0,u.hasHit=!0,u.set(r,a,e,t,i,n,l));break;case s.ANY:this.hasHit=!0,u.hasHit=!0,u.set(r,a,e,t,i,n,l),u.shouldStop=!0}}}],[{key:"pointInTriangle",value:function(e,t,i,n){n.vsub(t,Ve),i.vsub(t,me),e.vsub(t,we);var o,r,a=Ve.dot(Ve),s=Ve.dot(me),l=Ve.dot(we),u=me.dot(me),h=me.dot(we);return(o=u*l-s*h)>=0&&(r=a*h-s*l)>=0&&o+r<a*u-s*s}}]),s}(B.types.SPHERE,B.types.PLANE,B.types.BOX,B.types.CYLINDER,B.types.CONVEXPOLYHEDRON,B.types.HEIGHTFIELD,B.types.TRIMESH);pe.CLOSEST=ce,pe.ANY=ve,pe.ALL=de;var ye=new g,fe=[],me=new y,we=new y,ge=new y,be=new S,xe=new y,ke=new y,Ee=new y,Se=new y,ze={faceList:[0]},Ce=new y,Be=new pe,Ae=[],Me=new y,Fe=new y,Pe=new y,Re=new y,qe=new y,je=new y,Te=new y,Ne=new y,Ie=new y,Le=new y;new g;var Oe=[],We=new A,Ve=new y,_e=new y;var He=function(){function e(){h(this,e)}return v(e,null,[{key:"defaults",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;for(var i in t)i in e||(e[i]=t[i]);return e}}]),e}(),De=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};h(this,e),this.equations=void 0,this.bodyA=void 0,this.bodyB=void 0,this.id=void 0,this.collideConnected=void 0,n=He.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=i,this.id=e.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),i&&i.wakeUp())}return v(e,[{key:"update",value:function(){throw new Error("method update() not implmemented in this Constraint subclass!")}},{key:"enable",value:function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!0}},{key:"disable",value:function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!1}}]),e}();De.idCounter=0;var Ue=function(){function e(){h(this,e),this.spatial=void 0,this.rotational=void 0,this.spatial=new y,this.rotational=new y}return v(e,[{key:"multiplyElement",value:function(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}},{key:"multiplyVectors",value:function(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}]),e}(),Ge=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1e6,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e6;h(this,e),this.id=void 0,this.minForce=void 0,this.maxForce=void 0,this.bi=void 0,this.bj=void 0,this.si=void 0,this.sj=void 0,this.a=void 0,this.b=void 0,this.eps=void 0,this.jacobianElementA=void 0,this.jacobianElementB=void 0,this.enabled=void 0,this.multiplier=void 0,this.id=e.idCounter++,this.minForce=n,this.maxForce=o,this.bi=t,this.bj=i,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Ue,this.jacobianElementB=new Ue,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}return v(e,[{key:"setSpookParams",value:function(e,t,i){var n=t,o=e,r=i;this.a=4/(r*(1+4*n)),this.b=4*n/(1+4*n),this.eps=4/(r*r*o*(1+4*n))}},{key:"computeB",value:function(e,t,i){var n=this.computeGW();return-this.computeGq()*e-n*t-this.computeGiMf()*i}},{key:"computeGq",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.position,r=n.position;return e.spatial.dot(o)+t.spatial.dot(r)}},{key:"computeGW",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.velocity,r=n.velocity,a=i.angularVelocity,s=n.angularVelocity;return e.multiplyVectors(o,a)+t.multiplyVectors(r,s)}},{key:"computeGWlambda",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.vlambda,r=n.vlambda,a=i.wlambda,s=n.wlambda;return e.multiplyVectors(o,a)+t.multiplyVectors(r,s)}},{key:"computeGiMf",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.force,r=i.torque,a=n.force,s=n.torque,l=i.invMassSolve,u=n.invMassSolve;return o.scale(l,Ye),a.scale(u,Xe),i.invInertiaWorldSolve.vmult(r,Ke),n.invInertiaWorldSolve.vmult(s,Ze),e.multiplyVectors(Ye,Ke)+t.multiplyVectors(Xe,Ze)}},{key:"computeGiMGt",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.invMassSolve,r=n.invMassSolve,a=i.invInertiaWorldSolve,s=n.invInertiaWorldSolve,l=o+r;return a.vmult(e.rotational,Qe),l+=Qe.dot(e.rotational),s.vmult(t.rotational,Qe),l+=Qe.dot(t.rotational)}},{key:"addToWlambda",value:function(e){var t=this.jacobianElementA,i=this.jacobianElementB,n=this.bi,o=this.bj,r=Je;n.vlambda.addScaledVector(n.invMassSolve*e,t.spatial,n.vlambda),o.vlambda.addScaledVector(o.invMassSolve*e,i.spatial,o.vlambda),n.invInertiaWorldSolve.vmult(t.rotational,r),n.wlambda.addScaledVector(e,r,n.wlambda),o.invInertiaWorldSolve.vmult(i.rotational,r),o.wlambda.addScaledVector(e,r,o.wlambda)}},{key:"computeC",value:function(){return this.computeGiMGt()+this.eps}}]),e}();Ge.idCounter=0;var Ye=new y,Xe=new y,Ke=new y,Ze=new y,Qe=new y,Je=new y,$e=function(e){o(i,e);var t=a(i);function i(e,n){var o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e6;return h(this,i),(o=t.call(this,e,n,0,r)).restitution=void 0,o.ri=void 0,o.rj=void 0,o.ni=void 0,o.restitution=0,o.ri=new y,o.rj=new y,o.ni=new y,o}return v(i,[{key:"computeB",value:function(e){var t=this.a,i=this.b,n=this.bi,o=this.bj,r=this.ri,a=this.rj,s=et,l=tt,u=n.velocity,h=n.angularVelocity;n.force,n.torque;var c=o.velocity,v=o.angularVelocity;o.force,o.torque;var d=it,p=this.jacobianElementA,y=this.jacobianElementB,f=this.ni;r.cross(f,s),a.cross(f,l),f.negate(p.spatial),s.negate(p.rotational),y.spatial.copy(f),y.rotational.copy(l),d.copy(o.position),d.vadd(a,d),d.vsub(n.position,d),d.vsub(r,d);var m=f.dot(d),w=this.restitution+1;return-m*t-(w*c.dot(f)-w*u.dot(f)+v.dot(l)-h.dot(s))*i-e*this.computeGiMf()}},{key:"getImpactVelocityAlongNormal",value:function(){var e=nt,t=ot,i=rt,n=at,o=st;return this.bi.position.vadd(this.ri,i),this.bj.position.vadd(this.rj,n),this.bi.getVelocityAtWorldPoint(i,e),this.bj.getVelocityAtWorldPoint(n,t),e.vsub(t,o),this.ni.dot(o)}}]),i}(Ge),et=new y,tt=new y,it=new y,nt=new y,ot=new y,rt=new y,at=new y,st=new y,lt=(new y,new y,new y,new y,new y,new y,function(e){o(i,e);var t=a(i);function i(e,n,o){var r;return h(this,i),(r=t.call(this,e,n,-o,o)).ri=void 0,r.rj=void 0,r.t=void 0,r.ri=new y,r.rj=new y,r.t=new y,r}return v(i,[{key:"computeB",value:function(e){this.a;var t=this.b;this.bi,this.bj;var i=this.ri,n=this.rj,o=ut,r=ht,a=this.t;i.cross(a,o),n.cross(a,r);var s=this.jacobianElementA,l=this.jacobianElementB;return a.negate(s.spatial),o.negate(s.rotational),l.spatial.copy(a),l.rotational.copy(r),-this.computeGW()*t-e*this.computeGiMf()}}]),i}(Ge)),ut=new y,ht=new y,ct=v((function e(t,i,n){h(this,e),this.id=void 0,this.materials=void 0,this.friction=void 0,this.restitution=void 0,this.contactEquationStiffness=void 0,this.contactEquationRelaxation=void 0,this.frictionEquationStiffness=void 0,this.frictionEquationRelaxation=void 0,n=He.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=e.idCounter++,this.materials=[t,i],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}));ct.idCounter=0;var vt=v((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,e),this.name=void 0,this.id=void 0,this.friction=void 0,this.restitution=void 0;var i="";"string"==typeof t&&(i=t,t={}),this.name=i,this.id=e.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}));vt.idCounter=0;new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y;new pe;new y,new y,new y(1,0,0),new y(0,1,0),new y(0,0,1),new y,new y,new y,new y;new y,new y,new y,new y;new y,new y,new y;var dt=function(e){o(i,e);var t=a(i);function i(e){var n;if(h(this,i),(n=t.call(this,{type:B.types.SPHERE})).radius=void 0,n.radius=void 0!==e?e:1,n.radius<0)throw new Error("The sphere radius cannot be negative.");return n.updateBoundingSphereRadius(),n}return v(i,[{key:"calculateLocalInertia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new y,i=2*e*this.radius*this.radius/5;return t.x=i,t.y=i,t.z=i,t}},{key:"volume",value:function(){return 4*Math.PI*Math.pow(this.radius,3)/3}},{key:"updateBoundingSphereRadius",value:function(){this.boundingSphereRadius=this.radius}},{key:"calculateWorldAABB",value:function(e,t,i,n){for(var o=this.radius,r=["x","y","z"],a=0;a<r.length;a++){var s=r[a];i[s]=e[s]-o,n[s]=e[s]+o}}}]),i}(B);new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y,new y;new y,new g,new y,new g,new y,new y,new y,new y,new y,new y,new y,new g,new y,new A,new g;var pt=function(){function e(){h(this,e),this.equations=void 0,this.equations=[]}return v(e,[{key:"solve",value:function(e,t){return 0}},{key:"addEquation",value:function(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}},{key:"removeEquation",value:function(e){var t=this.equations,i=t.indexOf(e);-1!==i&&t.splice(i,1)}},{key:"removeAllEquations",value:function(){this.equations.length=0}}]),e}(),yt=function(e){o(i,e);var t=a(i);function i(){var e;return h(this,i),(e=t.call(this)).iterations=void 0,e.tolerance=void 0,e.iterations=10,e.tolerance=1e-7,e}return v(i,[{key:"solve",value:function(e,t){var i,n,o,r,a,s=0,l=this.iterations,u=this.tolerance*this.tolerance,h=this.equations,c=h.length,v=t.bodies,d=v.length,p=e;if(0!==c)for(var y=0;y!==d;y++)v[y].updateSolveMassProperties();var f=mt,m=wt,w=ft;f.length=c,m.length=c,w.length=c;for(var g=0;g!==c;g++){var b=h[g];w[g]=0,m[g]=b.computeB(p),f[g]=1/b.computeC()}if(0!==c){for(var x=0;x!==d;x++){var k=v[x],E=k.vlambda,S=k.wlambda;E.set(0,0,0),S.set(0,0,0)}for(s=0;s!==l;s++){r=0;for(var z=0;z!==c;z++){var C=h[z];i=m[z],n=f[z],(a=w[z])+(o=n*(i-C.computeGWlambda()-C.eps*a))<C.minForce?o=C.minForce-a:a+o>C.maxForce&&(o=C.maxForce-a),w[z]+=o,r+=o>0?o:-o,C.addToWlambda(o)}if(r*r<u)break}for(var B=0;B!==d;B++){var A=v[B],M=A.velocity,F=A.angularVelocity;A.vlambda.vmul(A.linearFactor,A.vlambda),M.vadd(A.vlambda,M),A.wlambda.vmul(A.angularFactor,A.wlambda),F.vadd(A.wlambda,F)}for(var P=h.length,R=1/p;P--;)h[P].multiplier=w[P]*R}return s}}]),i}(pt),ft=[],mt=[],wt=[];D.STATIC;var gt=function(e){o(i,e);var t=a(i);function i(){var e;h(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).type=y,e}return v(i,[{key:"constructObject",value:function(){return new y}}]),i}(function(){function e(){h(this,e),this.objects=[],this.type=Object}return v(e,[{key:"release",value:function(){for(var e=arguments.length,t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}},{key:"get",value:function(){return 0===this.objects.length?this.constructObject():this.objects.pop()}},{key:"constructObject",value:function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{key:"resize",value:function(e){for(var t=this.objects;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}]),e}()),bt={sphereSphere:B.types.SPHERE,spherePlane:B.types.SPHERE|B.types.PLANE,boxBox:B.types.BOX|B.types.BOX,sphereBox:B.types.SPHERE|B.types.BOX,planeBox:B.types.PLANE|B.types.BOX,convexConvex:B.types.CONVEXPOLYHEDRON,sphereConvex:B.types.SPHERE|B.types.CONVEXPOLYHEDRON,planeConvex:B.types.PLANE|B.types.CONVEXPOLYHEDRON,boxConvex:B.types.BOX|B.types.CONVEXPOLYHEDRON,sphereHeightfield:B.types.SPHERE|B.types.HEIGHTFIELD,boxHeightfield:B.types.BOX|B.types.HEIGHTFIELD,convexHeightfield:B.types.CONVEXPOLYHEDRON|B.types.HEIGHTFIELD,sphereParticle:B.types.PARTICLE|B.types.SPHERE,planeParticle:B.types.PLANE|B.types.PARTICLE,boxParticle:B.types.BOX|B.types.PARTICLE,convexParticle:B.types.PARTICLE|B.types.CONVEXPOLYHEDRON,cylinderCylinder:B.types.CYLINDER,sphereCylinder:B.types.SPHERE|B.types.CYLINDER,planeCylinder:B.types.PLANE|B.types.CYLINDER,boxCylinder:B.types.BOX|B.types.CYLINDER,convexCylinder:B.types.CONVEXPOLYHEDRON|B.types.CYLINDER,heightfieldCylinder:B.types.HEIGHTFIELD|B.types.CYLINDER,particleCylinder:B.types.PARTICLE|B.types.CYLINDER,sphereTrimesh:B.types.SPHERE|B.types.TRIMESH,planeTrimesh:B.types.PLANE|B.types.TRIMESH},xt=function(e,t,i,n,o,r,a,s,l,u,c,d,p,f,m,w,g,b,x,k,E,S,z,C,B){function M(e){h(this,M),this.contactPointPool=void 0,this.frictionEquationPool=void 0,this.result=void 0,this.frictionResult=void 0,this.v3pool=void 0,this.world=void 0,this.currentContactMaterial=void 0,this.enableFrictionReduction=void 0,this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new gt,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}return v(M,[{key:e,get:function(){return this.sphereSphere}},{key:t,get:function(){return this.spherePlane}},{key:i,get:function(){return this.boxBox}},{key:n,get:function(){return this.sphereBox}},{key:o,get:function(){return this.planeBox}},{key:r,get:function(){return this.convexConvex}},{key:a,get:function(){return this.sphereConvex}},{key:s,get:function(){return this.planeConvex}},{key:l,get:function(){return this.boxConvex}},{key:u,get:function(){return this.sphereHeightfield}},{key:c,get:function(){return this.boxHeightfield}},{key:d,get:function(){return this.convexHeightfield}},{key:p,get:function(){return this.sphereParticle}},{key:f,get:function(){return this.planeParticle}},{key:m,get:function(){return this.boxParticle}},{key:w,get:function(){return this.convexParticle}},{key:g,get:function(){return this.convexConvex}},{key:b,get:function(){return this.sphereConvex}},{key:x,get:function(){return this.planeConvex}},{key:k,get:function(){return this.boxConvex}},{key:E,get:function(){return this.convexConvex}},{key:S,get:function(){return this.heightfieldCylinder}},{key:z,get:function(){return this.particleCylinder}},{key:C,get:function(){return this.sphereTrimesh}},{key:B,get:function(){return this.planeTrimesh}},{key:"createContactEquation",value:function(e,t,i,n,o,r){var a;this.contactPointPool.length?((a=this.contactPointPool.pop()).bi=e,a.bj=t):a=new $e(e,t),a.enabled=e.collisionResponse&&t.collisionResponse&&i.collisionResponse&&n.collisionResponse;var s=this.currentContactMaterial;a.restitution=s.restitution,a.setSpookParams(s.contactEquationStiffness,s.contactEquationRelaxation,this.world.dt);var l=i.material||e.material,u=n.material||t.material;return l&&u&&l.restitution>=0&&u.restitution>=0&&(a.restitution=l.restitution*u.restitution),a.si=o||i,a.sj=r||n,a}},{key:"createFrictionEquationsFromContact",value:function(e,t){var i=e.bi,n=e.bj,o=e.si,r=e.sj,a=this.world,s=this.currentContactMaterial,l=s.friction,u=o.material||i.material,h=r.material||n.material;if(u&&h&&u.friction>=0&&h.friction>=0&&(l=u.friction*h.friction),l>0){var c=l*a.gravity.length(),v=i.invMass+n.invMass;v>0&&(v=1/v);var d=this.frictionEquationPool,p=d.length?d.pop():new lt(i,n,c*v),y=d.length?d.pop():new lt(i,n,c*v);return p.bi=y.bi=i,p.bj=y.bj=n,p.minForce=y.minForce=-c*v,p.maxForce=y.maxForce=c*v,p.ri.copy(e.ri),p.rj.copy(e.rj),y.ri.copy(e.ri),y.rj.copy(e.rj),e.ni.tangents(p.t,y.t),p.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),y.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),p.enabled=y.enabled=e.enabled,t.push(p,y),!0}return!1}},{key:"createFrictionFromAverage",value:function(e){var t=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(t,this.frictionResult)&&1!==e){var i=this.frictionResult[this.frictionResult.length-2],n=this.frictionResult[this.frictionResult.length-1];kt.setZero(),Et.setZero(),St.setZero();var o=t.bi;t.bj;for(var r=0;r!==e;r++)(t=this.result[this.result.length-1-r]).bi!==o?(kt.vadd(t.ni,kt),Et.vadd(t.ri,Et),St.vadd(t.rj,St)):(kt.vsub(t.ni,kt),Et.vadd(t.rj,Et),St.vadd(t.ri,St));var a=1/e;Et.scale(a,i.ri),St.scale(a,i.rj),n.ri.copy(i.ri),n.rj.copy(i.rj),kt.normalize(),kt.tangents(i.t,n.t)}}},{key:"getContacts",value:function(e,t,i,n,o,r,a){this.contactPointPool=o,this.frictionEquationPool=a,this.result=n,this.frictionResult=r;for(var s=Bt,l=At,u=zt,h=Ct,c=0,v=e.length;c!==v;c++){var d=e[c],p=t[c],y=null;d.material&&p.material&&(y=i.getContactMaterial(d.material,p.material)||null);for(var f=d.type&D.KINEMATIC&&p.type&D.STATIC||d.type&D.STATIC&&p.type&D.KINEMATIC||d.type&D.KINEMATIC&&p.type&D.KINEMATIC,m=0;m<d.shapes.length;m++){d.quaternion.mult(d.shapeOrientations[m],s),d.quaternion.vmult(d.shapeOffsets[m],u),u.vadd(d.position,u);for(var w=d.shapes[m],g=0;g<p.shapes.length;g++){p.quaternion.mult(p.shapeOrientations[g],l),p.quaternion.vmult(p.shapeOffsets[g],h),h.vadd(p.position,h);var b=p.shapes[g];if(w.collisionFilterMask&b.collisionFilterGroup&&b.collisionFilterMask&w.collisionFilterGroup&&!(u.distanceTo(h)>w.boundingSphereRadius+b.boundingSphereRadius)){var x=null;w.material&&b.material&&(x=i.getContactMaterial(w.material,b.material)||null),this.currentContactMaterial=x||y||i.defaultContactMaterial;var k=this[w.type|b.type];if(k){(w.type<b.type?k.call(this,w,b,u,h,s,l,d,p,w,b,f):k.call(this,b,w,h,u,l,s,p,d,w,b,f))&&f&&(i.shapeOverlapKeeper.set(w.id,b.id),i.bodyOverlapKeeper.set(d.id,p.id))}}}}}}},{key:"sphereSphere",value:function(e,t,i,n,o,r,a,s,l,u,h){if(h)return i.distanceSquared(n)<Math.pow(e.radius+t.radius,2);var c=this.createContactEquation(a,s,e,t,l,u);n.vsub(i,c.ni),c.ni.normalize(),c.ri.copy(c.ni),c.rj.copy(c.ni),c.ri.scale(e.radius,c.ri),c.rj.scale(-t.radius,c.rj),c.ri.vadd(i,c.ri),c.ri.vsub(a.position,c.ri),c.rj.vadd(n,c.rj),c.rj.vsub(s.position,c.rj),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}},{key:"spherePlane",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=this.createContactEquation(a,s,e,t,l,u);if(c.ni.set(0,0,1),r.vmult(c.ni,c.ni),c.ni.negate(c.ni),c.ni.normalize(),c.ni.scale(e.radius,c.ri),i.vsub(n,Yt),c.ni.scale(c.ni.dot(Yt),Xt),Yt.vsub(Xt,c.rj),-Yt.dot(c.ni)<=e.radius){if(h)return!0;var v=c.ri,d=c.rj;v.vadd(i,v),v.vsub(a.position,v),d.vadd(n,d),d.vsub(s.position,d),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}}},{key:"boxBox",value:function(e,t,i,n,o,r,a,s,l,u,h){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,i,n,o,r,a,s,e,t,h)}},{key:"sphereBox",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=this.v3pool,v=ni;i.vsub(n,$t),t.getSideNormals(v,r);for(var d=e.radius,p=!1,y=ri,f=ai,m=si,w=null,g=0,b=0,x=0,k=null,E=0,S=v.length;E!==S&&!1===p;E++){var z=ei;z.copy(v[E]);var C=z.length();z.normalize();var B=$t.dot(z);if(B<C+d&&B>0){var A=ti,M=ii;A.copy(v[(E+1)%3]),M.copy(v[(E+2)%3]);var F=A.length(),P=M.length();A.normalize(),M.normalize();var R=$t.dot(A),q=$t.dot(M);if(R<F&&R>-F&&q<P&&q>-P){var j=Math.abs(B-C-d);if((null===k||j<k)&&(k=j,b=R,x=q,w=C,y.copy(z),f.copy(A),m.copy(M),g++,h))return!0}}}if(g){p=!0;var T=this.createContactEquation(a,s,e,t,l,u);y.scale(-d,T.ri),T.ni.copy(y),T.ni.negate(T.ni),y.scale(w,y),f.scale(b,f),y.vadd(f,y),m.scale(x,m),y.vadd(m,T.rj),T.ri.vadd(i,T.ri),T.ri.vsub(a.position,T.ri),T.rj.vadd(n,T.rj),T.rj.vsub(s.position,T.rj),this.result.push(T),this.createFrictionEquationsFromContact(T,this.frictionResult)}for(var N=c.get(),I=oi,L=0;2!==L&&!p;L++)for(var O=0;2!==O&&!p;O++)for(var W=0;2!==W&&!p;W++)if(N.set(0,0,0),L?N.vadd(v[0],N):N.vsub(v[0],N),O?N.vadd(v[1],N):N.vsub(v[1],N),W?N.vadd(v[2],N):N.vsub(v[2],N),n.vadd(N,I),I.vsub(i,I),I.lengthSquared()<d*d){if(h)return!0;p=!0;var V=this.createContactEquation(a,s,e,t,l,u);V.ri.copy(I),V.ri.normalize(),V.ni.copy(V.ri),V.ri.scale(d,V.ri),V.rj.copy(N),V.ri.vadd(i,V.ri),V.ri.vsub(a.position,V.ri),V.rj.vadd(n,V.rj),V.rj.vsub(s.position,V.rj),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult)}c.release(N),N=null;for(var _=c.get(),H=c.get(),D=c.get(),U=c.get(),G=c.get(),Y=v.length,X=0;X!==Y&&!p;X++)for(var K=0;K!==Y&&!p;K++)if(X%3!=K%3){v[K].cross(v[X],_),_.normalize(),v[X].vadd(v[K],H),D.copy(i),D.vsub(H,D),D.vsub(n,D);var Z=D.dot(_);_.scale(Z,U);for(var Q=0;Q===X%3||Q===K%3;)Q++;G.copy(i),G.vsub(U,G),G.vsub(H,G),G.vsub(n,G);var J=Math.abs(Z),$=G.length();if(J<v[Q].length()&&$<d){if(h)return!0;p=!0;var ee=this.createContactEquation(a,s,e,t,l,u);H.vadd(U,ee.rj),ee.rj.copy(ee.rj),G.negate(ee.ni),ee.ni.normalize(),ee.ri.copy(ee.rj),ee.ri.vadd(n,ee.ri),ee.ri.vsub(i,ee.ri),ee.ri.normalize(),ee.ri.scale(d,ee.ri),ee.ri.vadd(i,ee.ri),ee.ri.vsub(a.position,ee.ri),ee.rj.vadd(n,ee.rj),ee.rj.vsub(s.position,ee.rj),this.result.push(ee),this.createFrictionEquationsFromContact(ee,this.frictionResult)}}c.release(_,H,D,U,G)}},{key:"planeBox",value:function(e,t,i,n,o,r,a,s,l,u,h){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,i,n,o,r,a,s,e,t,h)}},{key:"convexConvex",value:function(e,t,i,n,o,r,a,s,l,u,h,c,v){var d=ki;if(!(i.distanceTo(n)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,i,o,n,r,d,c,v)){var p=[],y=Ei;e.clipAgainstHull(i,o,t,n,r,d,-100,100,p);for(var f=0,m=0;m!==p.length;m++){if(h)return!0;var w=this.createContactEquation(a,s,e,t,l,u),g=w.ri,b=w.rj;d.negate(w.ni),p[m].normal.negate(y),y.scale(p[m].depth,y),p[m].point.vadd(y,g),b.copy(p[m].point),g.vsub(i,g),b.vsub(n,b),g.vadd(i,g),g.vsub(a.position,g),b.vadd(n,b),b.vsub(s.position,b),this.result.push(w),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(w,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}}},{key:"sphereConvex",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=this.v3pool;i.vsub(n,li);for(var v=t.faceNormals,d=t.faces,p=t.vertices,y=e.radius,f=!1,m=0;m!==p.length;m++){var w=p[m],g=vi;r.vmult(w,g),n.vadd(g,g);var b=ci;if(g.vsub(i,b),b.lengthSquared()<y*y){if(h)return!0;f=!0;var x=this.createContactEquation(a,s,e,t,l,u);return x.ri.copy(b),x.ri.normalize(),x.ni.copy(x.ri),x.ri.scale(y,x.ri),g.vsub(n,x.rj),x.ri.vadd(i,x.ri),x.ri.vsub(a.position,x.ri),x.rj.vadd(n,x.rj),x.rj.vsub(s.position,x.rj),this.result.push(x),void this.createFrictionEquationsFromContact(x,this.frictionResult)}}for(var k=0,E=d.length;k!==E&&!1===f;k++){var S=v[k],z=d[k],C=di;r.vmult(S,C);var B=pi;r.vmult(p[z[0]],B),B.vadd(n,B);var A=yi;C.scale(-y,A),i.vadd(A,A);var M=fi;A.vsub(B,M);var F=M.dot(C),P=mi;if(i.vsub(B,P),F<0&&P.dot(C)>0){for(var R=[],q=0,j=z.length;q!==j;q++){var T=c.get();r.vmult(p[z[q]],T),n.vadd(T,T),R.push(T)}if(Jt(R,C,i)){if(h)return!0;f=!0;var N=this.createContactEquation(a,s,e,t,l,u);C.scale(-y,N.ri),C.negate(N.ni);var I=c.get();C.scale(-F,I);var L=c.get();C.scale(-y,L),i.vsub(n,N.rj),N.rj.vadd(L,N.rj),N.rj.vadd(I,N.rj),N.rj.vadd(n,N.rj),N.rj.vsub(s.position,N.rj),N.ri.vadd(i,N.ri),N.ri.vsub(a.position,N.ri),c.release(I),c.release(L),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult);for(var O=0,W=R.length;O!==W;O++)c.release(R[O]);return}for(var V=0;V!==z.length;V++){var _=c.get(),H=c.get();r.vmult(p[z[(V+1)%z.length]],_),r.vmult(p[z[(V+2)%z.length]],H),n.vadd(_,_),n.vadd(H,H);var D=ui;H.vsub(_,D);var U=hi;D.unit(U);var G=c.get(),Y=c.get();i.vsub(_,Y);var X=Y.dot(U);U.scale(X,G),G.vadd(_,G);var K=c.get();if(G.vsub(i,K),X>0&&X*X<D.lengthSquared()&&K.lengthSquared()<y*y){if(h)return!0;var Z=this.createContactEquation(a,s,e,t,l,u);G.vsub(n,Z.rj),G.vsub(i,Z.ni),Z.ni.normalize(),Z.ni.scale(y,Z.ri),Z.rj.vadd(n,Z.rj),Z.rj.vsub(s.position,Z.rj),Z.ri.vadd(i,Z.ri),Z.ri.vsub(a.position,Z.ri),this.result.push(Z),this.createFrictionEquationsFromContact(Z,this.frictionResult);for(var Q=0,J=R.length;Q!==J;Q++)c.release(R[Q]);return c.release(_),c.release(H),c.release(G),c.release(K),void c.release(Y)}c.release(_),c.release(H),c.release(G),c.release(K),c.release(Y)}for(var $=0,ee=R.length;$!==ee;$++)c.release(R[$])}}}},{key:"planeConvex",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=wi,v=gi;v.set(0,0,1),o.vmult(v,v);for(var d=0,p=bi,y=0;y!==t.vertices.length;y++){if(c.copy(t.vertices[y]),r.vmult(c,c),n.vadd(c,c),c.vsub(i,p),v.dot(p)<=0){if(h)return!0;var f=this.createContactEquation(a,s,e,t,l,u),m=xi;v.scale(v.dot(p),m),c.vsub(m,m),m.vsub(i,f.ri),f.ni.copy(v),c.vsub(n,f.rj),f.ri.vadd(i,f.ri),f.ri.vsub(a.position,f.ri),f.rj.vadd(n,f.rj),f.rj.vsub(s.position,f.rj),this.result.push(f),d++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(f,this.frictionResult)}}this.enableFrictionReduction&&d&&this.createFrictionFromAverage(d)}},{key:"boxConvex",value:function(e,t,i,n,o,r,a,s,l,u,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,i,n,o,r,a,s,e,t,h)}},{key:"sphereHeightfield",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=t.data,v=e.radius,d=t.elementSize,p=Ii,y=Ni;A.pointToLocalFrame(n,r,i,y);var f=Math.floor((y.x-v)/d)-1,m=Math.ceil((y.x+v)/d)+1,w=Math.floor((y.y-v)/d)-1,g=Math.ceil((y.y+v)/d)+1;if(!(m<0||g<0||f>c.length||w>c[0].length)){f<0&&(f=0),m<0&&(m=0),w<0&&(w=0),g<0&&(g=0),f>=c.length&&(f=c.length-1),m>=c.length&&(m=c.length-1),g>=c[0].length&&(g=c[0].length-1),w>=c[0].length&&(w=c[0].length-1);var b=[];t.getRectMinMax(f,w,m,g,b);var x=b[0],k=b[1];if(!(y.z-v>k||y.z+v<x))for(var E=this.result,S=f;S<m;S++)for(var z=w;z<g;z++){var C=E.length,B=!1;if(t.getConvexTrianglePillar(S,z,!1),A.pointToWorldFrame(n,r,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(B=this.sphereConvex(e,t.pillarConvex,i,p,o,r,a,s,e,t,h)),h&&B)return!0;if(t.getConvexTrianglePillar(S,z,!0),A.pointToWorldFrame(n,r,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(B=this.sphereConvex(e,t.pillarConvex,i,p,o,r,a,s,e,t,h)),h&&B)return!0;if(E.length-C>2)return}}}},{key:"boxHeightfield",value:function(e,t,i,n,o,r,a,s,l,u,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,i,n,o,r,a,s,e,t,h)}},{key:"convexHeightfield",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=t.data,v=t.elementSize,d=e.boundingSphereRadius,p=ji,y=Ti,f=qi;A.pointToLocalFrame(n,r,i,f);var m=Math.floor((f.x-d)/v)-1,w=Math.ceil((f.x+d)/v)+1,g=Math.floor((f.y-d)/v)-1,b=Math.ceil((f.y+d)/v)+1;if(!(w<0||b<0||m>c.length||g>c[0].length)){m<0&&(m=0),w<0&&(w=0),g<0&&(g=0),b<0&&(b=0),m>=c.length&&(m=c.length-1),w>=c.length&&(w=c.length-1),b>=c[0].length&&(b=c[0].length-1),g>=c[0].length&&(g=c[0].length-1);var x=[];t.getRectMinMax(m,g,w,b,x);var k=x[0],E=x[1];if(!(f.z-d>E||f.z+d<k))for(var S=m;S<w;S++)for(var z=g;z<b;z++){var C=!1;if(t.getConvexTrianglePillar(S,z,!1),A.pointToWorldFrame(n,r,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(C=this.convexConvex(e,t.pillarConvex,i,p,o,r,a,s,null,null,h,y,null)),h&&C)return!0;if(t.getConvexTrianglePillar(S,z,!0),A.pointToWorldFrame(n,r,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(C=this.convexConvex(e,t.pillarConvex,i,p,o,r,a,s,null,null,h,y,null)),h&&C)return!0}}}},{key:"sphereParticle",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=Bi;if(c.set(0,0,1),n.vsub(i,c),c.lengthSquared()<=e.radius*e.radius){if(h)return!0;var v=this.createContactEquation(s,a,t,e,l,u);c.normalize(),v.rj.copy(c),v.rj.scale(e.radius,v.rj),v.ni.copy(c),v.ni.negate(v.ni),v.ri.set(0,0,0),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}},{key:"planeParticle",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=Si;c.set(0,0,1),a.quaternion.vmult(c,c);var v=zi;if(n.vsub(a.position,v),c.dot(v)<=0){if(h)return!0;var d=this.createContactEquation(s,a,t,e,l,u);d.ni.copy(c),d.ni.negate(d.ni),d.ri.set(0,0,0);var p=Ci;c.scale(c.dot(n),p),n.vsub(p,p),d.rj.copy(p),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}}},{key:"boxParticle",value:function(e,t,i,n,o,r,a,s,l,u,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,i,n,o,r,a,s,e,t,h)}},{key:"convexParticle",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=-1,v=Fi,d=Ri,p=null,y=Mi;if(y.copy(n),y.vsub(i,y),o.conjugate(Ai),Ai.vmult(y,y),e.pointIsInside(y)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(i,o),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(o);for(var f=0,m=e.faces.length;f!==m;f++){var w=[e.worldVertices[e.faces[f][0]]],g=e.worldFaceNormals[f];n.vsub(w[0],Pi);var b=-g.dot(Pi);if(null===p||Math.abs(b)<Math.abs(p)){if(h)return!0;p=b,c=f,v.copy(g)}}if(-1!==c){var x=this.createContactEquation(s,a,t,e,l,u);v.scale(p,d),d.vadd(n,d),d.vsub(i,d),x.rj.copy(d),v.negate(x.ni),x.ri.set(0,0,0);var k=x.ri,E=x.rj;k.vadd(n,k),k.vsub(s.position,k),E.vadd(i,E),E.vsub(a.position,E),this.result.push(x),this.createFrictionEquationsFromContact(x,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}},{key:"heightfieldCylinder",value:function(e,t,i,n,o,r,a,s,l,u,h){return this.convexHeightfield(t,e,n,i,r,o,s,a,l,u,h)}},{key:"particleCylinder",value:function(e,t,i,n,o,r,a,s,l,u,h){return this.convexParticle(t,e,n,i,r,o,s,a,l,u,h)}},{key:"sphereTrimesh",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=Nt,v=It,d=Lt,p=Ot,y=Wt,f=Vt,m=Ut,w=Tt,g=qt,b=Gt;A.pointToLocalFrame(n,r,i,y);var x=e.radius;m.lowerBound.set(y.x-x,y.y-x,y.z-x),m.upperBound.set(y.x+x,y.y+x,y.z+x),t.getTrianglesInAABB(m,b);for(var k=jt,E=e.radius*e.radius,S=0;S<b.length;S++)for(var z=0;z<3;z++)if(t.getVertex(t.indices[3*b[S]+z],k),k.vsub(y,g),g.lengthSquared()<=E){if(w.copy(k),A.pointToWorldFrame(n,r,w,k),k.vsub(i,g),h)return!0;var C=this.createContactEquation(a,s,e,t,l,u);C.ni.copy(g),C.ni.normalize(),C.ri.copy(C.ni),C.ri.scale(e.radius,C.ri),C.ri.vadd(i,C.ri),C.ri.vsub(a.position,C.ri),C.rj.copy(k),C.rj.vsub(s.position,C.rj),this.result.push(C),this.createFrictionEquationsFromContact(C,this.frictionResult)}for(var B=0;B<b.length;B++)for(var M=0;M<3;M++){t.getVertex(t.indices[3*b[B]+M],c),t.getVertex(t.indices[3*b[B]+(M+1)%3],v),v.vsub(c,d),y.vsub(v,f);var F=f.dot(d);y.vsub(c,f);var P=f.dot(d);if(P>0&&F<0)if(y.vsub(c,f),p.copy(d),p.normalize(),P=f.dot(p),p.scale(P,f),f.vadd(c,f),f.distanceTo(y)<e.radius){if(h)return!0;var R=this.createContactEquation(a,s,e,t,l,u);f.vsub(y,R.ni),R.ni.normalize(),R.ni.scale(e.radius,R.ri),R.ri.vadd(i,R.ri),R.ri.vsub(a.position,R.ri),A.pointToWorldFrame(n,r,f,f),f.vsub(s.position,R.rj),A.vectorToWorldFrame(r,R.ni,R.ni),A.vectorToWorldFrame(r,R.ri,R.ri),this.result.push(R),this.createFrictionEquationsFromContact(R,this.frictionResult)}}for(var q=_t,j=Ht,T=Dt,N=Rt,I=0,L=b.length;I!==L;I++){t.getTriangleVertices(b[I],q,j,T),t.getNormal(b[I],N),y.vsub(q,f);var O=f.dot(N);if(N.scale(O,f),y.vsub(f,f),O=f.distanceTo(y),pe.pointInTriangle(f,q,j,T)&&O<e.radius){if(h)return!0;var W=this.createContactEquation(a,s,e,t,l,u);f.vsub(y,W.ni),W.ni.normalize(),W.ni.scale(e.radius,W.ri),W.ri.vadd(i,W.ri),W.ri.vsub(a.position,W.ri),A.pointToWorldFrame(n,r,f,f),f.vsub(s.position,W.rj),A.vectorToWorldFrame(r,W.ni,W.ni),A.vectorToWorldFrame(r,W.ri,W.ri),this.result.push(W),this.createFrictionEquationsFromContact(W,this.frictionResult)}}b.length=0}},{key:"planeTrimesh",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=new y,v=Mt;v.set(0,0,1),o.vmult(v,v);for(var d=0;d<t.vertices.length/3;d++){t.getVertex(d,c);var p=new y;p.copy(c),A.pointToWorldFrame(n,r,p,c);var f=Ft;if(c.vsub(i,f),v.dot(f)<=0){if(h)return!0;var m=this.createContactEquation(a,s,e,t,l,u);m.ni.copy(v);var w=Pt;v.scale(f.dot(v),w),c.vsub(w,w),m.ri.copy(w),m.ri.vsub(a.position,m.ri),m.rj.copy(c),m.rj.vsub(s.position,m.rj),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}}}]),M}(bt.sphereSphere,bt.spherePlane,bt.boxBox,bt.sphereBox,bt.planeBox,bt.convexConvex,bt.sphereConvex,bt.planeConvex,bt.boxConvex,bt.sphereHeightfield,bt.boxHeightfield,bt.convexHeightfield,bt.sphereParticle,bt.planeParticle,bt.boxParticle,bt.convexParticle,bt.cylinderCylinder,bt.sphereCylinder,bt.planeCylinder,bt.boxCylinder,bt.convexCylinder,bt.heightfieldCylinder,bt.particleCylinder,bt.sphereTrimesh,bt.planeTrimesh),kt=new y,Et=new y,St=new y,zt=new y,Ct=new y,Bt=new S,At=new S,Mt=new y,Ft=new y,Pt=new y,Rt=new y,qt=new y,jt=new y,Tt=new y,Nt=new y,It=new y,Lt=new y,Ot=new y,Wt=new y,Vt=new y,_t=new y,Ht=new y,Dt=new y,Ut=new g,Gt=[],Yt=new y,Xt=new y,Kt=new y,Zt=new y,Qt=new y;function Jt(e,t,i){for(var n=null,o=e.length,r=0;r!==o;r++){var a=e[r],s=Kt;e[(r+1)%o].vsub(a,s);var l=Zt;s.cross(t,l);var u=Qt;i.vsub(a,u);var h=l.dot(u);if(!(null===n||h>0&&!0===n||h<=0&&!1===n))return!1;null===n&&(n=h>0)}return!0}var $t=new y,ei=new y,ti=new y,ii=new y,ni=[new y,new y,new y,new y,new y,new y],oi=new y,ri=new y,ai=new y,si=new y,li=new y,ui=new y,hi=new y,ci=new y,vi=new y,di=new y,pi=new y,yi=new y,fi=new y,mi=new y,wi=new y,gi=new y,bi=new y,xi=new y,ki=new y,Ei=new y,Si=new y,zi=new y,Ci=new y,Bi=new y,Ai=new S,Mi=new y,Fi=new y,Pi=new y,Ri=new y,qi=new y,ji=new y,Ti=[0],Ni=new y,Ii=new y,Li=function(){function e(){h(this,e),this.current=void 0,this.previous=void 0,this.current=[],this.previous=[]}return v(e,[{key:"getKey",value:function(e,t){if(t<e){var i=t;t=e,e=i}return e<<16|t}},{key:"set",value:function(e,t){for(var i=this.getKey(e,t),n=this.current,o=0;i>n[o];)o++;if(i!==n[o]){for(var r=n.length-1;r>=o;r--)n[r+1]=n[r];n[o]=i}}},{key:"tick",value:function(){var e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}},{key:"getDiff",value:function(e,t){for(var i=this.current,n=this.previous,o=i.length,r=n.length,a=0,s=0;s<o;s++){for(var l=i[s];l>n[a];)a++;l===n[a]||Oi(e,l)}a=0;for(var u=0;u<r;u++){for(var h=n[u];h>i[a];)a++;i[a]===h||Oi(t,h)}}}]),e}();function Oi(e,t){e.push((4294901760&t)>>16,65535&t)}var Wi=function(){function e(){h(this,e),this.data={keys:[]}}return v(e,[{key:"get",value:function(e,t){if(e>t){var i=t;t=e,e=i}return this.data[e+"-"+t]}},{key:"set",value:function(e,t,i){if(e>t){var n=t;t=e,e=n}var o=e+"-"+t;this.get(e,t)||this.data.keys.push(o),this.data[o]=i}},{key:"reset",value:function(){for(var e=this.data,t=e.keys;t.length>0;){delete e[t.pop()]}}}]),e}(),Vi=function(e){o(i,e);var t=a(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return h(this,i),(e=t.call(this)).dt=void 0,e.allowSleep=void 0,e.contacts=void 0,e.frictionEquations=void 0,e.quatNormalizeSkip=void 0,e.quatNormalizeFast=void 0,e.time=void 0,e.stepnumber=void 0,e.default_dt=void 0,e.nextId=void 0,e.gravity=void 0,e.broadphase=void 0,e.bodies=void 0,e.hasActiveBodies=void 0,e.solver=void 0,e.constraints=void 0,e.narrowphase=void 0,e.collisionMatrix=void 0,e.collisionMatrixPrevious=void 0,e.bodyOverlapKeeper=void 0,e.shapeOverlapKeeper=void 0,e.materials=void 0,e.contactmaterials=void 0,e.contactMaterialTable=void 0,e.defaultMaterial=void 0,e.defaultContactMaterial=void 0,e.doProfiling=void 0,e.profile=void 0,e.accumulator=void 0,e.subsystems=void 0,e.addBodyEvent=void 0,e.removeBodyEvent=void 0,e.idToBodyMap=void 0,e.dt=-1,e.allowSleep=!!n.allowSleep,e.contacts=[],e.frictionEquations=[],e.quatNormalizeSkip=void 0!==n.quatNormalizeSkip?n.quatNormalizeSkip:0,e.quatNormalizeFast=void 0!==n.quatNormalizeFast&&n.quatNormalizeFast,e.time=0,e.stepnumber=0,e.default_dt=1/60,e.nextId=0,e.gravity=new y,n.gravity&&e.gravity.copy(n.gravity),e.broadphase=void 0!==n.broadphase?n.broadphase:new ue,e.bodies=[],e.hasActiveBodies=!1,e.solver=void 0!==n.solver?n.solver:new yt,e.constraints=[],e.narrowphase=new xt(l(e)),e.collisionMatrix=new k,e.collisionMatrixPrevious=new k,e.bodyOverlapKeeper=new Li,e.shapeOverlapKeeper=new Li,e.materials=[],e.contactmaterials=[],e.contactMaterialTable=new Wi,e.defaultMaterial=new vt("default"),e.defaultContactMaterial=new ct(e.defaultMaterial,e.defaultMaterial,{friction:.3,restitution:0}),e.doProfiling=!1,e.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},e.accumulator=0,e.subsystems=[],e.addBodyEvent={type:"addBody",body:null},e.removeBodyEvent={type:"removeBody",body:null},e.idToBodyMap={},e.broadphase.setWorld(l(e)),e}return v(i,[{key:"getContactMaterial",value:function(e,t){return this.contactMaterialTable.get(e.id,t.id)}},{key:"numObjects",value:function(){return this.bodies.length}},{key:"collisionMatrixTick",value:function(){var e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}},{key:"addConstraint",value:function(e){this.constraints.push(e)}},{key:"removeConstraint",value:function(e){var t=this.constraints.indexOf(e);-1!==t&&this.constraints.splice(t,1)}},{key:"rayTest",value:function(e,t,i){i instanceof he?this.raycastClosest(e,t,{skipBackfaces:!0},i):this.raycastAll(e,t,{skipBackfaces:!0},i)}},{key:"raycastAll",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return i.mode=pe.ALL,i.from=e,i.to=t,i.callback=n,_i.intersectWorld(this,i)}},{key:"raycastAny",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return i.mode=pe.ANY,i.from=e,i.to=t,i.result=n,_i.intersectWorld(this,i)}},{key:"raycastClosest",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return i.mode=pe.CLOSEST,i.from=e,i.to=t,i.result=n,_i.intersectWorld(this,i)}},{key:"addBody",value:function(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof D&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}},{key:"removeBody",value:function(e){e.world=null;var t=this.bodies.length-1,i=this.bodies,n=i.indexOf(e);if(-1!==n){i.splice(n,1);for(var o=0;o!==i.length;o++)i[o].index=o;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}},{key:"getBodyById",value:function(e){return this.idToBodyMap[e]}},{key:"getShapeById",value:function(e){for(var t=this.bodies,i=0;i<t.length;i++)for(var n=t[i].shapes,o=0;o<n.length;o++){var r=n[o];if(r.id===e)return r}return null}},{key:"addMaterial",value:function(e){this.materials.push(e)}},{key:"addContactMaterial",value:function(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}},{key:"step",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;if(void 0===t)this.internalStep(e),this.time+=e;else{this.accumulator+=t;for(var n=Hi.now(),o=0;this.accumulator>=e&&o<i&&(this.internalStep(e),this.accumulator-=e,o++,!(Hi.now()-n>1e3*e)););this.accumulator=this.accumulator%e;for(var r=this.accumulator/e,a=0;a!==this.bodies.length;a++){var s=this.bodies[a];s.previousPosition.lerp(s.position,r,s.interpolatedPosition),s.previousQuaternion.slerp(s.quaternion,r,s.interpolatedQuaternion),s.previousQuaternion.normalize()}this.time+=t}}},{key:"internalStep",value:function(e){this.dt=e;var t=this.contacts,i=Zi,n=Qi,o=this.numObjects(),r=this.bodies,a=this.solver,s=this.gravity,l=this.doProfiling,u=this.profile,h=D.DYNAMIC,c=-1/0,v=this.constraints,d=Ki;s.length();var p=s.x,y=s.y,f=s.z,m=0;for(l&&(c=Hi.now()),m=0;m!==o;m++){var w=r[m];if(w.type===h){var g=w.force,b=w.mass;g.x+=b*p,g.y+=b*y,g.z+=b*f}}for(var x=0,k=this.subsystems.length;x!==k;x++)this.subsystems[x].update();l&&(c=Hi.now()),i.length=0,n.length=0,this.broadphase.collisionPairs(this,i,n),l&&(u.broadphase=Hi.now()-c);var E=v.length;for(m=0;m!==E;m++){var S=v[m];if(!S.collideConnected)for(var z=i.length-1;z>=0;z-=1)(S.bodyA===i[z]&&S.bodyB===n[z]||S.bodyB===i[z]&&S.bodyA===n[z])&&(i.splice(z,1),n.splice(z,1))}this.collisionMatrixTick(),l&&(c=Hi.now());var C=Xi,B=t.length;for(m=0;m!==B;m++)C.push(t[m]);t.length=0;var A=this.frictionEquations.length;for(m=0;m!==A;m++)d.push(this.frictionEquations[m]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(i,n,this,t,C,this.frictionEquations,d),l&&(u.narrowphase=Hi.now()-c),l&&(c=Hi.now()),m=0;m<this.frictionEquations.length;m++)a.addEquation(this.frictionEquations[m]);for(var M=t.length,F=0;F!==M;F++){var P=t[F],R=P.bi,q=P.bj,j=P.si,T=P.sj;if((R.material&&q.material&&this.getContactMaterial(R.material,q.material)||this.defaultContactMaterial).friction,R.material&&q.material&&(R.material.friction>=0&&q.material.friction>=0&&(R.material.friction,q.material.friction),R.material.restitution>=0&&q.material.restitution>=0&&(P.restitution=R.material.restitution*q.material.restitution)),a.addEquation(P),R.allowSleep&&R.type===D.DYNAMIC&&R.sleepState===D.SLEEPING&&q.sleepState===D.AWAKE&&q.type!==D.STATIC)q.velocity.lengthSquared()+q.angularVelocity.lengthSquared()>=2*Math.pow(q.sleepSpeedLimit,2)&&(R.wakeUpAfterNarrowphase=!0);if(q.allowSleep&&q.type===D.DYNAMIC&&q.sleepState===D.SLEEPING&&R.sleepState===D.AWAKE&&R.type!==D.STATIC)R.velocity.lengthSquared()+R.angularVelocity.lengthSquared()>=2*Math.pow(R.sleepSpeedLimit,2)&&(q.wakeUpAfterNarrowphase=!0);this.collisionMatrix.set(R,q,!0),this.collisionMatrixPrevious.get(R,q)||(Yi.body=q,Yi.contact=P,R.dispatchEvent(Yi),Yi.body=R,q.dispatchEvent(Yi)),this.bodyOverlapKeeper.set(R.id,q.id),this.shapeOverlapKeeper.set(j.id,T.id)}for(this.emitContactEvents(),l&&(u.makeContactConstraints=Hi.now()-c,c=Hi.now()),m=0;m!==o;m++){var N=r[m];N.wakeUpAfterNarrowphase&&(N.wakeUp(),N.wakeUpAfterNarrowphase=!1)}for(E=v.length,m=0;m!==E;m++){var I=v[m];I.update();for(var L=0,O=I.equations.length;L!==O;L++){var W=I.equations[L];a.addEquation(W)}}a.solve(e,this),l&&(u.solve=Hi.now()-c),a.removeAllEquations();var V=Math.pow;for(m=0;m!==o;m++){var _=r[m];if(_.type&h){var H=V(1-_.linearDamping,e),U=_.velocity;U.scale(H,U);var G=_.angularVelocity;if(G){var Y=V(1-_.angularDamping,e);G.scale(Y,G)}}}for(this.dispatchEvent(Gi),m=0;m!==o;m++){var X=r[m];X.preStep&&X.preStep.call(X)}l&&(c=Hi.now());var K=this.stepnumber%(this.quatNormalizeSkip+1)==0,Z=this.quatNormalizeFast;for(m=0;m!==o;m++)r[m].integrate(e,K,Z);for(this.clearForces(),this.broadphase.dirty=!0,l&&(u.integrate=Hi.now()-c),this.stepnumber+=1,this.dispatchEvent(Ui),m=0;m!==o;m++){var Q=r[m],J=Q.postStep;J&&J.call(Q)}var $=!0;if(this.allowSleep)for($=!1,m=0;m!==o;m++){var ee=r[m];ee.sleepTick(this.time),ee.sleepState!==D.SLEEPING&&($=!0)}this.hasActiveBodies=$}},{key:"emitContactEvents",value:function(){var e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(Ji,$i),e){for(var i=0,n=Ji.length;i<n;i+=2)en.bodyA=this.getBodyById(Ji[i]),en.bodyB=this.getBodyById(Ji[i+1]),this.dispatchEvent(en);en.bodyA=en.bodyB=null}if(t){for(var o=0,r=$i.length;o<r;o+=2)tn.bodyA=this.getBodyById($i[o]),tn.bodyB=this.getBodyById($i[o+1]),this.dispatchEvent(tn);tn.bodyA=tn.bodyB=null}Ji.length=$i.length=0;var a=this.hasAnyEventListener("beginShapeContact"),s=this.hasAnyEventListener("endShapeContact");if((a||s)&&this.shapeOverlapKeeper.getDiff(Ji,$i),a){for(var l=0,u=Ji.length;l<u;l+=2){var h=this.getShapeById(Ji[l]),c=this.getShapeById(Ji[l+1]);nn.shapeA=h,nn.shapeB=c,h&&(nn.bodyA=h.body),c&&(nn.bodyB=c.body),this.dispatchEvent(nn)}nn.bodyA=nn.bodyB=nn.shapeA=nn.shapeB=null}if(s){for(var v=0,d=$i.length;v<d;v+=2){var p=this.getShapeById($i[v]),y=this.getShapeById($i[v+1]);on.shapeA=p,on.shapeB=y,p&&(on.bodyA=p.body),y&&(on.bodyB=y.body),this.dispatchEvent(on)}on.bodyA=on.bodyB=on.shapeA=on.shapeB=null}}},{key:"clearForces",value:function(){for(var e=this.bodies,t=e.length,i=0;i!==t;i++){var n=e[i];n.force,n.torque,n.force.set(0,0,0),n.torque.set(0,0,0)}}}]),i}(E);new g;var _i=new pe,Hi=globalThis.performance||{};if(!Hi.now){var Di=Date.now();Hi.timing&&Hi.timing.navigationStart&&(Di=Hi.timing.navigationStart),Hi.now=function(){return Date.now()-Di}}var Ui={type:"postStep"},Gi={type:"preStep"},Yi={type:D.COLLIDE_EVENT_NAME,body:null,contact:null},Xi=[],Ki=[],Zi=[],Qi=[],Ji=[],$i=[],en={type:"beginContact",bodyA:null,bodyB:null},tn={type:"endContact",bodyA:null,bodyB:null},nn={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},on={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null}},578:(e,t,i)=>{i.a(e,(async(e,n)=>{try{i.r(t),i.d(t,{AppRenderer:()=>w});var o=i(736),r=i(141),a=i(512),s=i(467),l=i(821),u=i(787),h=i(545),c=i(631);function R(e){return N(e)||T(e)||j(e)||q()}function q(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function j(e,t){if(e){if("string"==typeof e)return I(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?I(e,t):void 0}}function T(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function N(e){if(Array.isArray(e))return I(e)}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var v=await c();console.log(v);var d=new o.xsS;d.background=new o.Ilk(0);var p=new a.Z;d.add(s.gL,s.FM,s.HB,s.hx,s.e7,s.Vp,u.Y,s.dJ);var y=document.documentElement.clientWidth,f=document.documentElement.clientHeight,m=new o.cPb(45,y/f,.1,1e3),w=new o.CP7({antialias:!0});m.position.set(0,0,100);var g=new r.S([s.e7],m,w.domElement);w.setSize(y,f);new o.y8_(40);var b=new h.q3;b.addContactMaterial(s.fn);for(var x=[s.b5,s.Rp,s.Dz,s.WX,s.wV,s.jl].concat(R(s.oU)),k=0;k<x.length;k++)b.addBody(x[k]);var E=s.e7.position.x,S=0,z=new o.SUY,C=0,B=null;function L(){B=requestAnimationFrame(L);var e=z.getElapsedTime(),t=e-C;if(C=e,u.Y.rotation.y+=t/10,b.step(1/v,e,3),console.log(s.e7.position.x),s.e7.position.x=p.pressed("right")?s.e7.position.x+.5>40?s.e7.position.x:s.e7.position.x+.5:p.pressed("left")?s.e7.position.x-.5<-40?s.e7.position.x:s.e7.position.x-.5:s.e7.position.x,s.e7.position.x=p.pressed("a")||p.pressed("A")?s.e7.position.x-.5<-40?s.e7.position.x:s.e7.position.x-.5:p.pressed("d")||p.pressed("D")?s.e7.position.x+.5>40?s.e7.position.x:s.e7.position.x+.5:s.e7.position.x,s.wV.position.copy(s.e7.position),s.Vp.position.copy(s.jl.position),0===s.dJ.children.length&&W(),s.Vp.position.y<=-27&&V(),(E<s.e7.position.x||E>s.e7.position.x)&&0===S){var i=Math.ceil(7*Math.random())-2,n=i<=2&&i>=-2?i<=0?i-2:i+2:i;b.gravity.set(n,-9.82,0),S++}w.render(d,m)}function O(){y=document.documentElement.clientWidth,f=document.documentElement.clientHeight,m.aspect=y/f,m.updateProjectionMatrix(),w.setSize(y,f)}function W(){cancelAnimationFrame(B),l.I$.pause(),l.yp.play(),document.getElementById("overlay").removeAttribute("onclick"),document.querySelector("#overlay").style.display="flex",document.querySelector("#overlay").style.flexFlow="column",document.getElementById("result").textContent="Winner!!!"}function V(){cancelAnimationFrame(B),l.I$.pause(),l.U_.play(),document.getElementById("overlay").removeAttribute("onclick"),document.querySelector("#overlay").style.display="flex",document.querySelector("#overlay").style.flexFlow="column",document.getElementById("result").textContent="You Lost!!!"}L(),window.addEventListener("resize",O),g.addEventListener("drag",(function(e){var t=e.object.position;t.y=-25.9,t.x>40?t.x=40:t.x<-40&&(t.x=-40)}));var A=null,M=null;function _(){s.jl.velocity.y+=10}function H(){s.jl.velocity.y-=10}s.b5.addEventListener("collide",(function(e){cancelAnimationFrame(M),A=requestAnimationFrame(H)})),s.Rp.addEventListener("collide",(function(e){s.jl.velocity.y>=0?s.jl.velocity.set(9,9,0):s.jl.velocity.set(9,-9,0)})),s.WX.addEventListener("collide",(function(e){s.jl.velocity.y>=0?s.jl.velocity.set(-9,9,0):s.jl.velocity.set(-9,-9,0)})),s.wV.addEventListener("collide",(function(e){b.gravity.set(0,0,0),A&&cancelAnimationFrame(A),M=requestAnimationFrame(_)}));for(var F=function(e){s.UG[e].body.addEventListener("collide",(function(t){s.jl.velocity.y=s.jl.velocity.y>=0?-10:10,l.gQ.currentTime=0,l.gQ.play(),b.removeBody(s.UG[e].body),s.dJ.remove(s.UG[e].block)}))},P=0;P<s.UG.length;P++)F(P);n()}catch(D){n(D)}}),1)},467:(e,t,i)=>{i.d(t,{Dz:()=>z,FM:()=>b,HB:()=>E,Rp:()=>k,UG:()=>G,Vp:()=>R,WX:()=>A,b5:()=>g,dJ:()=>_,e7:()=>M,fn:()=>f,gL:()=>m,hx:()=>C,jl:()=>j,oU:()=>Y,wV:()=>P});var n=i(736),o=i(545),r=regeneratorRuntime.mark(W),a=new n.dpR,s=a.load("/Images/silver_2.png"),l=a.load("/Images/purple.png"),u=a.load("/Images/yellow.png"),h=a.load("/Images/red_1.png"),c=a.load("/Images/cyan.png"),v=a.load("/Images/matWhite.png"),d=a.load("/Images/red_2.png"),p=[h,u,c,v],y=new o.F5("default"),f=new o.kp(y,y,{friction:.1,restitution:.3}),m=new n.Kj0(new n.DvJ(100,5,5),new n.kaV({matcap:s}));m.position.set(0,35,0);//! CANNON.js
var w=new o.xu(new o.AO(50,2.5,2.5)),g=new o.uT({mass:0,position:new o.AO(0,35,0),shape:w,material:y}),b=new n.Kj0(new n.DvJ(3,70,5),new n.kaV({matcap:s}));b.position.set(-48.5,0,0);//! CANNON.js
var x=new o.xu(new o.AO(1.5,35,2.5)),k=new o.uT({mass:0,position:new o.AO(-48.5,0,0),shape:x,material:y}),E=new n.Kj0(new n.DvJ(100,5,5),new n.kaV({matcap:s}));E.position.set(0,-35,0);//! CANNON.js
var S=new o.xu(new o.AO(50,2.5,2.5)),z=new o.uT({mass:0,position:new o.AO(0,-35,0),shape:S,material:y}),C=new n.Kj0(new n.DvJ(3,70,5),new n.kaV({matcap:s}));C.position.set(48.5,0,0);//! CANNON.js
var B=new o.xu(new o.AO(1.5,35,2.5)),A=new o.uT({mass:0,position:new o.AO(48.5,0,0),shape:B,material:y}),M=new n.Kj0(new n.DvJ(14,1.5,2),new n.kaV({matcap:l}));M.position.set(0,-25.9,0);//! CANNON.js
var F=new o.xu(new o.AO(7,.75,1)),P=new o.uT({mass:0,position:new o.AO(0,-25.9,0),shape:F,material:y}),R=new n.Kj0(new n.xo$(1,64,32),new n.kaV({matcap:d}));R.position.set(0,-17.5,0);//! CANNON.js
var q=new o.aL(1),j=new o.uT({mass:1,position:new o.AO(0,-17.5,0),shape:q,material:y}),T=new n.DvJ(5,2,2),N=new n.kaV({matcap:p[0]}),I=new n.kaV({matcap:p[1]}),L=new n.kaV({matcap:p[2]}),O=new n.kaV({matcap:p[3]});function W(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N;case 2:return e.next=4,I;case 4:return e.next=6,L;case 6:return e.next=8,O;case 8:case"end":return e.stop()}}),r)}//!
for(var V=W(),_=new n.ZAu,H=-42.5,D=25.9,U=new o.xu(new o.AO(2.5,1,1)),G=[],Y=[],X=0;X<4;X++){for(var K=V.next().value,Z=0;Z<13;Z++){var Q=new n.Kj0(T,K);Q.position.set(H,D);var J={block:Q,body:new o.uT({mass:0,position:new o.AO(H,D,0),shape:U,material:y})};G.push(J),_.add(Q),H+=7}H=-42.5,D-=2.3}for(var $=0;$<G.length;$++)Y[$]=G[$].body},787:(e,t,i)=>{i.d(t,{Y:()=>v});for(var n=i(736),o=[],r=0;r<1e4;r++){var a=n.M8C.randFloatSpread(2e3),s=n.M8C.randFloatSpread(2e3),l=n.M8C.randFloatSpread(2e3);o.push(a,s,l)}var u=new n.u9r;u.setAttribute("position",new n.a$l(o,3));var h=(new n.dpR).load("/Images/1.png"),c=new n.UY4({size:5,sizeAttenuation:!0,transparent:!0,alphaMap:h,depthWrite:!1}),v=new n.woe(u,c)},141:(e,t,i)=>{i.d(t,{S:()=>w});var n=i(736);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=h(e);if(t){var o=h(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return l(this,i)}}function l(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}var c=new n.JOQ,v=new n.iMs,d=new n.FM8,p=new n.Pa4,y=new n.Pa4,f=new n.Pa4,m=new n.yGw,w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(l,e);var t,i,n,o=s(l);function l(e,t,i){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),n=o.call(this),i.style.touchAction="none";var r=null,a=null,s=[],h=u(n);function w(){i.addEventListener("pointermove",b),i.addEventListener("pointerdown",x),i.addEventListener("pointerup",k),i.addEventListener("pointerleave",k)}function g(){i.removeEventListener("pointermove",b),i.removeEventListener("pointerdown",x),i.removeEventListener("pointerup",k),i.removeEventListener("pointerleave",k),i.style.cursor=""}function b(n){if(!1!==h.enabled){if(E(n),v.setFromCamera(d,t),r)return v.ray.intersectPlane(c,y)&&r.position.copy(y.sub(p).applyMatrix4(m)),void h.dispatchEvent({type:"drag",object:r});if("mouse"===n.pointerType||"pen"===n.pointerType)if(s.length=0,v.setFromCamera(d,t),v.intersectObjects(e,!0,s),s.length>0){var o=s[0].object;c.setFromNormalAndCoplanarPoint(t.getWorldDirection(c.normal),f.setFromMatrixPosition(o.matrixWorld)),a!==o&&null!==a&&(h.dispatchEvent({type:"hoveroff",object:a}),i.style.cursor="auto",a=null),a!==o&&(h.dispatchEvent({type:"hoveron",object:o}),i.style.cursor="pointer",a=o)}else null!==a&&(h.dispatchEvent({type:"hoveroff",object:a}),i.style.cursor="auto",a=null)}}function x(n){!1!==h.enabled&&(E(n),s.length=0,v.setFromCamera(d,t),v.intersectObjects(e,!0,s),s.length>0&&(r=!0===h.transformGroup?e[0]:s[0].object,c.setFromNormalAndCoplanarPoint(t.getWorldDirection(c.normal),f.setFromMatrixPosition(r.matrixWorld)),v.ray.intersectPlane(c,y)&&(m.copy(r.parent.matrixWorld).invert(),p.copy(y).sub(f.setFromMatrixPosition(r.matrixWorld))),i.style.cursor="move",h.dispatchEvent({type:"dragstart",object:r})))}function k(){!1!==h.enabled&&(r&&(h.dispatchEvent({type:"dragend",object:r}),r=null),i.style.cursor=a?"pointer":"auto")}function E(e){var t=i.getBoundingClientRect();d.x=(e.clientX-t.left)/t.width*2-1,d.y=-(e.clientY-t.top)/t.height*2+1}return w(),n.enabled=!0,n.transformGroup=!1,n.activate=w,n.deactivate=g,n.dispose=function(){g()},n.getObjects=function(){return e},n}return t=l,i&&r(t.prototype,i),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}(n.pBf)}}]);