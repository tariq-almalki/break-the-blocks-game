"use strict";(self.webpackChunkbreak_the_blocks_game=self.webpackChunkbreak_the_blocks_game||[]).push([[608],{608:(e,t,i)=>{i.r(t),i.d(t,{AppRenderer:()=>No});var n=i(736);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=h(e);if(t){var o=h(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return l(this,i)}}function l(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}var c=new n.JOQ,v=new n.iMs,d=new n.FM8,p=new n.Pa4,y=new n.Pa4,f=new n.Pa4,m=new n.yGw,w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(l,e);var t,i,n,o=s(l);function l(e,t,i){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),n=o.call(this),i.style.touchAction="none";var r=null,a=null,s=[],h=u(n);function w(){i.addEventListener("pointermove",b),i.addEventListener("pointerdown",x),i.addEventListener("pointerup",k),i.addEventListener("pointerleave",k)}function g(){i.removeEventListener("pointermove",b),i.removeEventListener("pointerdown",x),i.removeEventListener("pointerup",k),i.removeEventListener("pointerleave",k),i.style.cursor=""}function b(n){if(!1!==h.enabled){if(E(n),v.setFromCamera(d,t),r)return v.ray.intersectPlane(c,y)&&r.position.copy(y.sub(p).applyMatrix4(m)),void h.dispatchEvent({type:"drag",object:r});if("mouse"===n.pointerType||"pen"===n.pointerType)if(s.length=0,v.setFromCamera(d,t),v.intersectObjects(e,!0,s),s.length>0){var o=s[0].object;c.setFromNormalAndCoplanarPoint(t.getWorldDirection(c.normal),f.setFromMatrixPosition(o.matrixWorld)),a!==o&&null!==a&&(h.dispatchEvent({type:"hoveroff",object:a}),i.style.cursor="auto",a=null),a!==o&&(h.dispatchEvent({type:"hoveron",object:o}),i.style.cursor="pointer",a=o)}else null!==a&&(h.dispatchEvent({type:"hoveroff",object:a}),i.style.cursor="auto",a=null)}}function x(n){!1!==h.enabled&&(E(n),s.length=0,v.setFromCamera(d,t),v.intersectObjects(e,!0,s),s.length>0&&(r=!0===h.transformGroup?e[0]:s[0].object,c.setFromNormalAndCoplanarPoint(t.getWorldDirection(c.normal),f.setFromMatrixPosition(r.matrixWorld)),v.ray.intersectPlane(c,y)&&(m.copy(r.parent.matrixWorld).invert(),p.copy(y).sub(f.setFromMatrixPosition(r.matrixWorld))),i.style.cursor="move",h.dispatchEvent({type:"dragstart",object:r})))}function k(){!1!==h.enabled&&(r&&(h.dispatchEvent({type:"dragend",object:r}),r=null),i.style.cursor=a?"pointer":"auto")}function E(e){var t=i.getBoundingClientRect();d.x=(e.clientX-t.left)/t.width*2-1,d.y=-(e.clientY-t.top)/t.height*2+1}return w(),n.enabled=!0,n.transformGroup=!1,n.activate=w,n.deactivate=g,n.dispose=function(){g()},n.getObjects=function(){return e},n}return t=l,i&&r(t.prototype,i),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}(n.pBf),g=i(512);function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&k(e,t)}function k(e,t){return k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},k(e,t)}function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=C(e);if(t){var o=C(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return S(this,i)}}function S(e,t){if(t&&("object"===b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return z(e)}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e){return C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},C(e)}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function A(e,t,i){return t&&M(e.prototype,t),i&&M(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var F=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0,0,0,0,0,0];B(this,e),this.elements=void 0,this.elements=t}return A(e,[{key:"identity",value:function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}},{key:"setZero",value:function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}},{key:"setTrace",value:function(e){var t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}},{key:"getTrace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new R,t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}},{key:"vmult",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R,i=this.elements,n=e.x,o=e.y,r=e.z;return t.x=i[0]*n+i[1]*o+i[2]*r,t.y=i[3]*n+i[4]*o+i[5]*r,t.z=i[6]*n+i[7]*o+i[8]*r,t}},{key:"smult",value:function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]*=e}},{key:"mmult",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=this.elements,o=t.elements,r=i.elements,a=n[0],s=n[1],l=n[2],u=n[3],h=n[4],c=n[5],v=n[6],d=n[7],p=n[8],y=o[0],f=o[1],m=o[2],w=o[3],g=o[4],b=o[5],x=o[6],k=o[7],E=o[8];return r[0]=a*y+s*w+l*x,r[1]=a*f+s*g+l*k,r[2]=a*m+s*b+l*E,r[3]=u*y+h*w+c*x,r[4]=u*f+h*g+c*k,r[5]=u*m+h*b+c*E,r[6]=v*y+d*w+p*x,r[7]=v*f+d*g+p*k,r[8]=v*m+d*b+p*E,i}},{key:"scale",value:function(t){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=this.elements,o=i.elements,r=0;3!==r;r++)o[3*r+0]=t.x*n[3*r+0],o[3*r+1]=t.y*n[3*r+1],o[3*r+2]=t.z*n[3*r+2];return i}},{key:"solve",value:function(e){var t,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R,o=3,r=4,a=[];for(t=0;t<o*r;t++)a.push(0);for(t=0;t<3;t++)for(i=0;i<3;i++)a[t+r*i]=this.elements[t+3*i];a[3]=e.x,a[7]=e.y,a[11]=e.z;var s,l,u=3,h=u,c=4;do{if(0===a[(t=h-u)+r*t])for(i=t+1;i<h;i++)if(0!==a[t+r*i]){s=c;do{a[(l=c-s)+r*t]+=a[l+r*i]}while(--s);break}if(0!==a[t+r*t])for(i=t+1;i<h;i++){var v=a[t+r*i]/a[t+r*t];s=c;do{a[(l=c-s)+r*i]=l<=t?0:a[l+r*i]-a[l+r*t]*v}while(--s)}}while(--u);if(n.z=a[2*r+3]/a[2*r+2],n.y=(a[1*r+3]-a[1*r+2]*n.z)/a[1*r+1],n.x=(a[0*r+3]-a[0*r+2]*n.z-a[0*r+1]*n.y)/a[0*r+0],isNaN(n.x)||isNaN(n.y)||isNaN(n.z)||n.x===1/0||n.y===1/0||n.z===1/0)throw"Could not solve equation! Got x=["+n.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return n}},{key:"e",value:function(e,t,i){if(void 0===i)return this.elements[t+3*e];this.elements[t+3*e]=i}},{key:"copy",value:function(e){for(var t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}},{key:"toString",value:function(){for(var e="",t=0;t<9;t++)e+=this.elements[t]+",";return e}},{key:"reverse",value:function(){var t,i,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,o=3,r=6,a=P;for(t=0;t<3;t++)for(i=0;i<3;i++)a[t+r*i]=this.elements[t+3*i];a[3]=1,a[9]=0,a[15]=0,a[4]=0,a[10]=1,a[16]=0,a[5]=0,a[11]=0,a[17]=1;var s,l,u=3,h=u,c=r;do{if(0===a[(t=h-u)+r*t])for(i=t+1;i<h;i++)if(0!==a[t+r*i]){s=c;do{a[(l=c-s)+r*t]+=a[l+r*i]}while(--s);break}if(0!==a[t+r*t])for(i=t+1;i<h;i++){var v=a[t+r*i]/a[t+r*t];s=c;do{a[(l=c-s)+r*i]=l<=t?0:a[l+r*i]-a[l+r*t]*v}while(--s)}}while(--u);t=2;do{i=t-1;do{var d=a[t+r*i]/a[t+r*t];s=r;do{a[(l=r-s)+r*i]=a[l+r*i]-a[l+r*t]*d}while(--s)}while(i--)}while(--t);t=2;do{var p=1/a[t+r*t];s=r;do{a[(l=r-s)+r*t]=a[l+r*t]*p}while(--s)}while(t--);t=2;do{i=2;do{if(l=a[o+i+r*t],isNaN(l)||l===1/0)throw"Could not reverse! A=["+this.toString()+"]";n.e(t,i,l)}while(i--)}while(t--);return n}},{key:"setRotationFromQuaternion",value:function(e){var t=e.x,i=e.y,n=e.z,o=e.w,r=t+t,a=i+i,s=n+n,l=t*r,u=t*a,h=t*s,c=i*a,v=i*s,d=n*s,p=o*r,y=o*a,f=o*s,m=this.elements;return m[0]=1-(c+d),m[1]=u-f,m[2]=h+y,m[3]=u+f,m[4]=1-(l+d),m[5]=v-p,m[6]=h-y,m[7]=v+p,m[8]=1-(l+c),this}},{key:"transpose",value:function(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,n=this.elements,o=i.elements;return o[0]=n[0],o[4]=n[4],o[8]=n[8],t=n[1],o[1]=n[3],o[3]=t,t=n[2],o[2]=n[6],o[6]=t,t=n[5],o[5]=n[7],o[7]=t,i}}]),e}(),P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],R=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;B(this,e),this.x=void 0,this.y=void 0,this.z=void 0,this.x=t,this.y=i,this.z=n}return A(e,[{key:"cross",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=t.x,o=t.y,r=t.z,a=this.x,s=this.y,l=this.z;return i.x=s*r-l*o,i.y=l*n-a*r,i.z=a*o-s*n,i}},{key:"set",value:function(e,t,i){return this.x=e,this.y=t,this.z=i,this}},{key:"setZero",value:function(){this.x=this.y=this.z=0}},{key:"vadd",value:function(t,i){if(!i)return new e(this.x+t.x,this.y+t.y,this.z+t.z);i.x=t.x+this.x,i.y=t.y+this.y,i.z=t.z+this.z}},{key:"vsub",value:function(t,i){if(!i)return new e(this.x-t.x,this.y-t.y,this.z-t.z);i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z}},{key:"crossmat",value:function(){return new F([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}},{key:"normalize",value:function(){var e=this.x,t=this.y,i=this.z,n=Math.sqrt(e*e+t*t+i*i);if(n>0){var o=1/n;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return n}},{key:"unit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,i=this.x,n=this.y,o=this.z,r=Math.sqrt(i*i+n*n+o*o);return r>0?(r=1/r,t.x=i*r,t.y=n*r,t.z=o*r):(t.x=1,t.y=0,t.z=0),t}},{key:"length",value:function(){var e=this.x,t=this.y,i=this.z;return Math.sqrt(e*e+t*t+i*i)}},{key:"lengthSquared",value:function(){return this.dot(this)}},{key:"distanceTo",value:function(e){var t=this.x,i=this.y,n=this.z,o=e.x,r=e.y,a=e.z;return Math.sqrt((o-t)*(o-t)+(r-i)*(r-i)+(a-n)*(a-n))}},{key:"distanceSquared",value:function(e){var t=this.x,i=this.y,n=this.z,o=e.x,r=e.y,a=e.z;return(o-t)*(o-t)+(r-i)*(r-i)+(a-n)*(a-n)}},{key:"scale",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=this.x,o=this.y,r=this.z;return i.x=t*n,i.y=t*o,i.z=t*r,i}},{key:"vmul",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;return i.x=t.x*this.x,i.y=t.y*this.y,i.z=t.z*this.z,i}},{key:"addScaledVector",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e;return n.x=this.x+t*i.x,n.y=this.y+t*i.y,n.z=this.z+t*i.z,n}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"isZero",value:function(){return 0===this.x&&0===this.y&&0===this.z}},{key:"negate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e;return t.x=-this.x,t.y=-this.y,t.z=-this.z,t}},{key:"tangents",value:function(e,t){var i=this.length();if(i>0){var n=q,o=1/i;n.set(this.x*o,this.y*o,this.z*o);var r=j;Math.abs(n.x)<.9?(r.set(1,0,0),n.cross(r,e)):(r.set(0,1,0),n.cross(r,e)),n.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}},{key:"toString",value:function(){return this.x+","+this.y+","+this.z}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"lerp",value:function(e,t,i){var n=this.x,o=this.y,r=this.z;i.x=n+(e.x-n)*t,i.y=o+(e.y-o)*t,i.z=r+(e.z-r)*t}},{key:"almostEquals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-6;return!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}},{key:"almostZero",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e-6;return!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}},{key:"isAntiparallelTo",value:function(e,t){return this.negate(N),N.almostEquals(e,t)}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();R.ZERO=void 0,R.UNIT_X=void 0,R.UNIT_Y=void 0,R.UNIT_Z=void 0,R.ZERO=new R(0,0,0),R.UNIT_X=new R(1,0,0),R.UNIT_Y=new R(0,1,0),R.UNIT_Z=new R(0,0,1);var q=new R,j=new R,N=new R,T=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B(this,e),this.lowerBound=void 0,this.upperBound=void 0,this.lowerBound=new R,this.upperBound=new R,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}return A(e,[{key:"setFromPoints",value:function(e,t,i,n){var o=this.lowerBound,r=this.upperBound,a=i;o.copy(e[0]),a&&a.vmult(o,o),r.copy(o);for(var s=1;s<e.length;s++){var l=e[s];a&&(a.vmult(l,I),l=I),l.x>r.x&&(r.x=l.x),l.x<o.x&&(o.x=l.x),l.y>r.y&&(r.y=l.y),l.y<o.y&&(o.y=l.y),l.z>r.z&&(r.z=l.z),l.z<o.z&&(o.z=l.z)}return t&&(t.vadd(o,o),t.vadd(r,r)),n&&(o.x-=n,o.y-=n,o.z-=n,r.x+=n,r.y+=n,r.z+=n),this}},{key:"copy",value:function(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"extend",value:function(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}},{key:"overlaps",value:function(e){var t=this.lowerBound,i=this.upperBound,n=e.lowerBound,o=e.upperBound,r=n.x<=i.x&&i.x<=o.x||t.x<=o.x&&o.x<=i.x,a=n.y<=i.y&&i.y<=o.y||t.y<=o.y&&o.y<=i.y,s=n.z<=i.z&&i.z<=o.z||t.z<=o.z&&o.z<=i.z;return r&&a&&s}},{key:"volume",value:function(){var e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}},{key:"contains",value:function(e){var t=this.lowerBound,i=this.upperBound,n=e.lowerBound,o=e.upperBound;return t.x<=n.x&&i.x>=o.x&&t.y<=n.y&&i.y>=o.y&&t.z<=n.z&&i.z>=o.z}},{key:"getCorners",value:function(e,t,i,n,o,r,a,s){var l=this.lowerBound,u=this.upperBound;e.copy(l),t.set(u.x,l.y,l.z),i.set(u.x,u.y,l.z),n.set(l.x,u.y,u.z),o.set(u.x,l.y,u.z),r.set(l.x,u.y,l.z),a.set(l.x,l.y,u.z),s.copy(u)}},{key:"toLocalFrame",value:function(e,t){var i=L,n=i[0],o=i[1],r=i[2],a=i[3],s=i[4],l=i[5],u=i[6],h=i[7];this.getCorners(n,o,r,a,s,l,u,h);for(var c=0;8!==c;c++){var v=i[c];e.pointToLocal(v,v)}return t.setFromPoints(i)}},{key:"toWorldFrame",value:function(e,t){var i=L,n=i[0],o=i[1],r=i[2],a=i[3],s=i[4],l=i[5],u=i[6],h=i[7];this.getCorners(n,o,r,a,s,l,u,h);for(var c=0;8!==c;c++){var v=i[c];e.pointToWorld(v,v)}return t.setFromPoints(i)}},{key:"overlapsRay",value:function(e){var t=e.direction,i=e.from,n=1/t.x,o=1/t.y,r=1/t.z,a=(this.lowerBound.x-i.x)*n,s=(this.upperBound.x-i.x)*n,l=(this.lowerBound.y-i.y)*o,u=(this.upperBound.y-i.y)*o,h=(this.lowerBound.z-i.z)*r,c=(this.upperBound.z-i.z)*r,v=Math.max(Math.max(Math.min(a,s),Math.min(l,u)),Math.min(h,c)),d=Math.min(Math.min(Math.max(a,s),Math.max(l,u)),Math.max(h,c));return!(d<0)&&!(v>d)}}]),e}(),I=new R,L=[new R,new R,new R,new R,new R,new R,new R,new R],O=function(){function e(){B(this,e),this.matrix=void 0,this.matrix=[]}return A(e,[{key:"get",value:function(e,t){var i=e.index,n=t.index;if(n>i){var o=n;n=i,i=o}return this.matrix[(i*(i+1)>>1)+n-1]}},{key:"set",value:function(e,t,i){var n=e.index,o=t.index;if(o>n){var r=o;o=n,n=r}this.matrix[(n*(n+1)>>1)+o-1]=i?1:0}},{key:"reset",value:function(){for(var e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}},{key:"setNumObjects",value:function(e){this.matrix.length=e*(e-1)>>1}}]),e}(),W=function(){function e(){B(this,e),this._listeners=void 0}return A(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;return void 0===i[e]&&(i[e]=[]),i[e].includes(t)||i[e].push(t),this}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return!(void 0===i[e]||!i[e].includes(t))}},{key:"hasAnyEventListener",value:function(e){return void 0!==this._listeners&&void 0!==this._listeners[e]}},{key:"removeEventListener",value:function(e,t){if(void 0===this._listeners)return this;var i=this._listeners;if(void 0===i[e])return this;var n=i[e].indexOf(t);return-1!==n&&i[e].splice(n,1),this}},{key:"dispatchEvent",value:function(e){if(void 0===this._listeners)return this;var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=0,n=t.length;i<n;i++)t[i].call(this,e)}return this}}]),e}(),V=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;B(this,e),this.x=void 0,this.y=void 0,this.z=void 0,this.w=void 0,this.x=t,this.y=i,this.z=n,this.w=o}return A(e,[{key:"set",value:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}},{key:"toString",value:function(){return this.x+","+this.y+","+this.z+","+this.w}},{key:"toArray",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"setFromAxisAngle",value:function(e,t){var i=Math.sin(.5*t);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(.5*t),this}},{key:"toAxisAngle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new R;this.normalize();var t=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,t]}},{key:"setFromVectors",value:function(e,t){if(e.isAntiparallelTo(t)){var i=_,n=H;e.tangents(i,n),this.setFromAxisAngle(i,Math.PI)}else{var o=e.cross(t);this.x=o.x,this.y=o.y,this.z=o.z,this.w=Math.sqrt(Math.pow(e.length(),2)*Math.pow(t.length(),2))+e.dot(t),this.normalize()}return this}},{key:"mult",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=this.x,o=this.y,r=this.z,a=this.w,s=t.x,l=t.y,u=t.z,h=t.w;return i.x=n*h+a*s+o*u-r*l,i.y=o*h+a*l+r*s-n*u,i.z=r*h+a*u+n*l-o*s,i.w=a*h-n*s-o*l-r*u,i}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,i=this.x,n=this.y,o=this.z,r=this.w;this.conjugate(t);var a=1/(i*i+n*n+o*o+r*r);return t.x*=a,t.y*=a,t.z*=a,t.w*=a,t}},{key:"conjugate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e;return t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}},{key:"normalize",value:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"normalizeFast",value:function(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"vmult",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R,i=e.x,n=e.y,o=e.z,r=this.x,a=this.y,s=this.z,l=this.w,u=l*i+a*o-s*n,h=l*n+s*i-r*o,c=l*o+r*n-a*i,v=-r*i-a*n-s*o;return t.x=u*l+v*-r+h*-s-c*-a,t.y=h*l+v*-a+c*-r-u*-s,t.z=c*l+v*-s+u*-a-h*-r,t}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"toEuler",value:function(e){var t,i,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YZX",r=this.x,a=this.y,s=this.z,l=this.w;if("YZX"!==o)throw new Error("Euler order "+o+" not supported yet.");var u=r*a+s*l;if(u>.499&&(t=2*Math.atan2(r,l),i=Math.PI/2,n=0),u<-.499&&(t=-2*Math.atan2(r,l),i=-Math.PI/2,n=0),void 0===t){var h=r*r,c=a*a,v=s*s;t=Math.atan2(2*a*l-2*r*s,1-2*c-2*v),i=Math.asin(2*u),n=Math.atan2(2*r*l-2*a*s,1-2*h-2*v)}e.y=t,e.z=i,e.x=n}},{key:"setFromEuler",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"XYZ",o=Math.cos(e/2),r=Math.cos(t/2),a=Math.cos(i/2),s=Math.sin(e/2),l=Math.sin(t/2),u=Math.sin(i/2);return"XYZ"===n?(this.x=s*r*a+o*l*u,this.y=o*l*a-s*r*u,this.z=o*r*u+s*l*a,this.w=o*r*a-s*l*u):"YXZ"===n?(this.x=s*r*a+o*l*u,this.y=o*l*a-s*r*u,this.z=o*r*u-s*l*a,this.w=o*r*a+s*l*u):"ZXY"===n?(this.x=s*r*a-o*l*u,this.y=o*l*a+s*r*u,this.z=o*r*u+s*l*a,this.w=o*r*a-s*l*u):"ZYX"===n?(this.x=s*r*a-o*l*u,this.y=o*l*a+s*r*u,this.z=o*r*u-s*l*a,this.w=o*r*a+s*l*u):"YZX"===n?(this.x=s*r*a+o*l*u,this.y=o*l*a+s*r*u,this.z=o*r*u-s*l*a,this.w=o*r*a-s*l*u):"XZY"===n&&(this.x=s*r*a-o*l*u,this.y=o*l*a-s*r*u,this.z=o*r*u+s*l*a,this.w=o*r*a+s*l*u),this}},{key:"clone",value:function(){return new e(this.x,this.y,this.z,this.w)}},{key:"slerp",value:function(t,i){var n,o,r,a,s,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e,u=this.x,h=this.y,c=this.z,v=this.w,d=t.x,p=t.y,y=t.z,f=t.w;return(o=u*d+h*p+c*y+v*f)<0&&(o=-o,d=-d,p=-p,y=-y,f=-f),1-o>1e-6?(n=Math.acos(o),r=Math.sin(n),a=Math.sin((1-i)*n)/r,s=Math.sin(i*n)/r):(a=1-i,s=i),l.x=a*u+s*d,l.y=a*h+s*p,l.z=a*c+s*y,l.w=a*v+s*f,l}},{key:"integrate",value:function(t,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e,r=t.x*n.x,a=t.y*n.y,s=t.z*n.z,l=this.x,u=this.y,h=this.z,c=this.w,v=.5*i;return o.x+=v*(r*c+a*h-s*u),o.y+=v*(a*c+s*l-r*h),o.z+=v*(s*c+r*u-a*l),o.w+=v*(-r*l-a*u-s*h),o}}]),e}(),_=new R,H=new R,D=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B(this,e),this.id=void 0,this.type=void 0,this.boundingSphereRadius=void 0,this.collisionResponse=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.material=void 0,this.body=void 0,this.id=e.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=!t.collisionResponse||t.collisionResponse,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}return A(e,[{key:"updateBoundingSphereRadius",value:function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}},{key:"volume",value:function(){throw"volume() not implemented for shape type "+this.type}},{key:"calculateLocalInertia",value:function(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type}},{key:"calculateWorldAABB",value:function(e,t,i,n){throw"calculateWorldAABB() not implemented for shape type "+this.type}}]),e}();D.idCounter=0,D.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};var G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B(this,e),this.position=void 0,this.quaternion=void 0,this.position=new R,this.quaternion=new V,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}return A(e,[{key:"pointToLocal",value:function(t,i){return e.pointToLocalFrame(this.position,this.quaternion,t,i)}},{key:"pointToWorld",value:function(t,i){return e.pointToWorldFrame(this.position,this.quaternion,t,i)}},{key:"vectorToWorldFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R;return this.quaternion.vmult(e,t),t}}],[{key:"pointToLocalFrame",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R;return i.vsub(e,n),t.conjugate(U),U.vmult(n,n),n}},{key:"pointToWorldFrame",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R;return t.vmult(i,n),n.vadd(e,n),n}},{key:"vectorToWorldFrame",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new R;return e.vmult(t,i),i}},{key:"vectorToLocalFrame",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new R;return t.w*=-1,t.vmult(i,n),t.w*=-1,n}}]),e}(),U=new V,Y=function(e){x(i,e);var t=E(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B(this,i);var o=n.vertices,r=void 0===o?[]:o,a=n.faces,s=void 0===a?[]:a,l=n.normals,u=void 0===l?[]:l,h=n.axes,c=n.boundingSphereRadius;return(e=t.call(this,{type:D.types.CONVEXPOLYHEDRON})).vertices=void 0,e.faces=void 0,e.faceNormals=void 0,e.worldVertices=void 0,e.worldVerticesNeedsUpdate=void 0,e.worldFaceNormals=void 0,e.worldFaceNormalsNeedsUpdate=void 0,e.uniqueAxes=void 0,e.uniqueEdges=void 0,e.vertices=r,e.faces=s,e.faceNormals=u,0===e.faceNormals.length&&e.computeNormals(),c?e.boundingSphereRadius=c:e.updateBoundingSphereRadius(),e.worldVertices=[],e.worldVerticesNeedsUpdate=!0,e.worldFaceNormals=[],e.worldFaceNormalsNeedsUpdate=!0,e.uniqueAxes=h?h.slice():null,e.uniqueEdges=[],e.computeEdges(),e}return A(i,[{key:"computeEdges",value:function(){var e=this.faces,t=this.vertices,i=this.uniqueEdges;i.length=0;for(var n=new R,o=0;o!==e.length;o++)for(var r=e[o],a=r.length,s=0;s!==a;s++){var l=(s+1)%a;t[r[s]].vsub(t[r[l]],n),n.normalize();for(var u=!1,h=0;h!==i.length;h++)if(i[h].almostEquals(n)||i[h].almostEquals(n)){u=!0;break}u||i.push(n.clone())}}},{key:"computeNormals",value:function(){this.faceNormals.length=this.faces.length;for(var e=0;e<this.faces.length;e++){for(var t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw new Error("Vertex "+this.faces[e][t]+" not found!");var i=this.faceNormals[e]||new R;this.getFaceNormal(e,i),i.negate(i),this.faceNormals[e]=i;var n=this.vertices[this.faces[e][0]];if(i.dot(n)<0){console.error(".faceNormals["+e+"] = Vec3("+i.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var o=0;o<this.faces[e].length;o++)console.warn(".vertices["+this.faces[e][o]+"] = Vec3("+this.vertices[this.faces[e][o]].toString()+")")}}}},{key:"getFaceNormal",value:function(e,t){var n=this.faces[e],o=this.vertices[n[0]],r=this.vertices[n[1]],a=this.vertices[n[2]];i.computeNormal(o,r,a,t)}},{key:"clipAgainstHull",value:function(e,t,i,n,o,r,a,s,l){for(var u=new R,h=-1,c=-Number.MAX_VALUE,v=0;v<i.faces.length;v++){u.copy(i.faceNormals[v]),o.vmult(u,u);var d=u.dot(r);d>c&&(c=d,h=v)}for(var p=[],y=0;y<i.faces[h].length;y++){var f=i.vertices[i.faces[h][y]],m=new R;m.copy(f),o.vmult(m,m),n.vadd(m,m),p.push(m)}h>=0&&this.clipFaceAgainstHull(r,e,t,p,a,s,l)}},{key:"findSeparatingAxis",value:function(e,t,i,n,o,r,a,s){var l=new R,u=new R,h=new R,c=new R,v=new R,d=new R,p=Number.MAX_VALUE,y=this;if(y.uniqueAxes)for(var f=0;f!==y.uniqueAxes.length;f++){i.vmult(y.uniqueAxes[f],l);var m=y.testSepAxis(l,e,t,i,n,o);if(!1===m)return!1;m<p&&(p=m,r.copy(l))}else for(var w=a?a.length:y.faces.length,g=0;g<w;g++){var b=a?a[g]:g;l.copy(y.faceNormals[b]),i.vmult(l,l);var x=y.testSepAxis(l,e,t,i,n,o);if(!1===x)return!1;x<p&&(p=x,r.copy(l))}if(e.uniqueAxes)for(var k=0;k!==e.uniqueAxes.length;k++){o.vmult(e.uniqueAxes[k],u);var E=y.testSepAxis(u,e,t,i,n,o);if(!1===E)return!1;E<p&&(p=E,r.copy(u))}else for(var S=s?s.length:e.faces.length,z=0;z<S;z++){var C=s?s[z]:z;u.copy(e.faceNormals[C]),o.vmult(u,u);var B=y.testSepAxis(u,e,t,i,n,o);if(!1===B)return!1;B<p&&(p=B,r.copy(u))}for(var M=0;M!==y.uniqueEdges.length;M++){i.vmult(y.uniqueEdges[M],c);for(var A=0;A!==e.uniqueEdges.length;A++)if(o.vmult(e.uniqueEdges[A],v),c.cross(v,d),!d.almostZero()){d.normalize();var F=y.testSepAxis(d,e,t,i,n,o);if(!1===F)return!1;F<p&&(p=F,r.copy(d))}}return n.vsub(t,h),h.dot(r)>0&&r.negate(r),!0}},{key:"testSepAxis",value:function(e,t,n,o,r,a){i.project(this,e,n,o,X),i.project(t,e,r,a,K);var s=X[0],l=X[1],u=K[0],h=K[1];if(s<h||u<l)return!1;var c=s-h,v=u-l;return c<v?c:v}},{key:"calculateLocalInertia",value:function(e,t){var i=new R,n=new R;this.computeLocalAABB(n,i);var o=i.x-n.x,r=i.y-n.y,a=i.z-n.z;t.x=1/12*e*(2*r*2*r+2*a*2*a),t.y=1/12*e*(2*o*2*o+2*a*2*a),t.z=1/12*e*(2*r*2*r+2*o*2*o)}},{key:"getPlaneConstantOfFace",value:function(e){var t=this.faces[e],i=this.faceNormals[e],n=this.vertices[t[0]];return-i.dot(n)}},{key:"clipFaceAgainstHull",value:function(e,t,i,n,o,r,a){for(var s=new R,l=new R,u=new R,h=new R,c=new R,v=new R,d=new R,p=new R,y=this,f=n,m=[],w=-1,g=Number.MAX_VALUE,b=0;b<y.faces.length;b++){s.copy(y.faceNormals[b]),i.vmult(s,s);var x=s.dot(e);x<g&&(g=x,w=b)}if(!(w<0)){var k=y.faces[w];k.connectedFaces=[];for(var E=0;E<y.faces.length;E++)for(var S=0;S<y.faces[E].length;S++)-1!==k.indexOf(y.faces[E][S])&&E!==w&&-1===k.connectedFaces.indexOf(E)&&k.connectedFaces.push(E);for(var z=k.length,C=0;C<z;C++){var B=y.vertices[k[C]],M=y.vertices[k[(C+1)%z]];B.vsub(M,l),u.copy(l),i.vmult(u,u),t.vadd(u,u),h.copy(this.faceNormals[w]),i.vmult(h,h),t.vadd(h,h),u.cross(h,c),c.negate(c),v.copy(B),i.vmult(v,v),t.vadd(v,v);var A=k.connectedFaces[C];d.copy(this.faceNormals[A]);var F=this.getPlaneConstantOfFace(A);p.copy(d),i.vmult(p,p);var P=F-p.dot(t);for(this.clipFaceAgainstPlane(f,m,p,P);f.length;)f.shift();for(;m.length;)f.push(m.shift())}d.copy(this.faceNormals[w]);var q=this.getPlaneConstantOfFace(w);p.copy(d),i.vmult(p,p);for(var j=q-p.dot(t),N=0;N<f.length;N++){var T=p.dot(f[N])+j;if(T<=o&&(console.log("clamped: depth="+T+" to minDist="+o),T=o),T<=r){var I=f[N];if(T<=1e-6){var L={point:I,normal:p,depth:T};a.push(L)}}}}}},{key:"clipFaceAgainstPlane",value:function(e,t,i,n){var o,r,a=e.length;if(a<2)return t;var s=e[e.length-1],l=e[0];o=i.dot(s)+n;for(var u=0;u<a;u++){if(l=e[u],r=i.dot(l)+n,o<0)if(r<0){var h=new R;h.copy(l),t.push(h)}else{var c=new R;s.lerp(l,o/(o-r),c),t.push(c)}else if(r<0){var v=new R;s.lerp(l,o/(o-r),v),t.push(v),t.push(l)}s=l,o=r}return t}},{key:"computeWorldVertices",value:function(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new R);for(var i=this.vertices,n=this.worldVertices,o=0;o!==this.vertices.length;o++)t.vmult(i[o],n[o]),e.vadd(n[o],n[o]);this.worldVerticesNeedsUpdate=!1}},{key:"computeLocalAABB",value:function(e,t){var i=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var n=0;n<this.vertices.length;n++){var o=i[n];o.x<e.x?e.x=o.x:o.x>t.x&&(t.x=o.x),o.y<e.y?e.y=o.y:o.y>t.y&&(t.y=o.y),o.z<e.z?e.z=o.z:o.z>t.z&&(t.z=o.z)}}},{key:"computeWorldFaceNormals",value:function(e){for(var t=this.faceNormals.length;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new R);for(var i=this.faceNormals,n=this.worldFaceNormals,o=0;o!==t;o++)e.vmult(i[o],n[o]);this.worldFaceNormalsNeedsUpdate=!1}},{key:"updateBoundingSphereRadius",value:function(){for(var e=0,t=this.vertices,i=0;i!==t.length;i++){var n=t[i].lengthSquared();n>e&&(e=n)}this.boundingSphereRadius=Math.sqrt(e)}},{key:"calculateWorldAABB",value:function(e,t,i,n){for(var o,r,a,s,l,u,h=this.vertices,c=new R,v=0;v<h.length;v++){c.copy(h[v]),t.vmult(c,c),e.vadd(c,c);var d=c;(void 0===o||d.x<o)&&(o=d.x),(void 0===s||d.x>s)&&(s=d.x),(void 0===r||d.y<r)&&(r=d.y),(void 0===l||d.y>l)&&(l=d.y),(void 0===a||d.z<a)&&(a=d.z),(void 0===u||d.z>u)&&(u=d.z)}i.set(o,r,a),n.set(s,l,u)}},{key:"volume",value:function(){return 4*Math.PI*this.boundingSphereRadius/3}},{key:"getAveragePointLocal",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new R,t=this.vertices,i=0;i<t.length;i++)e.vadd(t[i],e);return e.scale(1/t.length,e),e}},{key:"transformAllPoints",value:function(e,t){var i=this.vertices.length,n=this.vertices;if(t){for(var o=0;o<i;o++){var r=n[o];t.vmult(r,r)}for(var a=0;a<this.faceNormals.length;a++){var s=this.faceNormals[a];t.vmult(s,s)}}if(e)for(var l=0;l<i;l++){var u=n[l];u.vadd(e,u)}}},{key:"pointIsInside",value:function(e){var t=this.vertices,i=this.faces,n=this.faceNormals,o=new R;this.getAveragePointLocal(o);for(var r=0;r<this.faces.length;r++){var a=n[r],s=t[i[r][0]],l=new R;e.vsub(s,l);var u=a.dot(l),h=new R;o.vsub(s,h);var c=a.dot(h);if(u<0&&c>0||u>0&&c<0)return!1}return-1}}],[{key:"computeNormal",value:function(e,t,i,n){var o=new R,r=new R;t.vsub(e,r),i.vsub(t,o),o.cross(r,n),n.isZero()||n.normalize()}},{key:"project",value:function(e,t,i,n,o){var r=e.vertices.length,a=Z,s=0,l=0,u=Q,h=e.vertices;u.setZero(),G.vectorToLocalFrame(i,n,t,a),G.pointToLocalFrame(i,n,u,u);var c=u.dot(a);l=s=h[0].dot(a);for(var v=1;v<r;v++){var d=h[v].dot(a);d>s&&(s=d),d<l&&(l=d)}if((l-=c)>(s-=c)){var p=l;l=s,s=p}o[0]=s,o[1]=l}}]),i}(D),X=[],K=[],Z=new R,Q=new R,J=function(e){x(i,e);var t=E(i);function i(e){var n;return B(this,i),(n=t.call(this,{type:D.types.BOX})).halfExtents=void 0,n.convexPolyhedronRepresentation=void 0,n.halfExtents=e,n.convexPolyhedronRepresentation=null,n.updateConvexPolyhedronRepresentation(),n.updateBoundingSphereRadius(),n}return A(i,[{key:"updateConvexPolyhedronRepresentation",value:function(){var e=this.halfExtents.x,t=this.halfExtents.y,i=this.halfExtents.z,n=R,o=[new n(-e,-t,-i),new n(e,-t,-i),new n(e,t,-i),new n(-e,t,-i),new n(-e,-t,i),new n(e,-t,i),new n(e,t,i),new n(-e,t,i)],r=[new n(0,0,1),new n(0,1,0),new n(1,0,0)],a=new Y({vertices:o,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:r});this.convexPolyhedronRepresentation=a,a.material=this.material}},{key:"calculateLocalInertia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R;return i.calculateInertia(this.halfExtents,e,t),t}},{key:"getSideNormals",value:function(e,t){var i=e,n=this.halfExtents;if(i[0].set(n.x,0,0),i[1].set(0,n.y,0),i[2].set(0,0,n.z),i[3].set(-n.x,0,0),i[4].set(0,-n.y,0),i[5].set(0,0,-n.z),void 0!==t)for(var o=0;o!==i.length;o++)t.vmult(i[o],i[o]);return i}},{key:"volume",value:function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}},{key:"updateBoundingSphereRadius",value:function(){this.boundingSphereRadius=this.halfExtents.length()}},{key:"forEachWorldCorner",value:function(e,t,i){for(var n=this.halfExtents,o=[[n.x,n.y,n.z],[-n.x,n.y,n.z],[-n.x,-n.y,n.z],[-n.x,-n.y,-n.z],[n.x,-n.y,-n.z],[n.x,n.y,-n.z],[-n.x,n.y,-n.z],[n.x,-n.y,n.z]],r=0;r<o.length;r++)$.set(o[r][0],o[r][1],o[r][2]),t.vmult($,$),e.vadd($,$),i($.x,$.y,$.z)}},{key:"calculateWorldAABB",value:function(e,t,i,n){var o=this.halfExtents;ee[0].set(o.x,o.y,o.z),ee[1].set(-o.x,o.y,o.z),ee[2].set(-o.x,-o.y,o.z),ee[3].set(-o.x,-o.y,-o.z),ee[4].set(o.x,-o.y,-o.z),ee[5].set(o.x,o.y,-o.z),ee[6].set(-o.x,o.y,-o.z),ee[7].set(o.x,-o.y,o.z);var r=ee[0];t.vmult(r,r),e.vadd(r,r),n.copy(r),i.copy(r);for(var a=1;a<8;a++){var s=ee[a];t.vmult(s,s),e.vadd(s,s);var l=s.x,u=s.y,h=s.z;l>n.x&&(n.x=l),u>n.y&&(n.y=u),h>n.z&&(n.z=h),l<i.x&&(i.x=l),u<i.y&&(i.y=u),h<i.z&&(i.z=h)}}}],[{key:"calculateInertia",value:function(e,t,i){var n=e;i.x=1/12*t*(2*n.y*2*n.y+2*n.z*2*n.z),i.y=1/12*t*(2*n.x*2*n.x+2*n.z*2*n.z),i.z=1/12*t*(2*n.y*2*n.y+2*n.x*2*n.x)}}]),i}(D),$=new R,ee=[new R,new R,new R,new R,new R,new R,new R,new R],te=1,ie=2,ne=4,oe=0,re=1,ae=2,se=function(e){x(i,e);var t=E(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B(this,i),(e=t.call(this)).id=void 0,e.index=void 0,e.world=void 0,e.preStep=void 0,e.postStep=void 0,e.vlambda=void 0,e.collisionFilterGroup=void 0,e.collisionFilterMask=void 0,e.collisionResponse=void 0,e.position=void 0,e.previousPosition=void 0,e.interpolatedPosition=void 0,e.initPosition=void 0,e.velocity=void 0,e.initVelocity=void 0,e.force=void 0,e.mass=void 0,e.invMass=void 0,e.material=void 0,e.linearDamping=void 0,e.type=void 0,e.allowSleep=void 0,e.sleepState=void 0,e.sleepSpeedLimit=void 0,e.sleepTimeLimit=void 0,e.timeLastSleepy=void 0,e.wakeUpAfterNarrowphase=void 0,e.torque=void 0,e.quaternion=void 0,e.initQuaternion=void 0,e.previousQuaternion=void 0,e.interpolatedQuaternion=void 0,e.angularVelocity=void 0,e.initAngularVelocity=void 0,e.shapes=void 0,e.shapeOffsets=void 0,e.shapeOrientations=void 0,e.inertia=void 0,e.invInertia=void 0,e.invInertiaWorld=void 0,e.invMassSolve=void 0,e.invInertiaSolve=void 0,e.invInertiaWorldSolve=void 0,e.fixedRotation=void 0,e.angularDamping=void 0,e.linearFactor=void 0,e.angularFactor=void 0,e.aabb=void 0,e.aabbNeedsUpdate=void 0,e.boundingRadius=void 0,e.wlambda=void 0,e.isTrigger=void 0,e.id=i.idCounter++,e.index=-1,e.world=null,e.preStep=null,e.postStep=null,e.vlambda=new R,e.collisionFilterGroup="number"==typeof n.collisionFilterGroup?n.collisionFilterGroup:1,e.collisionFilterMask="number"==typeof n.collisionFilterMask?n.collisionFilterMask:-1,e.collisionResponse="boolean"!=typeof n.collisionResponse||n.collisionResponse,e.position=new R,e.previousPosition=new R,e.interpolatedPosition=new R,e.initPosition=new R,n.position&&(e.position.copy(n.position),e.previousPosition.copy(n.position),e.interpolatedPosition.copy(n.position),e.initPosition.copy(n.position)),e.velocity=new R,n.velocity&&e.velocity.copy(n.velocity),e.initVelocity=new R,e.force=new R;var o="number"==typeof n.mass?n.mass:0;return e.mass=o,e.invMass=o>0?1/o:0,e.material=n.material||null,e.linearDamping="number"==typeof n.linearDamping?n.linearDamping:.01,e.type=o<=0?i.STATIC:i.DYNAMIC,b(n.type)===b(i.STATIC)&&(e.type=n.type),e.allowSleep=void 0===n.allowSleep||n.allowSleep,e.sleepState=i.AWAKE,e.sleepSpeedLimit=void 0!==n.sleepSpeedLimit?n.sleepSpeedLimit:.1,e.sleepTimeLimit=void 0!==n.sleepTimeLimit?n.sleepTimeLimit:1,e.timeLastSleepy=0,e.wakeUpAfterNarrowphase=!1,e.torque=new R,e.quaternion=new V,e.initQuaternion=new V,e.previousQuaternion=new V,e.interpolatedQuaternion=new V,n.quaternion&&(e.quaternion.copy(n.quaternion),e.initQuaternion.copy(n.quaternion),e.previousQuaternion.copy(n.quaternion),e.interpolatedQuaternion.copy(n.quaternion)),e.angularVelocity=new R,n.angularVelocity&&e.angularVelocity.copy(n.angularVelocity),e.initAngularVelocity=new R,e.shapes=[],e.shapeOffsets=[],e.shapeOrientations=[],e.inertia=new R,e.invInertia=new R,e.invInertiaWorld=new F,e.invMassSolve=0,e.invInertiaSolve=new R,e.invInertiaWorldSolve=new F,e.fixedRotation=void 0!==n.fixedRotation&&n.fixedRotation,e.angularDamping=void 0!==n.angularDamping?n.angularDamping:.01,e.linearFactor=new R(1,1,1),n.linearFactor&&e.linearFactor.copy(n.linearFactor),e.angularFactor=new R(1,1,1),n.angularFactor&&e.angularFactor.copy(n.angularFactor),e.aabb=new T,e.aabbNeedsUpdate=!0,e.boundingRadius=0,e.wlambda=new R,e.isTrigger=Boolean(n.isTrigger),n.shape&&e.addShape(n.shape),e.updateMassProperties(),e}return A(i,[{key:"wakeUp",value:function(){var e=this.sleepState;this.sleepState=i.AWAKE,this.wakeUpAfterNarrowphase=!1,e===i.SLEEPING&&this.dispatchEvent(i.wakeupEvent)}},{key:"sleep",value:function(){this.sleepState=i.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}},{key:"sleepTick",value:function(e){if(this.allowSleep){var t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),o=Math.pow(this.sleepSpeedLimit,2);t===i.AWAKE&&n<o?(this.sleepState=i.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(i.sleepyEvent)):t===i.SLEEPY&&n>o?this.wakeUp():t===i.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(i.sleepEvent))}}},{key:"updateSolveMassProperties",value:function(){this.sleepState===i.SLEEPING||this.type===i.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}},{key:"pointToLocalFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R;return e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}},{key:"vectorToLocalFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R;return this.quaternion.conjugate().vmult(e,t),t}},{key:"pointToWorldFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R;return this.quaternion.vmult(e,t),t.vadd(this.position,t),t}},{key:"vectorToWorldFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R;return this.quaternion.vmult(e,t),t}},{key:"addShape",value:function(e,t,i){var n=new R,o=new V;return t&&n.copy(t),i&&o.copy(i),this.shapes.push(e),this.shapeOffsets.push(n),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}},{key:"removeShape",value:function(e){var t=this.shapes.indexOf(e);return-1===t?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}},{key:"updateBoundingRadius",value:function(){for(var e=this.shapes,t=this.shapeOffsets,i=e.length,n=0,o=0;o!==i;o++){var r=e[o];r.updateBoundingSphereRadius();var a=t[o].length(),s=r.boundingSphereRadius;a+s>n&&(n=a+s)}this.boundingRadius=n}},{key:"updateAABB",value:function(){for(var e=this.shapes,t=this.shapeOffsets,i=this.shapeOrientations,n=e.length,o=le,r=ue,a=this.quaternion,s=this.aabb,l=he,u=0;u!==n;u++){var h=e[u];a.vmult(t[u],o),o.vadd(this.position,o),a.mult(i[u],r),h.calculateWorldAABB(o,r,l.lowerBound,l.upperBound),0===u?s.copy(l):s.extend(l)}this.aabbNeedsUpdate=!1}},{key:"updateInertiaWorld",value:function(e){var t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){var i=ce,n=ve;i.setRotationFromQuaternion(this.quaternion),i.transpose(n),i.scale(t,i),i.mmult(n,this.invInertiaWorld)}else;}},{key:"applyForce",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R;if(this.type===i.DYNAMIC){this.sleepState===i.SLEEPING&&this.wakeUp();var n=de;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}}},{key:"applyLocalForce",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R;if(this.type===i.DYNAMIC){var n=pe,o=ye;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,o),this.applyForce(n,o)}}},{key:"applyTorque",value:function(e){this.type===i.DYNAMIC&&(this.sleepState===i.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}},{key:"applyImpulse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R;if(this.type===i.DYNAMIC){this.sleepState===i.SLEEPING&&this.wakeUp();var n=t,o=fe;o.copy(e),o.scale(this.invMass,o),this.velocity.vadd(o,this.velocity);var r=me;n.cross(e,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}}},{key:"applyLocalImpulse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R;if(this.type===i.DYNAMIC){var n=we,o=ge;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,o),this.applyImpulse(n,o)}}},{key:"updateMassProperties",value:function(){var e=be;this.invMass=this.mass>0?1/this.mass:0;var t=this.inertia,i=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),J.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!i?1/t.x:0,t.y>0&&!i?1/t.y:0,t.z>0&&!i?1/t.z:0),this.updateInertiaWorld(!0)}},{key:"getVelocityAtWorldPoint",value:function(e,t){var i=new R;return e.vsub(this.position,i),this.angularVelocity.cross(i,t),this.velocity.vadd(t,t),t}},{key:"integrate",value:function(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),(this.type===i.DYNAMIC||this.type===i.KINEMATIC)&&this.sleepState!==i.SLEEPING){var o=this.velocity,r=this.angularVelocity,a=this.position,s=this.force,l=this.torque,u=this.quaternion,h=this.invMass,c=this.invInertiaWorld,v=this.linearFactor,d=h*e;o.x+=s.x*d*v.x,o.y+=s.y*d*v.y,o.z+=s.z*d*v.z;var p=c.elements,y=this.angularFactor,f=l.x*y.x,m=l.y*y.y,w=l.z*y.z;r.x+=e*(p[0]*f+p[1]*m+p[2]*w),r.y+=e*(p[3]*f+p[4]*m+p[5]*w),r.z+=e*(p[6]*f+p[7]*m+p[8]*w),a.x+=o.x*e,a.y+=o.y*e,a.z+=o.z*e,u.integrate(this.angularVelocity,e,this.angularFactor,u),t&&(n?u.normalizeFast():u.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}}]),i}(W);se.idCounter=0,se.COLLIDE_EVENT_NAME="collide",se.DYNAMIC=te,se.STATIC=ie,se.KINEMATIC=ne,se.AWAKE=oe,se.SLEEPY=re,se.SLEEPING=ae,se.wakeupEvent={type:"wakeup"},se.sleepyEvent={type:"sleepy"},se.sleepEvent={type:"sleep"};var le=new R,ue=new V,he=new T,ce=new F,ve=new F,de=new R,pe=new R,ye=new R,fe=new R,me=new R,we=new R,ge=new R,be=new R,xe=function(){function e(){B(this,e),this.world=void 0,this.useBoundingBoxes=void 0,this.dirty=void 0,this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}return A(e,[{key:"collisionPairs",value:function(e,t,i){throw new Error("collisionPairs not implemented for this BroadPhase class!")}},{key:"needBroadphaseCollision",value:function(e,t){return 0!=(e.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&e.collisionFilterMask)&&(0==(e.type&se.STATIC)&&e.sleepState!==se.SLEEPING||0==(t.type&se.STATIC)&&t.sleepState!==se.SLEEPING)}},{key:"intersectionTest",value:function(e,t,i,n){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,i,n):this.doBoundingSphereBroadphase(e,t,i,n)}},{key:"doBoundingSphereBroadphase",value:function(e,t,i,n){var o=ke;t.position.vsub(e.position,o);var r=Math.pow(e.boundingRadius+t.boundingRadius,2);o.lengthSquared()<r&&(i.push(e),n.push(t))}},{key:"doBoundingBoxBroadphase",value:function(e,t,i,n){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(i.push(e),n.push(t))}},{key:"makePairsUnique",value:function(e,t){for(var i=Ee,n=Se,o=ze,r=e.length,a=0;a!==r;a++)n[a]=e[a],o[a]=t[a];e.length=0,t.length=0;for(var s=0;s!==r;s++){var l=n[s].id,u=o[s].id,h=l<u?l+","+u:u+","+l;i[h]=s,i.keys.push(h)}for(var c=0;c!==i.keys.length;c++){var v=i.keys.pop(),d=i[v];e.push(n[d]),t.push(o[d]),delete i[v]}}},{key:"setWorld",value:function(e){}},{key:"aabbQuery",value:function(e,t,i){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}],[{key:"boundingSphereCheck",value:function(e,t){var i=new R;e.position.vsub(t.position,i);var n=e.shapes[0],o=t.shapes[0];return Math.pow(n.boundingSphereRadius+o.boundingSphereRadius,2)>i.lengthSquared()}}]),e}(),ke=new R,Ee={keys:[]},Se=[],ze=[],Ce=(new R,function(e){x(i,e);var t=E(i);function i(){return B(this,i),t.call(this)}return A(i,[{key:"collisionPairs",value:function(e,t,i){for(var n,o,r=e.bodies,a=r.length,s=0;s!==a;s++)for(var l=0;l!==s;l++)n=r[s],o=r[l],this.needBroadphaseCollision(n,o)&&this.intersectionTest(n,o,t,i)}},{key:"aabbQuery",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=0;n<e.bodies.length;n++){var o=e.bodies[n];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(t)&&i.push(o)}return i}}]),i}(xe)),Be=function(){function e(){B(this,e),this.rayFromWorld=void 0,this.rayToWorld=void 0,this.hitNormalWorld=void 0,this.hitPointWorld=void 0,this.hasHit=void 0,this.shape=void 0,this.body=void 0,this.hitFaceIndex=void 0,this.distance=void 0,this.shouldStop=void 0,this.rayFromWorld=new R,this.rayToWorld=new R,this.hitNormalWorld=new R,this.hitPointWorld=new R,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}return A(e,[{key:"reset",value:function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}},{key:"abort",value:function(){this.shouldStop=!0}},{key:"set",value:function(e,t,i,n,o,r,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(n),this.shape=o,this.body=r,this.distance=a}}]),e}(),Me=1,Ae=2,Fe=4,Pe=function(e,t,i,n,o,r,a){function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new R,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R;B(this,s),this.from=void 0,this.to=void 0,this.direction=void 0,this.precision=void 0,this.checkCollisionResponse=void 0,this.skipBackfaces=void 0,this.collisionFilterMask=void 0,this.collisionFilterGroup=void 0,this.mode=void 0,this.result=void 0,this.hasHit=void 0,this.callback=void 0,this.from=e.clone(),this.to=t.clone(),this.direction=new R,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=s.ANY,this.result=new Be,this.hasHit=!1,this.callback=function(e){}}return A(s,[{key:e,get:function(){return this._intersectSphere}},{key:t,get:function(){return this._intersectPlane}},{key:i,get:function(){return this._intersectBox}},{key:n,get:function(){return this._intersectConvex}},{key:o,get:function(){return this._intersectConvex}},{key:r,get:function(){return this._intersectHeightfield}},{key:a,get:function(){return this._intersectTrimesh}},{key:"intersectWorld",value:function(e,t){return this.mode=t.mode||s.ANY,this.result=t.result||new Be,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||function(){},this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(Re),qe.length=0,e.broadphase.aabbQuery(e,Re,qe),this.intersectBodies(qe),this.hasHit}},{key:"intersectBody",value:function(e,t){t&&(this.result=t,this.updateDirection());var i=this.checkCollisionResponse;if((!i||e.collisionResponse)&&0!=(this.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&this.collisionFilterMask))for(var n=Te,o=Ie,r=0,a=e.shapes.length;r<a;r++){var s=e.shapes[r];if((!i||s.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[r],o),e.quaternion.vmult(e.shapeOffsets[r],n),n.vadd(e.position,n),this.intersectShape(s,o,n,e),this.result.shouldStop))break}}},{key:"intersectBodies",value:function(e,t){t&&(this.result=t,this.updateDirection());for(var i=0,n=e.length;!this.result.shouldStop&&i<n;i++)this.intersectBody(e[i])}},{key:"updateDirection",value:function(){this.to.vsub(this.from,this.direction),this.direction.normalize()}},{key:"intersectShape",value:function(e,t,i,n){var o=function(e,t,i){i.vsub(e,ot);var n=ot.dot(t);return t.scale(n,rt),rt.vadd(e,rt),i.distanceTo(rt)}(this.from,this.direction,i);if(!(o>e.boundingSphereRadius)){var r=this[e.type];r&&r.call(this,e,t,i,n,e)}}},{key:"_intersectBox",value:function(e,t,i,n,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,i,n,o)}},{key:"_intersectPlane",value:function(e,t,i,n,o){var r=this.from,a=this.to,s=this.direction,l=new R(0,0,1);t.vmult(l,l);var u=new R;r.vsub(i,u);var h=u.dot(l);if(a.vsub(i,u),!(h*u.dot(l)>0||r.distanceTo(a)<h)){var c=l.dot(s);if(!(Math.abs(c)<this.precision)){var v=new R,d=new R,p=new R;r.vsub(i,v);var y=-l.dot(v)/c;s.scale(y,d),r.vadd(d,p),this.reportIntersection(l,p,o,n,-1)}}}},{key:"getAABB",value:function(e){var t=e.lowerBound,i=e.upperBound,n=this.to,o=this.from;t.x=Math.min(n.x,o.x),t.y=Math.min(n.y,o.y),t.z=Math.min(n.z,o.z),i.x=Math.max(n.x,o.x),i.y=Math.max(n.y,o.y),i.z=Math.max(n.z,o.z)}},{key:"_intersectHeightfield",value:function(e,t,i,n,o){e.data,e.elementSize;var r=De;r.from.copy(this.from),r.to.copy(this.to),G.pointToLocalFrame(i,t,r.from,r.from),G.pointToLocalFrame(i,t,r.to,r.to),r.updateDirection();var a,s,l,u,h=Ge;a=s=0,l=u=e.data.length-1;var c=new T;r.getAABB(c),e.getIndexOfPosition(c.lowerBound.x,c.lowerBound.y,h,!0),a=Math.max(a,h[0]),s=Math.max(s,h[1]),e.getIndexOfPosition(c.upperBound.x,c.upperBound.y,h,!0),l=Math.min(l,h[0]+1),u=Math.min(u,h[1]+1);for(var v=a;v<l;v++)for(var d=s;d<u;d++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(v,d,c),c.overlapsRay(r)){if(e.getConvexTrianglePillar(v,d,!1),G.pointToWorldFrame(i,t,e.pillarOffset,He),this._intersectConvex(e.pillarConvex,t,He,n,o,_e),this.result.shouldStop)return;e.getConvexTrianglePillar(v,d,!0),G.pointToWorldFrame(i,t,e.pillarOffset,He),this._intersectConvex(e.pillarConvex,t,He,n,o,_e)}}}},{key:"_intersectSphere",value:function(e,t,i,n,o){var r=this.from,a=this.to,s=e.radius,l=Math.pow(a.x-r.x,2)+Math.pow(a.y-r.y,2)+Math.pow(a.z-r.z,2),u=2*((a.x-r.x)*(r.x-i.x)+(a.y-r.y)*(r.y-i.y)+(a.z-r.z)*(r.z-i.z)),h=Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2)+Math.pow(r.z-i.z,2)-Math.pow(s,2),c=Math.pow(u,2)-4*l*h,v=Ue,d=Ye;if(!(c<0))if(0===c)r.lerp(a,c,v),v.vsub(i,d),d.normalize(),this.reportIntersection(d,v,o,n,-1);else{var p=(-u-Math.sqrt(c))/(2*l),y=(-u+Math.sqrt(c))/(2*l);if(p>=0&&p<=1&&(r.lerp(a,p,v),v.vsub(i,d),d.normalize(),this.reportIntersection(d,v,o,n,-1)),this.result.shouldStop)return;y>=0&&y<=1&&(r.lerp(a,y,v),v.vsub(i,d),d.normalize(),this.reportIntersection(d,v,o,n,-1))}}},{key:"_intersectConvex",value:function(e,t,i,n,o,r){for(var a=Xe,l=Ke,u=r&&r.faceList||null,h=e.faces,c=e.vertices,v=e.faceNormals,d=this.direction,p=this.from,y=this.to,f=p.distanceTo(y),m=u?u.length:h.length,w=this.result,g=0;!w.shouldStop&&g<m;g++){var b=u?u[g]:g,x=h[b],k=v[b],E=t,S=i;l.copy(c[x[0]]),E.vmult(l,l),l.vadd(S,l),l.vsub(p,l),E.vmult(k,a);var z=d.dot(a);if(!(Math.abs(z)<this.precision)){var C=a.dot(l)/z;if(!(C<0)){d.scale(C,Le),Le.vadd(p,Le),Oe.copy(c[x[0]]),E.vmult(Oe,Oe),S.vadd(Oe,Oe);for(var B=1;!w.shouldStop&&B<x.length-1;B++){We.copy(c[x[B]]),Ve.copy(c[x[B+1]]),E.vmult(We,We),E.vmult(Ve,Ve),S.vadd(We,We),S.vadd(Ve,Ve);var M=Le.distanceTo(p);!s.pointInTriangle(Le,Oe,We,Ve)&&!s.pointInTriangle(Le,We,Oe,Ve)||M>f||this.reportIntersection(a,Le,o,n,b)}}}}}},{key:"_intersectTrimesh",value:function(e,t,i,n,o,r){var a=Ze,l=it,u=nt,h=Ke,c=Qe,v=Je,d=$e,p=tt,y=et,f=e.indices;e.vertices;var m=this.from,w=this.to,g=this.direction;u.position.copy(i),u.quaternion.copy(t),G.vectorToLocalFrame(i,t,g,c),G.pointToLocalFrame(i,t,m,v),G.pointToLocalFrame(i,t,w,d),d.x*=e.scale.x,d.y*=e.scale.y,d.z*=e.scale.z,v.x*=e.scale.x,v.y*=e.scale.y,v.z*=e.scale.z,d.vsub(v,c),c.normalize();var b=v.distanceSquared(d);e.tree.rayQuery(this,u,l);for(var x=0,k=l.length;!this.result.shouldStop&&x!==k;x++){var E=l[x];e.getNormal(E,a),e.getVertex(f[3*E],Oe),Oe.vsub(v,h);var S=c.dot(a),z=a.dot(h)/S;if(!(z<0)){c.scale(z,Le),Le.vadd(v,Le),e.getVertex(f[3*E+1],We),e.getVertex(f[3*E+2],Ve);var C=Le.distanceSquared(v);!s.pointInTriangle(Le,We,Oe,Ve)&&!s.pointInTriangle(Le,Oe,We,Ve)||C>b||(G.vectorToWorldFrame(t,a,y),G.pointToWorldFrame(i,t,Le,p),this.reportIntersection(y,p,o,n,E))}}l.length=0}},{key:"reportIntersection",value:function(e,t,i,n,o){var r=this.from,a=this.to,l=r.distanceTo(t),u=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(u.hitFaceIndex=void 0!==o?o:-1,this.mode){case s.ALL:this.hasHit=!0,u.set(r,a,e,t,i,n,l),u.hasHit=!0,this.callback(u);break;case s.CLOSEST:(l<u.distance||!u.hasHit)&&(this.hasHit=!0,u.hasHit=!0,u.set(r,a,e,t,i,n,l));break;case s.ANY:this.hasHit=!0,u.hasHit=!0,u.set(r,a,e,t,i,n,l),u.shouldStop=!0}}}],[{key:"pointInTriangle",value:function(e,t,i,n){n.vsub(t,ot),i.vsub(t,je),e.vsub(t,Ne);var o,r,a=ot.dot(ot),s=ot.dot(je),l=ot.dot(Ne),u=je.dot(je),h=je.dot(Ne);return(o=u*l-s*h)>=0&&(r=a*h-s*l)>=0&&o+r<a*u-s*s}}]),s}(D.types.SPHERE,D.types.PLANE,D.types.BOX,D.types.CYLINDER,D.types.CONVEXPOLYHEDRON,D.types.HEIGHTFIELD,D.types.TRIMESH);Pe.CLOSEST=Me,Pe.ANY=Ae,Pe.ALL=Fe;var Re=new T,qe=[],je=new R,Ne=new R,Te=new R,Ie=new V,Le=new R,Oe=new R,We=new R,Ve=new R,_e={faceList:[0]},He=new R,De=new Pe,Ge=[],Ue=new R,Ye=new R,Xe=new R,Ke=new R,Ze=new R,Qe=new R,Je=new R,$e=new R,et=new R,tt=new R;new T;var it=[],nt=new G,ot=new R,rt=new R;var at=function(){function e(){B(this,e)}return A(e,null,[{key:"defaults",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;for(var i in t)i in e||(e[i]=t[i]);return e}}]),e}(),st=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};B(this,e),this.equations=void 0,this.bodyA=void 0,this.bodyB=void 0,this.id=void 0,this.collideConnected=void 0,n=at.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=i,this.id=e.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),i&&i.wakeUp())}return A(e,[{key:"update",value:function(){throw new Error("method update() not implmemented in this Constraint subclass!")}},{key:"enable",value:function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!0}},{key:"disable",value:function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!1}}]),e}();st.idCounter=0;var lt=function(){function e(){B(this,e),this.spatial=void 0,this.rotational=void 0,this.spatial=new R,this.rotational=new R}return A(e,[{key:"multiplyElement",value:function(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}},{key:"multiplyVectors",value:function(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}]),e}(),ut=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1e6,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e6;B(this,e),this.id=void 0,this.minForce=void 0,this.maxForce=void 0,this.bi=void 0,this.bj=void 0,this.si=void 0,this.sj=void 0,this.a=void 0,this.b=void 0,this.eps=void 0,this.jacobianElementA=void 0,this.jacobianElementB=void 0,this.enabled=void 0,this.multiplier=void 0,this.id=e.idCounter++,this.minForce=n,this.maxForce=o,this.bi=t,this.bj=i,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new lt,this.jacobianElementB=new lt,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}return A(e,[{key:"setSpookParams",value:function(e,t,i){var n=t,o=e,r=i;this.a=4/(r*(1+4*n)),this.b=4*n/(1+4*n),this.eps=4/(r*r*o*(1+4*n))}},{key:"computeB",value:function(e,t,i){var n=this.computeGW();return-this.computeGq()*e-n*t-this.computeGiMf()*i}},{key:"computeGq",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.position,r=n.position;return e.spatial.dot(o)+t.spatial.dot(r)}},{key:"computeGW",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.velocity,r=n.velocity,a=i.angularVelocity,s=n.angularVelocity;return e.multiplyVectors(o,a)+t.multiplyVectors(r,s)}},{key:"computeGWlambda",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.vlambda,r=n.vlambda,a=i.wlambda,s=n.wlambda;return e.multiplyVectors(o,a)+t.multiplyVectors(r,s)}},{key:"computeGiMf",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.force,r=i.torque,a=n.force,s=n.torque,l=i.invMassSolve,u=n.invMassSolve;return o.scale(l,ht),a.scale(u,ct),i.invInertiaWorldSolve.vmult(r,vt),n.invInertiaWorldSolve.vmult(s,dt),e.multiplyVectors(ht,vt)+t.multiplyVectors(ct,dt)}},{key:"computeGiMGt",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.invMassSolve,r=n.invMassSolve,a=i.invInertiaWorldSolve,s=n.invInertiaWorldSolve,l=o+r;return a.vmult(e.rotational,pt),l+=pt.dot(e.rotational),s.vmult(t.rotational,pt),l+=pt.dot(t.rotational)}},{key:"addToWlambda",value:function(e){var t=this.jacobianElementA,i=this.jacobianElementB,n=this.bi,o=this.bj,r=yt;n.vlambda.addScaledVector(n.invMassSolve*e,t.spatial,n.vlambda),o.vlambda.addScaledVector(o.invMassSolve*e,i.spatial,o.vlambda),n.invInertiaWorldSolve.vmult(t.rotational,r),n.wlambda.addScaledVector(e,r,n.wlambda),o.invInertiaWorldSolve.vmult(i.rotational,r),o.wlambda.addScaledVector(e,r,o.wlambda)}},{key:"computeC",value:function(){return this.computeGiMGt()+this.eps}}]),e}();ut.idCounter=0;var ht=new R,ct=new R,vt=new R,dt=new R,pt=new R,yt=new R,ft=function(e){x(i,e);var t=E(i);function i(e,n){var o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e6;return B(this,i),(o=t.call(this,e,n,0,r)).restitution=void 0,o.ri=void 0,o.rj=void 0,o.ni=void 0,o.restitution=0,o.ri=new R,o.rj=new R,o.ni=new R,o}return A(i,[{key:"computeB",value:function(e){var t=this.a,i=this.b,n=this.bi,o=this.bj,r=this.ri,a=this.rj,s=mt,l=wt,u=n.velocity,h=n.angularVelocity;n.force,n.torque;var c=o.velocity,v=o.angularVelocity;o.force,o.torque;var d=gt,p=this.jacobianElementA,y=this.jacobianElementB,f=this.ni;r.cross(f,s),a.cross(f,l),f.negate(p.spatial),s.negate(p.rotational),y.spatial.copy(f),y.rotational.copy(l),d.copy(o.position),d.vadd(a,d),d.vsub(n.position,d),d.vsub(r,d);var m=f.dot(d),w=this.restitution+1;return-m*t-(w*c.dot(f)-w*u.dot(f)+v.dot(l)-h.dot(s))*i-e*this.computeGiMf()}},{key:"getImpactVelocityAlongNormal",value:function(){var e=bt,t=xt,i=kt,n=Et,o=St;return this.bi.position.vadd(this.ri,i),this.bj.position.vadd(this.rj,n),this.bi.getVelocityAtWorldPoint(i,e),this.bj.getVelocityAtWorldPoint(n,t),e.vsub(t,o),this.ni.dot(o)}}]),i}(ut),mt=new R,wt=new R,gt=new R,bt=new R,xt=new R,kt=new R,Et=new R,St=new R,zt=(new R,new R,new R,new R,new R,new R,function(e){x(i,e);var t=E(i);function i(e,n,o){var r;return B(this,i),(r=t.call(this,e,n,-o,o)).ri=void 0,r.rj=void 0,r.t=void 0,r.ri=new R,r.rj=new R,r.t=new R,r}return A(i,[{key:"computeB",value:function(e){this.a;var t=this.b;this.bi,this.bj;var i=this.ri,n=this.rj,o=Ct,r=Bt,a=this.t;i.cross(a,o),n.cross(a,r);var s=this.jacobianElementA,l=this.jacobianElementB;return a.negate(s.spatial),o.negate(s.rotational),l.spatial.copy(a),l.rotational.copy(r),-this.computeGW()*t-e*this.computeGiMf()}}]),i}(ut)),Ct=new R,Bt=new R,Mt=A((function e(t,i,n){B(this,e),this.id=void 0,this.materials=void 0,this.friction=void 0,this.restitution=void 0,this.contactEquationStiffness=void 0,this.contactEquationRelaxation=void 0,this.frictionEquationStiffness=void 0,this.frictionEquationRelaxation=void 0,n=at.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=e.idCounter++,this.materials=[t,i],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}));Mt.idCounter=0;var At=A((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B(this,e),this.name=void 0,this.id=void 0,this.friction=void 0,this.restitution=void 0;var i="";"string"==typeof t&&(i=t,t={}),this.name=i,this.id=e.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}));At.idCounter=0;new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R;new Pe;new R,new R,new R(1,0,0),new R(0,1,0),new R(0,0,1),new R,new R,new R,new R;new R,new R,new R,new R;new R,new R,new R;var Ft=function(e){x(i,e);var t=E(i);function i(e){var n;if(B(this,i),(n=t.call(this,{type:D.types.SPHERE})).radius=void 0,n.radius=void 0!==e?e:1,n.radius<0)throw new Error("The sphere radius cannot be negative.");return n.updateBoundingSphereRadius(),n}return A(i,[{key:"calculateLocalInertia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R,i=2*e*this.radius*this.radius/5;return t.x=i,t.y=i,t.z=i,t}},{key:"volume",value:function(){return 4*Math.PI*Math.pow(this.radius,3)/3}},{key:"updateBoundingSphereRadius",value:function(){this.boundingSphereRadius=this.radius}},{key:"calculateWorldAABB",value:function(e,t,i,n){for(var o=this.radius,r=["x","y","z"],a=0;a<r.length;a++){var s=r[a];i[s]=e[s]-o,n[s]=e[s]+o}}}]),i}(D);new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R;new R,new T,new R,new T,new R,new R,new R,new R,new R,new R,new R,new T,new R,new G,new T;var Pt=function(){function e(){B(this,e),this.equations=void 0,this.equations=[]}return A(e,[{key:"solve",value:function(e,t){return 0}},{key:"addEquation",value:function(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}},{key:"removeEquation",value:function(e){var t=this.equations,i=t.indexOf(e);-1!==i&&t.splice(i,1)}},{key:"removeAllEquations",value:function(){this.equations.length=0}}]),e}(),Rt=function(e){x(i,e);var t=E(i);function i(){var e;return B(this,i),(e=t.call(this)).iterations=void 0,e.tolerance=void 0,e.iterations=10,e.tolerance=1e-7,e}return A(i,[{key:"solve",value:function(e,t){var i,n,o,r,a,s=0,l=this.iterations,u=this.tolerance*this.tolerance,h=this.equations,c=h.length,v=t.bodies,d=v.length,p=e;if(0!==c)for(var y=0;y!==d;y++)v[y].updateSolveMassProperties();var f=jt,m=Nt,w=qt;f.length=c,m.length=c,w.length=c;for(var g=0;g!==c;g++){var b=h[g];w[g]=0,m[g]=b.computeB(p),f[g]=1/b.computeC()}if(0!==c){for(var x=0;x!==d;x++){var k=v[x],E=k.vlambda,S=k.wlambda;E.set(0,0,0),S.set(0,0,0)}for(s=0;s!==l;s++){r=0;for(var z=0;z!==c;z++){var C=h[z];i=m[z],n=f[z],(a=w[z])+(o=n*(i-C.computeGWlambda()-C.eps*a))<C.minForce?o=C.minForce-a:a+o>C.maxForce&&(o=C.maxForce-a),w[z]+=o,r+=o>0?o:-o,C.addToWlambda(o)}if(r*r<u)break}for(var B=0;B!==d;B++){var M=v[B],A=M.velocity,F=M.angularVelocity;M.vlambda.vmul(M.linearFactor,M.vlambda),A.vadd(M.vlambda,A),M.wlambda.vmul(M.angularFactor,M.wlambda),F.vadd(M.wlambda,F)}for(var P=h.length,R=1/p;P--;)h[P].multiplier=w[P]*R}return s}}]),i}(Pt),qt=[],jt=[],Nt=[];se.STATIC;var Tt=function(){function e(){B(this,e),this.objects=[],this.type=Object}return A(e,[{key:"release",value:function(){for(var e=arguments.length,t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}},{key:"get",value:function(){return 0===this.objects.length?this.constructObject():this.objects.pop()}},{key:"constructObject",value:function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{key:"resize",value:function(e){for(var t=this.objects;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}]),e}(),It=function(e){x(i,e);var t=E(i);function i(){var e;B(this,i);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).type=R,e}return A(i,[{key:"constructObject",value:function(){return new R}}]),i}(Tt),Lt={sphereSphere:D.types.SPHERE,spherePlane:D.types.SPHERE|D.types.PLANE,boxBox:D.types.BOX|D.types.BOX,sphereBox:D.types.SPHERE|D.types.BOX,planeBox:D.types.PLANE|D.types.BOX,convexConvex:D.types.CONVEXPOLYHEDRON,sphereConvex:D.types.SPHERE|D.types.CONVEXPOLYHEDRON,planeConvex:D.types.PLANE|D.types.CONVEXPOLYHEDRON,boxConvex:D.types.BOX|D.types.CONVEXPOLYHEDRON,sphereHeightfield:D.types.SPHERE|D.types.HEIGHTFIELD,boxHeightfield:D.types.BOX|D.types.HEIGHTFIELD,convexHeightfield:D.types.CONVEXPOLYHEDRON|D.types.HEIGHTFIELD,sphereParticle:D.types.PARTICLE|D.types.SPHERE,planeParticle:D.types.PLANE|D.types.PARTICLE,boxParticle:D.types.BOX|D.types.PARTICLE,convexParticle:D.types.PARTICLE|D.types.CONVEXPOLYHEDRON,cylinderCylinder:D.types.CYLINDER,sphereCylinder:D.types.SPHERE|D.types.CYLINDER,planeCylinder:D.types.PLANE|D.types.CYLINDER,boxCylinder:D.types.BOX|D.types.CYLINDER,convexCylinder:D.types.CONVEXPOLYHEDRON|D.types.CYLINDER,heightfieldCylinder:D.types.HEIGHTFIELD|D.types.CYLINDER,particleCylinder:D.types.PARTICLE|D.types.CYLINDER,sphereTrimesh:D.types.SPHERE|D.types.TRIMESH,planeTrimesh:D.types.PLANE|D.types.TRIMESH},Ot=function(e,t,i,n,o,r,a,s,l,u,h,c,v,d,p,y,f,m,w,g,b,x,k,E,S){function z(e){B(this,z),this.contactPointPool=void 0,this.frictionEquationPool=void 0,this.result=void 0,this.frictionResult=void 0,this.v3pool=void 0,this.world=void 0,this.currentContactMaterial=void 0,this.enableFrictionReduction=void 0,this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new It,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}return A(z,[{key:e,get:function(){return this.sphereSphere}},{key:t,get:function(){return this.spherePlane}},{key:i,get:function(){return this.boxBox}},{key:n,get:function(){return this.sphereBox}},{key:o,get:function(){return this.planeBox}},{key:r,get:function(){return this.convexConvex}},{key:a,get:function(){return this.sphereConvex}},{key:s,get:function(){return this.planeConvex}},{key:l,get:function(){return this.boxConvex}},{key:u,get:function(){return this.sphereHeightfield}},{key:h,get:function(){return this.boxHeightfield}},{key:c,get:function(){return this.convexHeightfield}},{key:v,get:function(){return this.sphereParticle}},{key:d,get:function(){return this.planeParticle}},{key:p,get:function(){return this.boxParticle}},{key:y,get:function(){return this.convexParticle}},{key:f,get:function(){return this.convexConvex}},{key:m,get:function(){return this.sphereConvex}},{key:w,get:function(){return this.planeConvex}},{key:g,get:function(){return this.boxConvex}},{key:b,get:function(){return this.convexConvex}},{key:x,get:function(){return this.heightfieldCylinder}},{key:k,get:function(){return this.particleCylinder}},{key:E,get:function(){return this.sphereTrimesh}},{key:S,get:function(){return this.planeTrimesh}},{key:"createContactEquation",value:function(e,t,i,n,o,r){var a;this.contactPointPool.length?((a=this.contactPointPool.pop()).bi=e,a.bj=t):a=new ft(e,t),a.enabled=e.collisionResponse&&t.collisionResponse&&i.collisionResponse&&n.collisionResponse;var s=this.currentContactMaterial;a.restitution=s.restitution,a.setSpookParams(s.contactEquationStiffness,s.contactEquationRelaxation,this.world.dt);var l=i.material||e.material,u=n.material||t.material;return l&&u&&l.restitution>=0&&u.restitution>=0&&(a.restitution=l.restitution*u.restitution),a.si=o||i,a.sj=r||n,a}},{key:"createFrictionEquationsFromContact",value:function(e,t){var i=e.bi,n=e.bj,o=e.si,r=e.sj,a=this.world,s=this.currentContactMaterial,l=s.friction,u=o.material||i.material,h=r.material||n.material;if(u&&h&&u.friction>=0&&h.friction>=0&&(l=u.friction*h.friction),l>0){var c=l*a.gravity.length(),v=i.invMass+n.invMass;v>0&&(v=1/v);var d=this.frictionEquationPool,p=d.length?d.pop():new zt(i,n,c*v),y=d.length?d.pop():new zt(i,n,c*v);return p.bi=y.bi=i,p.bj=y.bj=n,p.minForce=y.minForce=-c*v,p.maxForce=y.maxForce=c*v,p.ri.copy(e.ri),p.rj.copy(e.rj),y.ri.copy(e.ri),y.rj.copy(e.rj),e.ni.tangents(p.t,y.t),p.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),y.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),p.enabled=y.enabled=e.enabled,t.push(p,y),!0}return!1}},{key:"createFrictionFromAverage",value:function(e){var t=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(t,this.frictionResult)&&1!==e){var i=this.frictionResult[this.frictionResult.length-2],n=this.frictionResult[this.frictionResult.length-1];Wt.setZero(),Vt.setZero(),_t.setZero();var o=t.bi;t.bj;for(var r=0;r!==e;r++)(t=this.result[this.result.length-1-r]).bi!==o?(Wt.vadd(t.ni,Wt),Vt.vadd(t.ri,Vt),_t.vadd(t.rj,_t)):(Wt.vsub(t.ni,Wt),Vt.vadd(t.rj,Vt),_t.vadd(t.ri,_t));var a=1/e;Vt.scale(a,i.ri),_t.scale(a,i.rj),n.ri.copy(i.ri),n.rj.copy(i.rj),Wt.normalize(),Wt.tangents(i.t,n.t)}}},{key:"getContacts",value:function(e,t,i,n,o,r,a){this.contactPointPool=o,this.frictionEquationPool=a,this.result=n,this.frictionResult=r;for(var s=Gt,l=Ut,u=Ht,h=Dt,c=0,v=e.length;c!==v;c++){var d=e[c],p=t[c],y=null;d.material&&p.material&&(y=i.getContactMaterial(d.material,p.material)||null);for(var f=d.type&se.KINEMATIC&&p.type&se.STATIC||d.type&se.STATIC&&p.type&se.KINEMATIC||d.type&se.KINEMATIC&&p.type&se.KINEMATIC,m=0;m<d.shapes.length;m++){d.quaternion.mult(d.shapeOrientations[m],s),d.quaternion.vmult(d.shapeOffsets[m],u),u.vadd(d.position,u);for(var w=d.shapes[m],g=0;g<p.shapes.length;g++){p.quaternion.mult(p.shapeOrientations[g],l),p.quaternion.vmult(p.shapeOffsets[g],h),h.vadd(p.position,h);var b=p.shapes[g];if(w.collisionFilterMask&b.collisionFilterGroup&&b.collisionFilterMask&w.collisionFilterGroup&&!(u.distanceTo(h)>w.boundingSphereRadius+b.boundingSphereRadius)){var x=null;w.material&&b.material&&(x=i.getContactMaterial(w.material,b.material)||null),this.currentContactMaterial=x||y||i.defaultContactMaterial;var k=this[w.type|b.type];if(k){(w.type<b.type?k.call(this,w,b,u,h,s,l,d,p,w,b,f):k.call(this,b,w,h,u,l,s,p,d,w,b,f))&&f&&(i.shapeOverlapKeeper.set(w.id,b.id),i.bodyOverlapKeeper.set(d.id,p.id))}}}}}}},{key:"sphereSphere",value:function(e,t,i,n,o,r,a,s,l,u,h){if(h)return i.distanceSquared(n)<Math.pow(e.radius+t.radius,2);var c=this.createContactEquation(a,s,e,t,l,u);n.vsub(i,c.ni),c.ni.normalize(),c.ri.copy(c.ni),c.rj.copy(c.ni),c.ri.scale(e.radius,c.ri),c.rj.scale(-t.radius,c.rj),c.ri.vadd(i,c.ri),c.ri.vsub(a.position,c.ri),c.rj.vadd(n,c.rj),c.rj.vsub(s.position,c.rj),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}},{key:"spherePlane",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=this.createContactEquation(a,s,e,t,l,u);if(c.ni.set(0,0,1),r.vmult(c.ni,c.ni),c.ni.negate(c.ni),c.ni.normalize(),c.ni.scale(e.radius,c.ri),i.vsub(n,ci),c.ni.scale(c.ni.dot(ci),vi),ci.vsub(vi,c.rj),-ci.dot(c.ni)<=e.radius){if(h)return!0;var v=c.ri,d=c.rj;v.vadd(i,v),v.vsub(a.position,v),d.vadd(n,d),d.vsub(s.position,d),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}}},{key:"boxBox",value:function(e,t,i,n,o,r,a,s,l,u,h){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,i,n,o,r,a,s,e,t,h)}},{key:"sphereBox",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=this.v3pool,v=xi;i.vsub(n,mi),t.getSideNormals(v,r);for(var d=e.radius,p=!1,y=Ei,f=Si,m=zi,w=null,g=0,b=0,x=0,k=null,E=0,S=v.length;E!==S&&!1===p;E++){var z=wi;z.copy(v[E]);var C=z.length();z.normalize();var B=mi.dot(z);if(B<C+d&&B>0){var M=gi,A=bi;M.copy(v[(E+1)%3]),A.copy(v[(E+2)%3]);var F=M.length(),P=A.length();M.normalize(),A.normalize();var R=mi.dot(M),q=mi.dot(A);if(R<F&&R>-F&&q<P&&q>-P){var j=Math.abs(B-C-d);if((null===k||j<k)&&(k=j,b=R,x=q,w=C,y.copy(z),f.copy(M),m.copy(A),g++,h))return!0}}}if(g){p=!0;var N=this.createContactEquation(a,s,e,t,l,u);y.scale(-d,N.ri),N.ni.copy(y),N.ni.negate(N.ni),y.scale(w,y),f.scale(b,f),y.vadd(f,y),m.scale(x,m),y.vadd(m,N.rj),N.ri.vadd(i,N.ri),N.ri.vsub(a.position,N.ri),N.rj.vadd(n,N.rj),N.rj.vsub(s.position,N.rj),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult)}for(var T=c.get(),I=ki,L=0;2!==L&&!p;L++)for(var O=0;2!==O&&!p;O++)for(var W=0;2!==W&&!p;W++)if(T.set(0,0,0),L?T.vadd(v[0],T):T.vsub(v[0],T),O?T.vadd(v[1],T):T.vsub(v[1],T),W?T.vadd(v[2],T):T.vsub(v[2],T),n.vadd(T,I),I.vsub(i,I),I.lengthSquared()<d*d){if(h)return!0;p=!0;var V=this.createContactEquation(a,s,e,t,l,u);V.ri.copy(I),V.ri.normalize(),V.ni.copy(V.ri),V.ri.scale(d,V.ri),V.rj.copy(T),V.ri.vadd(i,V.ri),V.ri.vsub(a.position,V.ri),V.rj.vadd(n,V.rj),V.rj.vsub(s.position,V.rj),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult)}c.release(T),T=null;for(var _=c.get(),H=c.get(),D=c.get(),G=c.get(),U=c.get(),Y=v.length,X=0;X!==Y&&!p;X++)for(var K=0;K!==Y&&!p;K++)if(X%3!=K%3){v[K].cross(v[X],_),_.normalize(),v[X].vadd(v[K],H),D.copy(i),D.vsub(H,D),D.vsub(n,D);var Z=D.dot(_);_.scale(Z,G);for(var Q=0;Q===X%3||Q===K%3;)Q++;U.copy(i),U.vsub(G,U),U.vsub(H,U),U.vsub(n,U);var J=Math.abs(Z),$=U.length();if(J<v[Q].length()&&$<d){if(h)return!0;p=!0;var ee=this.createContactEquation(a,s,e,t,l,u);H.vadd(G,ee.rj),ee.rj.copy(ee.rj),U.negate(ee.ni),ee.ni.normalize(),ee.ri.copy(ee.rj),ee.ri.vadd(n,ee.ri),ee.ri.vsub(i,ee.ri),ee.ri.normalize(),ee.ri.scale(d,ee.ri),ee.ri.vadd(i,ee.ri),ee.ri.vsub(a.position,ee.ri),ee.rj.vadd(n,ee.rj),ee.rj.vsub(s.position,ee.rj),this.result.push(ee),this.createFrictionEquationsFromContact(ee,this.frictionResult)}}c.release(_,H,D,G,U)}},{key:"planeBox",value:function(e,t,i,n,o,r,a,s,l,u,h){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,i,n,o,r,a,s,e,t,h)}},{key:"convexConvex",value:function(e,t,i,n,o,r,a,s,l,u,h,c,v){var d=Wi;if(!(i.distanceTo(n)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,i,o,n,r,d,c,v)){var p=[],y=Vi;e.clipAgainstHull(i,o,t,n,r,d,-100,100,p);for(var f=0,m=0;m!==p.length;m++){if(h)return!0;var w=this.createContactEquation(a,s,e,t,l,u),g=w.ri,b=w.rj;d.negate(w.ni),p[m].normal.negate(y),y.scale(p[m].depth,y),p[m].point.vadd(y,g),b.copy(p[m].point),g.vsub(i,g),b.vsub(n,b),g.vadd(i,g),g.vsub(a.position,g),b.vadd(n,b),b.vsub(s.position,b),this.result.push(w),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(w,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}}},{key:"sphereConvex",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=this.v3pool;i.vsub(n,Ci);for(var v=t.faceNormals,d=t.faces,p=t.vertices,y=e.radius,f=!1,m=0;m!==p.length;m++){var w=p[m],g=Fi;r.vmult(w,g),n.vadd(g,g);var b=Ai;if(g.vsub(i,b),b.lengthSquared()<y*y){if(h)return!0;f=!0;var x=this.createContactEquation(a,s,e,t,l,u);return x.ri.copy(b),x.ri.normalize(),x.ni.copy(x.ri),x.ri.scale(y,x.ri),g.vsub(n,x.rj),x.ri.vadd(i,x.ri),x.ri.vsub(a.position,x.ri),x.rj.vadd(n,x.rj),x.rj.vsub(s.position,x.rj),this.result.push(x),void this.createFrictionEquationsFromContact(x,this.frictionResult)}}for(var k=0,E=d.length;k!==E&&!1===f;k++){var S=v[k],z=d[k],C=Pi;r.vmult(S,C);var B=Ri;r.vmult(p[z[0]],B),B.vadd(n,B);var M=qi;C.scale(-y,M),i.vadd(M,M);var A=ji;M.vsub(B,A);var F=A.dot(C),P=Ni;if(i.vsub(B,P),F<0&&P.dot(C)>0){for(var R=[],q=0,j=z.length;q!==j;q++){var N=c.get();r.vmult(p[z[q]],N),n.vadd(N,N),R.push(N)}if(fi(R,C,i)){if(h)return!0;f=!0;var T=this.createContactEquation(a,s,e,t,l,u);C.scale(-y,T.ri),C.negate(T.ni);var I=c.get();C.scale(-F,I);var L=c.get();C.scale(-y,L),i.vsub(n,T.rj),T.rj.vadd(L,T.rj),T.rj.vadd(I,T.rj),T.rj.vadd(n,T.rj),T.rj.vsub(s.position,T.rj),T.ri.vadd(i,T.ri),T.ri.vsub(a.position,T.ri),c.release(I),c.release(L),this.result.push(T),this.createFrictionEquationsFromContact(T,this.frictionResult);for(var O=0,W=R.length;O!==W;O++)c.release(R[O]);return}for(var V=0;V!==z.length;V++){var _=c.get(),H=c.get();r.vmult(p[z[(V+1)%z.length]],_),r.vmult(p[z[(V+2)%z.length]],H),n.vadd(_,_),n.vadd(H,H);var D=Bi;H.vsub(_,D);var G=Mi;D.unit(G);var U=c.get(),Y=c.get();i.vsub(_,Y);var X=Y.dot(G);G.scale(X,U),U.vadd(_,U);var K=c.get();if(U.vsub(i,K),X>0&&X*X<D.lengthSquared()&&K.lengthSquared()<y*y){if(h)return!0;var Z=this.createContactEquation(a,s,e,t,l,u);U.vsub(n,Z.rj),U.vsub(i,Z.ni),Z.ni.normalize(),Z.ni.scale(y,Z.ri),Z.rj.vadd(n,Z.rj),Z.rj.vsub(s.position,Z.rj),Z.ri.vadd(i,Z.ri),Z.ri.vsub(a.position,Z.ri),this.result.push(Z),this.createFrictionEquationsFromContact(Z,this.frictionResult);for(var Q=0,J=R.length;Q!==J;Q++)c.release(R[Q]);return c.release(_),c.release(H),c.release(U),c.release(K),void c.release(Y)}c.release(_),c.release(H),c.release(U),c.release(K),c.release(Y)}for(var $=0,ee=R.length;$!==ee;$++)c.release(R[$])}}}},{key:"planeConvex",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=Ti,v=Ii;v.set(0,0,1),o.vmult(v,v);for(var d=0,p=Li,y=0;y!==t.vertices.length;y++){if(c.copy(t.vertices[y]),r.vmult(c,c),n.vadd(c,c),c.vsub(i,p),v.dot(p)<=0){if(h)return!0;var f=this.createContactEquation(a,s,e,t,l,u),m=Oi;v.scale(v.dot(p),m),c.vsub(m,m),m.vsub(i,f.ri),f.ni.copy(v),c.vsub(n,f.rj),f.ri.vadd(i,f.ri),f.ri.vsub(a.position,f.ri),f.rj.vadd(n,f.rj),f.rj.vsub(s.position,f.rj),this.result.push(f),d++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(f,this.frictionResult)}}this.enableFrictionReduction&&d&&this.createFrictionFromAverage(d)}},{key:"boxConvex",value:function(e,t,i,n,o,r,a,s,l,u,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,i,n,o,r,a,s,e,t,h)}},{key:"sphereHeightfield",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=t.data,v=e.radius,d=t.elementSize,p=tn,y=en;G.pointToLocalFrame(n,r,i,y);var f=Math.floor((y.x-v)/d)-1,m=Math.ceil((y.x+v)/d)+1,w=Math.floor((y.y-v)/d)-1,g=Math.ceil((y.y+v)/d)+1;if(!(m<0||g<0||f>c.length||w>c[0].length)){f<0&&(f=0),m<0&&(m=0),w<0&&(w=0),g<0&&(g=0),f>=c.length&&(f=c.length-1),m>=c.length&&(m=c.length-1),g>=c[0].length&&(g=c[0].length-1),w>=c[0].length&&(w=c[0].length-1);var b=[];t.getRectMinMax(f,w,m,g,b);var x=b[0],k=b[1];if(!(y.z-v>k||y.z+v<x))for(var E=this.result,S=f;S<m;S++)for(var z=w;z<g;z++){var C=E.length,B=!1;if(t.getConvexTrianglePillar(S,z,!1),G.pointToWorldFrame(n,r,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(B=this.sphereConvex(e,t.pillarConvex,i,p,o,r,a,s,e,t,h)),h&&B)return!0;if(t.getConvexTrianglePillar(S,z,!0),G.pointToWorldFrame(n,r,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(B=this.sphereConvex(e,t.pillarConvex,i,p,o,r,a,s,e,t,h)),h&&B)return!0;if(E.length-C>2)return}}}},{key:"boxHeightfield",value:function(e,t,i,n,o,r,a,s,l,u,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,i,n,o,r,a,s,e,t,h)}},{key:"convexHeightfield",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=t.data,v=t.elementSize,d=e.boundingSphereRadius,p=Ji,y=$i,f=Qi;G.pointToLocalFrame(n,r,i,f);var m=Math.floor((f.x-d)/v)-1,w=Math.ceil((f.x+d)/v)+1,g=Math.floor((f.y-d)/v)-1,b=Math.ceil((f.y+d)/v)+1;if(!(w<0||b<0||m>c.length||g>c[0].length)){m<0&&(m=0),w<0&&(w=0),g<0&&(g=0),b<0&&(b=0),m>=c.length&&(m=c.length-1),w>=c.length&&(w=c.length-1),b>=c[0].length&&(b=c[0].length-1),g>=c[0].length&&(g=c[0].length-1);var x=[];t.getRectMinMax(m,g,w,b,x);var k=x[0],E=x[1];if(!(f.z-d>E||f.z+d<k))for(var S=m;S<w;S++)for(var z=g;z<b;z++){var C=!1;if(t.getConvexTrianglePillar(S,z,!1),G.pointToWorldFrame(n,r,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(C=this.convexConvex(e,t.pillarConvex,i,p,o,r,a,s,null,null,h,y,null)),h&&C)return!0;if(t.getConvexTrianglePillar(S,z,!0),G.pointToWorldFrame(n,r,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(C=this.convexConvex(e,t.pillarConvex,i,p,o,r,a,s,null,null,h,y,null)),h&&C)return!0}}}},{key:"sphereParticle",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=Gi;if(c.set(0,0,1),n.vsub(i,c),c.lengthSquared()<=e.radius*e.radius){if(h)return!0;var v=this.createContactEquation(s,a,t,e,l,u);c.normalize(),v.rj.copy(c),v.rj.scale(e.radius,v.rj),v.ni.copy(c),v.ni.negate(v.ni),v.ri.set(0,0,0),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}},{key:"planeParticle",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=_i;c.set(0,0,1),a.quaternion.vmult(c,c);var v=Hi;if(n.vsub(a.position,v),c.dot(v)<=0){if(h)return!0;var d=this.createContactEquation(s,a,t,e,l,u);d.ni.copy(c),d.ni.negate(d.ni),d.ri.set(0,0,0);var p=Di;c.scale(c.dot(n),p),n.vsub(p,p),d.rj.copy(p),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}}},{key:"boxParticle",value:function(e,t,i,n,o,r,a,s,l,u,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,i,n,o,r,a,s,e,t,h)}},{key:"convexParticle",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=-1,v=Xi,d=Zi,p=null,y=Yi;if(y.copy(n),y.vsub(i,y),o.conjugate(Ui),Ui.vmult(y,y),e.pointIsInside(y)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(i,o),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(o);for(var f=0,m=e.faces.length;f!==m;f++){var w=[e.worldVertices[e.faces[f][0]]],g=e.worldFaceNormals[f];n.vsub(w[0],Ki);var b=-g.dot(Ki);if(null===p||Math.abs(b)<Math.abs(p)){if(h)return!0;p=b,c=f,v.copy(g)}}if(-1!==c){var x=this.createContactEquation(s,a,t,e,l,u);v.scale(p,d),d.vadd(n,d),d.vsub(i,d),x.rj.copy(d),v.negate(x.ni),x.ri.set(0,0,0);var k=x.ri,E=x.rj;k.vadd(n,k),k.vsub(s.position,k),E.vadd(i,E),E.vsub(a.position,E),this.result.push(x),this.createFrictionEquationsFromContact(x,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}},{key:"heightfieldCylinder",value:function(e,t,i,n,o,r,a,s,l,u,h){return this.convexHeightfield(t,e,n,i,r,o,s,a,l,u,h)}},{key:"particleCylinder",value:function(e,t,i,n,o,r,a,s,l,u,h){return this.convexParticle(t,e,n,i,r,o,s,a,l,u,h)}},{key:"sphereTrimesh",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=ei,v=ti,d=ii,p=ni,y=oi,f=ri,m=ui,w=$t,g=Qt,b=hi;G.pointToLocalFrame(n,r,i,y);var x=e.radius;m.lowerBound.set(y.x-x,y.y-x,y.z-x),m.upperBound.set(y.x+x,y.y+x,y.z+x),t.getTrianglesInAABB(m,b);for(var k=Jt,E=e.radius*e.radius,S=0;S<b.length;S++)for(var z=0;z<3;z++)if(t.getVertex(t.indices[3*b[S]+z],k),k.vsub(y,g),g.lengthSquared()<=E){if(w.copy(k),G.pointToWorldFrame(n,r,w,k),k.vsub(i,g),h)return!0;var C=this.createContactEquation(a,s,e,t,l,u);C.ni.copy(g),C.ni.normalize(),C.ri.copy(C.ni),C.ri.scale(e.radius,C.ri),C.ri.vadd(i,C.ri),C.ri.vsub(a.position,C.ri),C.rj.copy(k),C.rj.vsub(s.position,C.rj),this.result.push(C),this.createFrictionEquationsFromContact(C,this.frictionResult)}for(var B=0;B<b.length;B++)for(var M=0;M<3;M++){t.getVertex(t.indices[3*b[B]+M],c),t.getVertex(t.indices[3*b[B]+(M+1)%3],v),v.vsub(c,d),y.vsub(v,f);var A=f.dot(d);y.vsub(c,f);var F=f.dot(d);if(F>0&&A<0)if(y.vsub(c,f),p.copy(d),p.normalize(),F=f.dot(p),p.scale(F,f),f.vadd(c,f),f.distanceTo(y)<e.radius){if(h)return!0;var P=this.createContactEquation(a,s,e,t,l,u);f.vsub(y,P.ni),P.ni.normalize(),P.ni.scale(e.radius,P.ri),P.ri.vadd(i,P.ri),P.ri.vsub(a.position,P.ri),G.pointToWorldFrame(n,r,f,f),f.vsub(s.position,P.rj),G.vectorToWorldFrame(r,P.ni,P.ni),G.vectorToWorldFrame(r,P.ri,P.ri),this.result.push(P),this.createFrictionEquationsFromContact(P,this.frictionResult)}}for(var R=ai,q=si,j=li,N=Zt,T=0,I=b.length;T!==I;T++){t.getTriangleVertices(b[T],R,q,j),t.getNormal(b[T],N),y.vsub(R,f);var L=f.dot(N);if(N.scale(L,f),y.vsub(f,f),L=f.distanceTo(y),Pe.pointInTriangle(f,R,q,j)&&L<e.radius){if(h)return!0;var O=this.createContactEquation(a,s,e,t,l,u);f.vsub(y,O.ni),O.ni.normalize(),O.ni.scale(e.radius,O.ri),O.ri.vadd(i,O.ri),O.ri.vsub(a.position,O.ri),G.pointToWorldFrame(n,r,f,f),f.vsub(s.position,O.rj),G.vectorToWorldFrame(r,O.ni,O.ni),G.vectorToWorldFrame(r,O.ri,O.ri),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}}b.length=0}},{key:"planeTrimesh",value:function(e,t,i,n,o,r,a,s,l,u,h){var c=new R,v=Yt;v.set(0,0,1),o.vmult(v,v);for(var d=0;d<t.vertices.length/3;d++){t.getVertex(d,c);var p=new R;p.copy(c),G.pointToWorldFrame(n,r,p,c);var y=Xt;if(c.vsub(i,y),v.dot(y)<=0){if(h)return!0;var f=this.createContactEquation(a,s,e,t,l,u);f.ni.copy(v);var m=Kt;v.scale(y.dot(v),m),c.vsub(m,m),f.ri.copy(m),f.ri.vsub(a.position,f.ri),f.rj.copy(c),f.rj.vsub(s.position,f.rj),this.result.push(f),this.createFrictionEquationsFromContact(f,this.frictionResult)}}}}]),z}(Lt.sphereSphere,Lt.spherePlane,Lt.boxBox,Lt.sphereBox,Lt.planeBox,Lt.convexConvex,Lt.sphereConvex,Lt.planeConvex,Lt.boxConvex,Lt.sphereHeightfield,Lt.boxHeightfield,Lt.convexHeightfield,Lt.sphereParticle,Lt.planeParticle,Lt.boxParticle,Lt.convexParticle,Lt.cylinderCylinder,Lt.sphereCylinder,Lt.planeCylinder,Lt.boxCylinder,Lt.convexCylinder,Lt.heightfieldCylinder,Lt.particleCylinder,Lt.sphereTrimesh,Lt.planeTrimesh),Wt=new R,Vt=new R,_t=new R,Ht=new R,Dt=new R,Gt=new V,Ut=new V,Yt=new R,Xt=new R,Kt=new R,Zt=new R,Qt=new R,Jt=new R,$t=new R,ei=new R,ti=new R,ii=new R,ni=new R,oi=new R,ri=new R,ai=new R,si=new R,li=new R,ui=new T,hi=[],ci=new R,vi=new R,di=new R,pi=new R,yi=new R;function fi(e,t,i){for(var n=null,o=e.length,r=0;r!==o;r++){var a=e[r],s=di;e[(r+1)%o].vsub(a,s);var l=pi;s.cross(t,l);var u=yi;i.vsub(a,u);var h=l.dot(u);if(!(null===n||h>0&&!0===n||h<=0&&!1===n))return!1;null===n&&(n=h>0)}return!0}var mi=new R,wi=new R,gi=new R,bi=new R,xi=[new R,new R,new R,new R,new R,new R],ki=new R,Ei=new R,Si=new R,zi=new R,Ci=new R,Bi=new R,Mi=new R,Ai=new R,Fi=new R,Pi=new R,Ri=new R,qi=new R,ji=new R,Ni=new R,Ti=new R,Ii=new R,Li=new R,Oi=new R,Wi=new R,Vi=new R,_i=new R,Hi=new R,Di=new R,Gi=new R,Ui=new V,Yi=new R,Xi=new R,Ki=new R,Zi=new R,Qi=new R,Ji=new R,$i=[0],en=new R,tn=new R,nn=function(){function e(){B(this,e),this.current=void 0,this.previous=void 0,this.current=[],this.previous=[]}return A(e,[{key:"getKey",value:function(e,t){if(t<e){var i=t;t=e,e=i}return e<<16|t}},{key:"set",value:function(e,t){for(var i=this.getKey(e,t),n=this.current,o=0;i>n[o];)o++;if(i!==n[o]){for(var r=n.length-1;r>=o;r--)n[r+1]=n[r];n[o]=i}}},{key:"tick",value:function(){var e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}},{key:"getDiff",value:function(e,t){for(var i=this.current,n=this.previous,o=i.length,r=n.length,a=0,s=0;s<o;s++){for(var l=i[s];l>n[a];)a++;l===n[a]||on(e,l)}a=0;for(var u=0;u<r;u++){for(var h=n[u];h>i[a];)a++;i[a]===h||on(t,h)}}}]),e}();function on(e,t){e.push((4294901760&t)>>16,65535&t)}var rn=function(){function e(){B(this,e),this.data={keys:[]}}return A(e,[{key:"get",value:function(e,t){if(e>t){var i=t;t=e,e=i}return this.data[e+"-"+t]}},{key:"set",value:function(e,t,i){if(e>t){var n=t;t=e,e=n}var o=e+"-"+t;this.get(e,t)||this.data.keys.push(o),this.data[o]=i}},{key:"reset",value:function(){for(var e=this.data,t=e.keys;t.length>0;){delete e[t.pop()]}}}]),e}(),an=function(e){x(i,e);var t=E(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return B(this,i),(e=t.call(this)).dt=void 0,e.allowSleep=void 0,e.contacts=void 0,e.frictionEquations=void 0,e.quatNormalizeSkip=void 0,e.quatNormalizeFast=void 0,e.time=void 0,e.stepnumber=void 0,e.default_dt=void 0,e.nextId=void 0,e.gravity=void 0,e.broadphase=void 0,e.bodies=void 0,e.hasActiveBodies=void 0,e.solver=void 0,e.constraints=void 0,e.narrowphase=void 0,e.collisionMatrix=void 0,e.collisionMatrixPrevious=void 0,e.bodyOverlapKeeper=void 0,e.shapeOverlapKeeper=void 0,e.materials=void 0,e.contactmaterials=void 0,e.contactMaterialTable=void 0,e.defaultMaterial=void 0,e.defaultContactMaterial=void 0,e.doProfiling=void 0,e.profile=void 0,e.accumulator=void 0,e.subsystems=void 0,e.addBodyEvent=void 0,e.removeBodyEvent=void 0,e.idToBodyMap=void 0,e.dt=-1,e.allowSleep=!!n.allowSleep,e.contacts=[],e.frictionEquations=[],e.quatNormalizeSkip=void 0!==n.quatNormalizeSkip?n.quatNormalizeSkip:0,e.quatNormalizeFast=void 0!==n.quatNormalizeFast&&n.quatNormalizeFast,e.time=0,e.stepnumber=0,e.default_dt=1/60,e.nextId=0,e.gravity=new R,n.gravity&&e.gravity.copy(n.gravity),e.broadphase=void 0!==n.broadphase?n.broadphase:new Ce,e.bodies=[],e.hasActiveBodies=!1,e.solver=void 0!==n.solver?n.solver:new Rt,e.constraints=[],e.narrowphase=new Ot(z(e)),e.collisionMatrix=new O,e.collisionMatrixPrevious=new O,e.bodyOverlapKeeper=new nn,e.shapeOverlapKeeper=new nn,e.materials=[],e.contactmaterials=[],e.contactMaterialTable=new rn,e.defaultMaterial=new At("default"),e.defaultContactMaterial=new Mt(e.defaultMaterial,e.defaultMaterial,{friction:.3,restitution:0}),e.doProfiling=!1,e.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},e.accumulator=0,e.subsystems=[],e.addBodyEvent={type:"addBody",body:null},e.removeBodyEvent={type:"removeBody",body:null},e.idToBodyMap={},e.broadphase.setWorld(z(e)),e}return A(i,[{key:"getContactMaterial",value:function(e,t){return this.contactMaterialTable.get(e.id,t.id)}},{key:"numObjects",value:function(){return this.bodies.length}},{key:"collisionMatrixTick",value:function(){var e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}},{key:"addConstraint",value:function(e){this.constraints.push(e)}},{key:"removeConstraint",value:function(e){var t=this.constraints.indexOf(e);-1!==t&&this.constraints.splice(t,1)}},{key:"rayTest",value:function(e,t,i){i instanceof Be?this.raycastClosest(e,t,{skipBackfaces:!0},i):this.raycastAll(e,t,{skipBackfaces:!0},i)}},{key:"raycastAll",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return i.mode=Pe.ALL,i.from=e,i.to=t,i.callback=n,sn.intersectWorld(this,i)}},{key:"raycastAny",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return i.mode=Pe.ANY,i.from=e,i.to=t,i.result=n,sn.intersectWorld(this,i)}},{key:"raycastClosest",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return i.mode=Pe.CLOSEST,i.from=e,i.to=t,i.result=n,sn.intersectWorld(this,i)}},{key:"addBody",value:function(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof se&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}},{key:"removeBody",value:function(e){e.world=null;var t=this.bodies.length-1,i=this.bodies,n=i.indexOf(e);if(-1!==n){i.splice(n,1);for(var o=0;o!==i.length;o++)i[o].index=o;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}},{key:"getBodyById",value:function(e){return this.idToBodyMap[e]}},{key:"getShapeById",value:function(e){for(var t=this.bodies,i=0;i<t.length;i++)for(var n=t[i].shapes,o=0;o<n.length;o++){var r=n[o];if(r.id===e)return r}return null}},{key:"addMaterial",value:function(e){this.materials.push(e)}},{key:"addContactMaterial",value:function(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}},{key:"step",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;if(void 0===t)this.internalStep(e),this.time+=e;else{this.accumulator+=t;for(var n=ln.now(),o=0;this.accumulator>=e&&o<i&&(this.internalStep(e),this.accumulator-=e,o++,!(ln.now()-n>1e3*e)););this.accumulator=this.accumulator%e;for(var r=this.accumulator/e,a=0;a!==this.bodies.length;a++){var s=this.bodies[a];s.previousPosition.lerp(s.position,r,s.interpolatedPosition),s.previousQuaternion.slerp(s.quaternion,r,s.interpolatedQuaternion),s.previousQuaternion.normalize()}this.time+=t}}},{key:"internalStep",value:function(e){this.dt=e;var t=this.contacts,i=yn,n=fn,o=this.numObjects(),r=this.bodies,a=this.solver,s=this.gravity,l=this.doProfiling,u=this.profile,h=se.DYNAMIC,c=-1/0,v=this.constraints,d=pn;s.length();var p=s.x,y=s.y,f=s.z,m=0;for(l&&(c=ln.now()),m=0;m!==o;m++){var w=r[m];if(w.type===h){var g=w.force,b=w.mass;g.x+=b*p,g.y+=b*y,g.z+=b*f}}for(var x=0,k=this.subsystems.length;x!==k;x++)this.subsystems[x].update();l&&(c=ln.now()),i.length=0,n.length=0,this.broadphase.collisionPairs(this,i,n),l&&(u.broadphase=ln.now()-c);var E=v.length;for(m=0;m!==E;m++){var S=v[m];if(!S.collideConnected)for(var z=i.length-1;z>=0;z-=1)(S.bodyA===i[z]&&S.bodyB===n[z]||S.bodyB===i[z]&&S.bodyA===n[z])&&(i.splice(z,1),n.splice(z,1))}this.collisionMatrixTick(),l&&(c=ln.now());var C=dn,B=t.length;for(m=0;m!==B;m++)C.push(t[m]);t.length=0;var M=this.frictionEquations.length;for(m=0;m!==M;m++)d.push(this.frictionEquations[m]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(i,n,this,t,C,this.frictionEquations,d),l&&(u.narrowphase=ln.now()-c),l&&(c=ln.now()),m=0;m<this.frictionEquations.length;m++)a.addEquation(this.frictionEquations[m]);for(var A=t.length,F=0;F!==A;F++){var P=t[F],R=P.bi,q=P.bj,j=P.si,N=P.sj;if((R.material&&q.material&&this.getContactMaterial(R.material,q.material)||this.defaultContactMaterial).friction,R.material&&q.material&&(R.material.friction>=0&&q.material.friction>=0&&(R.material.friction,q.material.friction),R.material.restitution>=0&&q.material.restitution>=0&&(P.restitution=R.material.restitution*q.material.restitution)),a.addEquation(P),R.allowSleep&&R.type===se.DYNAMIC&&R.sleepState===se.SLEEPING&&q.sleepState===se.AWAKE&&q.type!==se.STATIC)q.velocity.lengthSquared()+q.angularVelocity.lengthSquared()>=2*Math.pow(q.sleepSpeedLimit,2)&&(R.wakeUpAfterNarrowphase=!0);if(q.allowSleep&&q.type===se.DYNAMIC&&q.sleepState===se.SLEEPING&&R.sleepState===se.AWAKE&&R.type!==se.STATIC)R.velocity.lengthSquared()+R.angularVelocity.lengthSquared()>=2*Math.pow(R.sleepSpeedLimit,2)&&(q.wakeUpAfterNarrowphase=!0);this.collisionMatrix.set(R,q,!0),this.collisionMatrixPrevious.get(R,q)||(vn.body=q,vn.contact=P,R.dispatchEvent(vn),vn.body=R,q.dispatchEvent(vn)),this.bodyOverlapKeeper.set(R.id,q.id),this.shapeOverlapKeeper.set(j.id,N.id)}for(this.emitContactEvents(),l&&(u.makeContactConstraints=ln.now()-c,c=ln.now()),m=0;m!==o;m++){var T=r[m];T.wakeUpAfterNarrowphase&&(T.wakeUp(),T.wakeUpAfterNarrowphase=!1)}for(E=v.length,m=0;m!==E;m++){var I=v[m];I.update();for(var L=0,O=I.equations.length;L!==O;L++){var W=I.equations[L];a.addEquation(W)}}a.solve(e,this),l&&(u.solve=ln.now()-c),a.removeAllEquations();var V=Math.pow;for(m=0;m!==o;m++){var _=r[m];if(_.type&h){var H=V(1-_.linearDamping,e),D=_.velocity;D.scale(H,D);var G=_.angularVelocity;if(G){var U=V(1-_.angularDamping,e);G.scale(U,G)}}}for(this.dispatchEvent(cn),m=0;m!==o;m++){var Y=r[m];Y.preStep&&Y.preStep.call(Y)}l&&(c=ln.now());var X=this.stepnumber%(this.quatNormalizeSkip+1)==0,K=this.quatNormalizeFast;for(m=0;m!==o;m++)r[m].integrate(e,X,K);for(this.clearForces(),this.broadphase.dirty=!0,l&&(u.integrate=ln.now()-c),this.stepnumber+=1,this.dispatchEvent(hn),m=0;m!==o;m++){var Z=r[m],Q=Z.postStep;Q&&Q.call(Z)}var J=!0;if(this.allowSleep)for(J=!1,m=0;m!==o;m++){var $=r[m];$.sleepTick(this.time),$.sleepState!==se.SLEEPING&&(J=!0)}this.hasActiveBodies=J}},{key:"emitContactEvents",value:function(){var e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(mn,wn),e){for(var i=0,n=mn.length;i<n;i+=2)gn.bodyA=this.getBodyById(mn[i]),gn.bodyB=this.getBodyById(mn[i+1]),this.dispatchEvent(gn);gn.bodyA=gn.bodyB=null}if(t){for(var o=0,r=wn.length;o<r;o+=2)bn.bodyA=this.getBodyById(wn[o]),bn.bodyB=this.getBodyById(wn[o+1]),this.dispatchEvent(bn);bn.bodyA=bn.bodyB=null}mn.length=wn.length=0;var a=this.hasAnyEventListener("beginShapeContact"),s=this.hasAnyEventListener("endShapeContact");if((a||s)&&this.shapeOverlapKeeper.getDiff(mn,wn),a){for(var l=0,u=mn.length;l<u;l+=2){var h=this.getShapeById(mn[l]),c=this.getShapeById(mn[l+1]);xn.shapeA=h,xn.shapeB=c,h&&(xn.bodyA=h.body),c&&(xn.bodyB=c.body),this.dispatchEvent(xn)}xn.bodyA=xn.bodyB=xn.shapeA=xn.shapeB=null}if(s){for(var v=0,d=wn.length;v<d;v+=2){var p=this.getShapeById(wn[v]),y=this.getShapeById(wn[v+1]);kn.shapeA=p,kn.shapeB=y,p&&(kn.bodyA=p.body),y&&(kn.bodyB=y.body),this.dispatchEvent(kn)}kn.bodyA=kn.bodyB=kn.shapeA=kn.shapeB=null}}},{key:"clearForces",value:function(){for(var e=this.bodies,t=e.length,i=0;i!==t;i++){var n=e[i];n.force,n.torque,n.force.set(0,0,0),n.torque.set(0,0,0)}}}]),i}(W);new T;var sn=new Pe,ln=globalThis.performance||{};if(!ln.now){var un=Date.now();ln.timing&&ln.timing.navigationStart&&(un=ln.timing.navigationStart),ln.now=function(){return Date.now()-un}}var hn={type:"postStep"},cn={type:"preStep"},vn={type:se.COLLIDE_EVENT_NAME,body:null,contact:null},dn=[],pn=[],yn=[],fn=[],mn=[],wn=[],gn={type:"beginContact",bodyA:null,bodyB:null},bn={type:"endContact",bodyA:null,bodyB:null},xn={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},kn={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},En=regeneratorRuntime.mark(oo),Sn=new n.dpR,zn=Sn.load("/Images/silver_2.png"),Cn=Sn.load("/Images/purple.png"),Bn=Sn.load("/Images/yellow.png"),Mn=Sn.load("/Images/red_1.png"),An=Sn.load("/Images/cyan.png"),Fn=Sn.load("/Images/matWhite.png"),Pn=Sn.load("/Images/red_2.png"),Rn=[Mn,Bn,An,Fn],qn=new At("default"),jn=new Mt(qn,qn,{friction:.1,restitution:.3}),Nn=new n.Kj0(new n.DvJ(100,5,5),new n.kaV({matcap:zn}));Nn.position.set(0,35,0);//! CANNON.js
var Tn=new J(new R(50,2.5,2.5)),In=new se({mass:0,position:new R(0,35,0),shape:Tn,material:qn}),Ln=new n.Kj0(new n.DvJ(3,70,5),new n.kaV({matcap:zn}));Ln.position.set(-48.5,0,0);//! CANNON.js
var On=new J(new R(1.5,35,2.5)),Wn=new se({mass:0,position:new R(-48.5,0,0),shape:On,material:qn}),Vn=new n.Kj0(new n.DvJ(100,5,5),new n.kaV({matcap:zn}));Vn.position.set(0,-35,0);//! CANNON.js
var _n=new J(new R(50,2.5,2.5)),Hn=new se({mass:0,position:new R(0,-35,0),shape:_n,material:qn}),Dn=new n.Kj0(new n.DvJ(3,70,5),new n.kaV({matcap:zn}));Dn.position.set(48.5,0,0);//! CANNON.js
var Gn=new J(new R(1.5,35,2.5)),Un=new se({mass:0,position:new R(48.5,0,0),shape:Gn,material:qn}),Yn=new n.Kj0(new n.DvJ(9,1.5,2),new n.kaV({matcap:Cn}));Yn.position.set(0,-25.9,0);//! CANNON.js
var Xn=new J(new R(4.5,.75,1)),Kn=new se({mass:0,position:new R(0,-25.9,0),shape:Xn,material:qn}),Zn=new n.Kj0(new n.xo$(1,64,32),new n.kaV({matcap:Pn}));Zn.position.set(0,-17.5,0);//! CANNON.js
var Qn=new Ft(1),Jn=new se({mass:1,position:new R(0,-17.5,0),shape:Qn,material:qn}),$n=new n.DvJ(5,2,2),eo=new n.kaV({matcap:Rn[0]}),to=new n.kaV({matcap:Rn[1]}),io=new n.kaV({matcap:Rn[2]}),no=new n.kaV({matcap:Rn[3]});function oo(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,eo;case 2:return e.next=4,to;case 4:return e.next=6,io;case 6:return e.next=8,no;case 8:case"end":return e.stop()}}),En)}//!
for(var ro=oo(),ao=new n.ZAu,so=-42.5,lo=25.9,uo=new J(new R(2.5,1,1)),ho=[],co=[],vo=0;vo<4;vo++){for(var po=ro.next().value,yo=0;yo<13;yo++){var fo=new n.Kj0($n,po);fo.position.set(so,lo);var mo={block:fo,body:new se({mass:0,position:new R(so,lo,0),shape:uo,material:qn})};ho.push(mo),ao.add(fo),so+=7}so=-42.5,lo-=2.3}for(var wo=0;wo<ho.length;wo++)co[wo]=ho[wo].body;for(var go=i(821),bo=[],xo=0;xo<1e4;xo++){var ko=n.M8C.randFloatSpread(2e3),Eo=n.M8C.randFloatSpread(2e3),So=n.M8C.randFloatSpread(2e3);bo.push(ko,Eo,So)}var zo=new n.u9r;zo.setAttribute("position",new n.a$l(bo,3));var Co=(new n.dpR).load("/Images/1.png"),Bo=new n.UY4({size:5,sizeAttenuation:!0,transparent:!0,alphaMap:Co,depthWrite:!1}),Mo=new n.woe(zo,Bo);function Ao(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var Fo=new n.xsS;Fo.background=new n.Ilk(0);var Po=new g.Z;Fo.add(Nn,Ln,Vn,Dn,Yn,Zn,Mo,ao);var Ro=document.documentElement.clientWidth,qo=document.documentElement.clientHeight,jo=new n.cPb(45,Ro/qo,.1,1e3),No=new n.CP7({antialias:!0});jo.position.set(0,0,100);var To=new w([Yn],jo,No.domElement);No.setSize(Ro,qo);new n.y8_(5);var Io=new an;Io.addContactMaterial(jn);for(var Lo,Oo=[In,Wn,Hn,Un,Kn,Jn].concat(function(e){if(Array.isArray(e))return Ao(e)}(Lo=co)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(Lo)||function(e,t){if(e){if("string"==typeof e)return Ao(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Ao(e,t):void 0}}(Lo)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),Wo=0;Wo<Oo.length;Wo++)Io.addBody(Oo[Wo]);var Vo=Yn.position.x,_o=0,Ho=new n.SUY,Do=0,Go=null;!function e(){Go=requestAnimationFrame(e);var t=Ho.getElapsedTime()-Do;if(Do=t,Mo.rotation.y+=.001,Io.step(1/60,t,3),Yn.position.x=Po.pressed("right")?Yn.position.x+.5>42.5?Yn.position.x:Yn.position.x+.5:Po.pressed("left")?Yn.position.x-.5<-42.5?Yn.position.x:Yn.position.x-.5:Yn.position.x,Yn.position.x=Po.pressed("a")||Po.pressed("A")?Yn.position.x-.5<-42.5?Yn.position.x:Yn.position.x-.5:Po.pressed("d")||Po.pressed("D")?Yn.position.x+.5>42.5?Yn.position.x:Yn.position.x+.5:Yn.position.x,Kn.position.copy(Yn.position),Zn.position.copy(Jn.position),0===ao.children.length&&(cancelAnimationFrame(Go),go.I$.pause(),go.yp.play(),document.getElementById("overlay").removeAttribute("onclick"),document.querySelector("#overlay").style.display="flex",document.querySelector("#overlay").style.flexFlow="column",document.getElementById("result").textContent="Winner!!!"),Zn.position.y<=-27&&(cancelAnimationFrame(Go),go.I$.pause(),go.U_.play(),document.getElementById("overlay").removeAttribute("onclick"),document.querySelector("#overlay").style.display="flex",document.querySelector("#overlay").style.flexFlow="column",document.getElementById("result").textContent="You Lost!!!"),(Vo<Yn.position.x||Vo>Yn.position.x)&&0===_o){var i=Math.ceil(7*Math.random())-2,n=i<=2&&i>=-2?i<=0?i-2:i+2:i;Io.gravity.set(n,-9.82,0),_o++}No.render(Fo,jo)}(),window.addEventListener("resize",(function(){Ro=document.documentElement.clientWidth,qo=document.documentElement.clientHeight,jo.aspect=Ro/qo,jo.updateProjectionMatrix(),No.setSize(Ro,qo)})),To.addEventListener("drag",(function(e){var t=e.object.position;t.y=-25.9,t.x>42.5?t.x=42.5:t.x<-42.5&&(t.x=-42.5)}));var Uo=null,Yo=null;function Xo(){Jn.velocity.y+=10}function Ko(){Jn.velocity.y-=10}In.addEventListener("collide",(function(e){cancelAnimationFrame(Yo),Uo=requestAnimationFrame(Ko)})),Wn.addEventListener("collide",(function(e){Jn.velocity.y>=0?Jn.velocity.set(9,9,0):Jn.velocity.set(9,-9,0)})),Un.addEventListener("collide",(function(e){Jn.velocity.y>=0?Jn.velocity.set(-9,9,0):Jn.velocity.set(-9,-9,0)})),Kn.addEventListener("collide",(function(e){Io.gravity.set(0,0,0),Uo&&cancelAnimationFrame(Uo),Yo=requestAnimationFrame(Xo)}));for(var Zo=function(e){ho[e].body.addEventListener("collide",(function(t){Jn.velocity.y=Jn.velocity.y>=0?-10:10,go.gQ.currentTime=0,go.gQ.play(),Io.removeBody(ho[e].body),ao.remove(ho[e].block)}))},Qo=0;Qo<ho.length;Qo++)Zo(Qo)}}]);